globals
string array h
integer m
real o
real q
real array w
real array A
real array B
real array C
real array D
real E
real F
real G
integer H
timer I
item array J
integer K
code L
real M
integer array N
timer O
boolean P=false
integer Q
integer array R
integer array S
integer array T
integer array U
integer array V
integer array W
integer array X
real array Y
real array Z
real d4
real e4
constant group f4=CreateGroup()
player g4
integer array h4
real array i4
boolean array j4
boolean array k4
integer array m4
trigger array n4
unit o4
real array p4
trigger array q4
unit r4
trigger array s4
integer array t4
unit u4
unit v4
string array w4
integer x4=0
integer y4=0
integer z4=0
integer A4=0
constant integer a4=$C8
boolean B4=true
boolean array b4
player C4=null
constant force c4=CreateForce()
constant trigger D4=CreateTrigger()
integer E4
integer F4
boolexpr G4
timer H4=null
unit array I4
boolean array l4
real array J4
real array K4
boolexpr L4
boolexpr M4
boolexpr N4
boolexpr O4
location array P4
boolean array Q4
constant trigger R4=CreateTrigger()
boolean S4=false
boolean T4=true
real array U4
playercolor array V4
constant playercolor W4=GetPlayerColor(Player($F))
boolean X4=false
region Y4
region Z4
integer d7
integer e7
trigger f7
trigger g7
unit h7
unit i7
integer array j7
integer k7
boolexpr m7
boolexpr n7
constant group o7=CreateGroup()
boolexpr p7
constant timer q7=CreateTimer()
constant timer r7=CreateTimer()
boolexpr s7
boolean t7=false
boolean array u7
multiboard array v7
multiboard array w7
trigger gameEndTrigger = CreateTrigger()
integer array x7
multiboard y7=null
integer array z7
integer A7=0
string array a7
multiboarditem B7
integer b7=0
constant timer C7=CreateTimer()
integer c7
integer D7
constant hashtable E7=InitHashtable()
constant group F7=CreateGroup()
rect G7
location H7
boolean I7=true
boolean l7=false
boolean J7=false
string K7
integer L7=-1
integer M7=0
integer N7=0
integer O7=2
integer P7=0
integer Q7=$A
boolean R7
boolean S7=false
boolean T7=false
boolean U7=false
boolean V7=false
boolean W7=true
boolean X7=true
boolean Y7=true
boolean Z7=true
boolean d8=false
boolean e8=true
boolean f8=false
boolean g8=false
boolean h8=false
boolean i8=true
integer j8=0
integer k8=-1
integer m8=0
integer n8=0
integer o8=0
integer p8=0
integer array q8
location array r8
integer array s8
rect array t8
integer array u8
integer array v8
string array w8
integer array x8
location array y8
integer array z8
integer array A8
integer array a8
integer array B8
integer array b8
integer array C8
integer array c8
integer array D8
integer array E8
integer array F8
integer array G8
integer array H8
integer array I8
integer array l8
constant force J8=CreateForce()
constant force K8=CreateForce()
constant force L8=CreateForce()
constant force M8=CreateForce()
integer array N8
force array O8
unit array P8
string array Q8
boolean array R8
integer S8=0
timer T8
integer array U8
real array V8
integer array W8
integer array X8
real array Y8
integer array Z8
boolean array d9
real array e9
unit array f9
boolean array g9
unit array h9
force array i9
timer array j9
boolean array k9
player array m9
boolean n9=true
boolean o9=false
constant integer p9=7-1
integer q9
integer r9
boolexpr s9
boolexpr t9
integer u9
integer v9
integer w9
integer x9
integer y9
integer z9
integer A9
integer a9
integer B9
integer b9
integer C9
integer array c9
unit array D9
real array E9
real array F9
timer array G9
integer H9=0
code I9
integer l9='A01I'
integer J9
boolexpr K9
boolexpr L9
integer M9='n01C'
boolexpr N9
constant group O9=CreateGroup()
boolexpr P9
boolexpr Q9
trigger array R9
boolexpr S9
constant timer T9=CreateTimer()
real U9=25.
real array V9
integer array W9
string X9
real array Y9
integer Z9
constant group dd=CreateGroup()
boolexpr ed
boolexpr fd
boolexpr gd
integer hd='A0BD'
weathereffect jd
boolexpr kd
boolexpr md
integer nd='A07T'
boolexpr od
integer array pd
constant trigger qd=CreateTrigger()
boolexpr rd
boolexpr sd
constant timer td=CreateTimer()
unit array ud
integer vd=0
weathereffect wd
real xd
real yd
real zd
real Ad
boolexpr ad
integer array Bd
trigger bd=null
boolean Cd=false
trigger cd
trigger Dd
trigger Ed
boolexpr Fd
integer Gd=0
string Hd
timer Id=null
trigger ld=null
integer array Jd
timer Kd=CreateTimer()
timerdialog Ld
trigger gameStartTrigger = CreateTrigger()
trigger Md=CreateTrigger()
dialog Nd=DialogCreate()
button array Od
boolean Pd=false
constant timer Qd=CreateTimer()
constant timerdialog Rd=CreateTimerDialog(Qd)
integer Sd=-1
integer Td
boolean array Ud
boolean Vd=false
string Wd=null
boolean Xd=false
fogmodifier array Yd
trigger Zd=null
button array de
integer array ee
constant force fe=CreateForce()
constant force ge=CreateForce()
constant force he=CreateForce()
dialog ie
constant trigger je=CreateTrigger()
boolean ke=false
constant timer me=CreateTimer()
boolean ne=false
integer oe
integer pe
constant trigger qe=CreateTrigger()
fogmodifier re
fogmodifier se
force te=null
timer ue
timerdialog ve
trigger xe
integer ye
integer ze
integer Ae
unit ae
unit Be
integer be
integer Ce
timer ce
timerdialog De
trigger Ee
integer Fe
player Ge
integer He
integer Ie
integer le=-1
boolexpr Je
group Ke
timer Le
timerdialog Me
force Ne
integer Oe
trigger Pe
rect Qe=null
rect Re=null
rect Se=null
rect Te=null
sound Ue=null
sound Ve=null
trigger We=null
trigger Xe=null
trigger Ye=null
trigger Ze=null
trigger df=null
trigger ef=null
trigger ff=null
trigger gf=null
trigger hf=null
trigger jf=null
trigger kf=null
trigger mf=null
trigger nf=null
force of
boolean pf=true
integer qf=0
integer rf=0
integer array sf
integer array tf
integer array uf
integer array vf
integer wf=0
integer xf=0
integer array yf
integer array zf
integer array Af
integer array af
integer Bf=0
integer bf=0
integer array Cf
integer array cf
integer array Df
integer array Ef
integer array Ff
integer array Gf
integer array Hf
integer array If
integer array lf
real Lf=.0
real Mf=.0
boolexpr Pf=null
endglobals
function Rf takes location Sf,real Tf,real Uf returns location
return Location(GetLocationX(Sf)+Tf*Cos(Uf*bj_DEGTORAD),GetLocationY(Sf)+Tf*Sin(Uf*bj_DEGTORAD))
endfunction
function Vf takes nothing returns boolean
local real dx=GetDestructableX(GetFilterDestructable())-Lf
local real dy=GetDestructableY(GetFilterDestructable())-Mf
return(dx*dx+dy*dy<=bj_enumDestructableRadius)
endfunction
function Wf takes itemtype Xf,integer Yf returns nothing
local group g
set bj_stockPickedItemType=Xf
set bj_stockPickedItemLevel=Yf
set g=CreateGroup()
call GroupEnumUnitsOfType(g,"marketplace",Pf)
call ForGroup(g,function UpdateEachStockBuildingEnum)
call DestroyGroup(g)
set g=null
endfunction
function Zf takes nothing returns nothing
local integer pickedItemId
local itemtype dg
local integer eg=0
local integer fg=0
local integer Yf
set Yf=1
loop
if(bj_stockAllowedPermanent[Yf])then
set fg=fg+1
if(GetRandomInt(1,fg)==1)then
set dg=ITEM_TYPE_PERMANENT
set eg=Yf
endif
endif
if(bj_stockAllowedCharged[Yf])then
set fg=fg+1
if(GetRandomInt(1,fg)==1)then
set dg=ITEM_TYPE_CHARGED
set eg=Yf
endif
endif
if(bj_stockAllowedArtifact[Yf])then
set fg=fg+1
if(GetRandomInt(1,fg)==1)then
set dg=ITEM_TYPE_ARTIFACT
set eg=Yf
endif
endif
set Yf=Yf+1
exitwhen Yf>$A
endloop
if(fg==0)then
set dg=null
return
endif
call Wf(dg,eg)
set dg=null
endfunction
function gg takes nothing returns nothing
call Zf()
call TimerStart(bj_stockUpdateTimer,bj_STOCK_RESTOCK_INTERVAL,true,function Zf)
endfunction
function ig takes nothing returns boolean
return true
endfunction
function ng takes nothing returns integer
local integer og=qf
if(og!=0)then
set qf=sf[og]
else
set rf=rf+1
set og=rf
endif
if(og>510)then
return 0
endif
set uf[og]=(og-1)*16
set sf[og]=-1
return og
endfunction
function pg takes integer og returns nothing
if og==null then
return
elseif(sf[og]!=-1)then
return
endif
set sf[og]=qf
set qf=og
endfunction
function qg takes nothing returns integer
local integer og=Bf
if(og!=0)then
set Bf=Cf[og]
else
set bf=bf+1
set og=bf
endif
if(og>$CB)then
return 0
endif
set Df[og]=(og-1)*40
set Ff[og]=(og-1)*7
set Hf[og]=(og-1)*16
set lf[og]=(og-1)*4
set Cf[og]=-1
return og
endfunction
function rg takes nothing returns integer
local integer og=wf
if(og!=0)then
set wf=yf[og]
else
set xf=xf+1
set og=xf
endif
if(og>$7FE)then
return 0
endif
set Af[og]=(og-1)*4
set yf[og]=-1
return og
endfunction
function sg takes nothing returns string
local integer i=GetRandomInt(0,m)
local string s=h[i]
set h[i]=h[m]
set m=m-1
return s
endfunction
function tg takes nothing returns nothing
set h[0]="General"
set h[1]="FanToMace"
set h[2]="antiPOD"
set h[3]="ADMIN"
set h[4]="Ms Weapon"
set h[5]="C|c00ff008000l"
set h[6]="O|c00ff00ff:"
set h[7]=":|c00ff8040O"
set h[8]="INqUSitor"
set h[9]="Your_Death"
set h[$A]="Nan Yanoi"
set h[$B]="Impale"
set h[$C]="Proxima"
set h[$D]="13|c00ff0000th"
set h[$E]="Mariana"
set h[$F]="ProFan"
set h[16]="Active"
set h[17]="Master"
set h[18]="Nice Guy"
set h[19]="Kasr'Kin"
set h[20]="Pr0[tag]on1st"
set h[21]="Imperor"
set h[22]="FBI agent :)"
set h[23]="Spell"
set h[24]="WTFG0D"
set h[25]="Leaver :P"
set h[26]="Your Windows"
set h[27]="GreatWarrior"
set h[28]="ShadowOfFlame"
set h[29]="No_Ob"
set h[30]="Shurf"
set h[31]="I am WH :'("
set h[32]="CriticalError"
set h[33]="Brain"
set h[34]="L|c0000ff40ord"
set h[35]="Princess"
set m=35
endfunction
function ug takes nothing returns nothing
local integer i=0
if(T7)then
set E=128.
else
set E=128.*2.
endif
set C[0]=-1.*E
set D[0]=1.*E
set C[1]=-1.*E
set D[1]=-1.*E
set C[2]=1.*E
set D[2]=-1.*E
set C[3]=1.*E
set D[3]=1.*E
set A[0]=5568.
set B[0]=512.
set A[1]=5568.
set B[1]=-1.*512.
set A[2]=-1.*5568.
set B[2]=-1.*512.
set A[3]=-1.*5568.
set B[3]=512.
loop
set w[i]=B[i]
set i=i+1
exitwhen i>3
endloop
endfunction
function vg takes nothing returns nothing
local integer i=0
set E=128.
set C[0]=-1.*E
set D[0]=1.*E
set C[1]=-1.*E
set D[1]=-1.*E
set C[2]=1.*E
set D[2]=-1.*E
set C[3]=1.*E
set D[3]=1.*E
set A[0]=5568.
set B[0]=512.
set A[1]=5568.
set B[1]=-1.*512.
set A[2]=-1.*5568.
set B[2]=-1.*512.
set A[3]=-1.*5568.
set B[3]=512.
loop
set w[i]=B[i]
set i=i+1
exitwhen i>3
endloop
endfunction
function wg takes integer xg returns nothing
set o=A[xg]
set q=B[xg]
endfunction
function yg takes integer xg returns nothing
set B[xg]=B[xg]+(D[xg])
if(RAbsBJ(B[xg])>1920.)then
set A[xg]=A[xg]+(C[xg])
if(RAbsBJ(A[xg])<1664.)then
call vg()
return
endif
set B[xg]=w[xg]
endif
endfunction
function zg takes nothing returns nothing
local unit u=GetEnumUnit()
set F=F+(GetUnitX(u))
set G=G+(GetUnitY(u))
set H=H+1
set u=null
endfunction
function Ag takes unit ag,unit Sf returns boolean
set g4=GetOwningPlayer(Sf)
if(IsPlayerInForce(g4,J8))then
call DisplayTextToForce(J8,Q8[GetPlayerId(GetOwningPlayer(ag))]+": I'm going to use RS!!!")
elseif(IsPlayerInForce(g4,K8))then
call DisplayTextToForce(K8,Q8[GetPlayerId(GetOwningPlayer(ag))]+": I'm going to use RS!!!")
endif
call GroupEnumUnitsInRange(f4,GetUnitX(Sf),GetUnitY(Sf),1690.1,n7)
set F=.0
set G=.0
set H=0
call ForGroup(f4,function zg)
if(H!=0)then
set F=F/(H)
set G=G/(H)
return IssuePointOrderById(ag,$D0208,F,G)
endif
return false
endfunction
function Bg takes nothing returns nothing
local integer i=0
loop
call RemoveItem(J[i])
set i=i+1
exitwhen i>=K
endloop
call TimerStart(I,31.25,false,L)
endfunction
function bg takes nothing returns nothing
local integer i=0
set M=M+(3.)
loop
set J[i]=CreateItem('I000',GetRandomReal(GetRectMinX(Re),GetRectMaxX(Re)),GetRandomReal(GetRectMinY(Re),GetRectMaxY(Re)))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl",GetItemX(J[i]),GetItemY(J[i])))
set J[i+1]=CreateItem('I000',GetRandomReal(GetRectMinX(Qe),GetRectMaxX(Qe)),GetRandomReal(GetRectMinY(Qe),GetRectMaxY(Qe)))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl",GetItemX(J[i+1]),GetItemY(J[i+1])))
set i=i+(2)
exitwhen i>=K
endloop
call TimerStart(I,4.75,false,function Bg)
endfunction
function Cg takes nothing returns nothing
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffFFFF80Bounty incoming!|r")
call TimerStart(I,4.,false,function bg)
endfunction
function cg takes player p returns nothing
local integer id=GetPlayerId(p)
local integer Dg=R2I((I2R(I8[id])+4.)*.25*(8.+M))
set D8[id]=D8[id]+1
call DisplayTextToPlayer(p,.0,.0,"|cffFFFF80You found |cffFFFF00"+I2S(Dg)+"|cffFFFF80 gold!|r")
set E8[id]=E8[id]+(Dg)
call AdjustPlayerStateBJ(Dg,p,PLAYER_STATE_RESOURCE_GOLD)
endfunction
function Eg takes boolean Fg returns nothing
if(I==null)then
return
endif
call PauseTimer(I)
if(Fg)then
call DestroyTimer(I)
set I=null
endif
endfunction
function Gg takes nothing returns nothing
local integer i=0
if(o8<=0)then
return
endif
if(I==null)then
set I=CreateTimer()
set K=o8*2
endif
set M=.0
loop
set N[i]=-1
set i=i+1
exitwhen i>=4
endloop
set N[4]=0
set N[5]=0
call TimerStart(I,40.,false,function Cg)
endfunction
function Hg takes nothing returns nothing
set I=null
set L=function Cg
endfunction
function Ig takes nothing returns nothing
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Icy Environment|r has been selected. Note that a custom environment has no influence on gameplay.")
set U[0]='Ibsq'
set U[1]='Iice'
set U[2]='Isnw'
set U[3]='Idki'
set U[4]='Nsnw'
set U[5]='Nsnr'
set U[6]='Irbk'
set U[7]='Nsnw'
set V[0]='ITtw'
set W[0]=$A
set V[1]='ITtc'
set W[1]=3
set X[0]='B00M'
set Z[0]=.5
set Y[0]=.0
set X[1]='B00N'
set Z[1]=.5
set Y[1]=.0
set X[2]='B00O'
set Z[2]=.5
set Y[2]=.0
set X[3]='B00P'
set Z[3]=.5
set Y[3]=.0
set X[4]='B00G'
set Z[4]=.97
set Y[4]=-30.
call SetTerrainFogExBJ(0,1200.,6000.,0,80.,80.,100.)
endfunction
function lg takes nothing returns nothing
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Lava Environment|r has been selected. Note that a custom environment has no influence on gameplay.")
set U[0]='Ddkr'
set U[1]='Dgrs'
set U[2]='Dlvc'
set U[3]='Dlav'
set U[4]='Drds'
set U[5]='Ddrt'
set U[6]='Dsqd'
set U[7]='Dgrs'
set V[0]='B001'
set W[0]=8
set V[1]='B000'
set W[1]=$A
set X[0]='B00H'
set Z[0]=1.1
set Y[0]=.0
set X[1]='B00J'
set Z[1]=1.1
set Y[1]=.0
set X[2]='B00K'
set Z[2]=1.1
set Y[2]=.0
set X[3]='B00L'
set Z[3]=1.1
set Y[3]=.0
set X[4]='B00I'
set Z[4]=1.
set Y[4]=-70.
call SetTerrainFogExBJ(0,$3E8,3000.,0,50.,.0,.0)
call SetWaterBaseColorBJ('d',.0,.0,0)
endfunction
function Jg takes nothing returns nothing
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Icy Environment|r has been selected. Note that a custom environment has no influence on gameplay.")
set U[0]='Ibsq'
set U[1]='Iice'
set U[2]='Isnw'
set U[3]='Idki'
set U[4]='Nsnw'
set U[5]='Nsnr'
set U[6]='Irbk'
set U[7]='Nsnw'
set V[0]='ITtw'
set W[0]=$A
set V[1]='ITtc'
set W[1]=3
set X[0]='B007'
set Z[0]=1.2
set Y[0]=.0
set X[1]='B008'
set Z[1]=1.2
set Y[1]=.0
set X[2]='B009'
set Z[2]=1.2
set Y[2]=.0
set X[3]='B00A'
set Z[3]=1.2
set Y[3]=.0
set X[4]='B00G'
set Z[4]=.97
set Y[4]=-30.
endfunction
function Kg takes nothing returns nothing
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Barrens Environment|r has been selected. Note that a custom environment has no influence on gameplay.")
set U[0]='Klgb'
set U[1]='Odrt'
set U[2]='Bdrt'
set U[3]='Ofst'
set U[4]='Bdrh'
set U[5]='Bgrr'
set U[6]='Bdsd'
set U[7]='Bdrr'
set V[0]='ITtw'
set W[0]=$A
set V[1]='ITtc'
set W[1]=3
set X[0]='B007'
set Z[0]=1.2
set Y[0]=.0
set X[1]='B008'
set Z[1]=1.2
set Y[1]=.0
set X[2]='B009'
set Z[2]=1.2
set Y[2]=.0
set X[3]='B00A'
set Z[3]=1.2
set Y[3]=.0
set X[4]='B00G'
set Z[4]=.97
set Y[4]=-30.
call SetTerrainFogEx(0,1000.,8000.,.0,.686,.369,.098)
call SetAmbientDaySound("BarrensDay")
call SetAmbientNightSound("BarrensNight")
endfunction
function Lg takes nothing returns nothing
local destructable Mg=GetEnumDestructable()
local integer i=0
local real x
local real y
local real z
local location l
loop
exitwhen i>1
if GetDestructableTypeId(Mg)==S[i]then
set x=GetDestructableX(Mg)
set y=GetDestructableY(Mg)
call RemoveDestructable(Mg)
call CreateDestructable(V[i],x,y,GetRandomReal(.0,360.),1,GetRandomInt(0,W[i]-1))
return
endif
set i=i+1
endloop
set i=0
loop
exitwhen i>4
if GetDestructableTypeId(Mg)==T[i]then
set x=GetDestructableX(Mg)
set y=GetDestructableY(Mg)
set l=GetDestructableLoc(Mg)
set z=GetLocationZ(l)
call RemoveLocation(l)
set l=null
call RemoveDestructable(Mg)
call CreateDestructableZ(X[i],x,y,Y[i]+z,0,Z[i],1)
return
endif
set i=i+1
endloop
set Mg=null
endfunction
function Ng takes nothing returns nothing
local real x=0
local real y=Q*512
local real zG
local real ZG
local integer i
local integer j
if(Q<50)then
loop
exitwhen(y>d4)
set x=0
loop
exitwhen(x>e4)
set i=0
loop
exitwhen i>3
set zG=I2R((i/2)*2-1)*x
set ZG=I2R(ModuloInteger(i,2)*2-1)*y
set j=0
loop
exitwhen j>7
if(GetTerrainType(zG,ZG)==R[j])then
call SetTerrainType(zG,ZG,U[j],-1,1,0)
exitwhen true
endif
set j=j+1
endloop
set i=i+1
endloop
set x=x+$80
endloop
set y=y+$80
if(ModuloReal(y,512)==0)then
set Q=Q+1
call TimerStart(O,.0,false,function Ng)
return
endif
endloop
set Q=50
call TimerStart(O,.0,false,function Ng)
return
elseif Q==50 then
set j=0
loop
exitwhen j>6
set R[j]=U[j]
set j=j+1
endloop
call EnumDestructablesInRectAll(bj_mapInitialPlayableArea,function Lg)
set j=0
loop
exitwhen j>1
set S[j]=V[j]
set j=j+1
endloop
set j=0
loop
exitwhen j>4
set T[j]=X[j]
set j=j+1
endloop
call DestroyTimer(O)
set O=null
endif
endfunction
function Og takes integer Pg returns nothing
if(P)then
call DisplayTextToPlayer(Player(0),0,0,"You have already chosen an environment!")
return
endif
set P=true
set O=CreateTimer()
set Q=0
set d4=GetRectMaxY(bj_mapInitialPlayableArea)
set e4=GetRectMaxX(bj_mapInitialPlayableArea)
set R[0]='Vstp'
set R[1]='Adrt'
set R[2]='Adrg'
set R[3]='Agrs'
set R[4]='Agrd'
set R[5]='Alvd'
set R[6]='Zdtr'
set R[7]='Avin'
set S[0]='ATtr'
set S[1]='ATtc'
set T[0]='B002'
set T[1]='B003'
set T[2]='B004'
set T[3]='B005'
set T[4]='B006'
if(Pg==0)then
call Ig()
elseif(Pg==1)then
call lg()
elseif(Pg==2)then
call Jg()
elseif(Pg==3)then
call Kg()
endif
call TimerStart(O,.0,false,function Ng)
endfunction
function Qg takes integer Rg,integer Sg returns nothing
set m4[GetUnitPointValueByType(Rg)]=Sg
endfunction
function Tg takes unit u,integer Ug,real an,real x,real y returns nothing
local integer Vg=GetUnitUserData(u)
local real mx=GetUnitX(u)+x
local real my=GetUnitY(u)+y
local unit v=CreateUnit(GetOwningPlayer(u),Ug,mx,my,an)
call SetUnitPathing(v,false)
call SetUnitX(v,mx)
call SetUnitY(v,my)
call SaveUnitHandle(E7,GetHandleId(u),Vg,v)
set v=null
call SetUnitUserData(u,Vg+1)
endfunction
function Wg takes unit u returns nothing
local integer Xg=GetUnitUserData(u)
local integer Yg=GetHandleId(u)
if(Xg>0)then
loop
set Xg=Xg-1
call RemoveUnit(LoadUnitHandle(E7,Yg,Xg))
exitwhen Xg<=0
endloop
endif
endfunction
function Zg takes integer Rg,code dh returns nothing
local integer id=GetUnitPointValueByType(Rg)
set n4[id]=CreateTrigger()
call TriggerAddCondition(n4[id],Condition(dh))
endfunction
function eh takes unit u returns nothing
local integer id=GetUnitPointValue(u)
if(n4[id]!=null)then
set o4=u
call TriggerEvaluate(n4[id])
endif
endfunction
function fh takes integer Rg,real r returns nothing
set p4[GetUnitPointValueByType(Rg)]=r
endfunction
function gh takes integer Rg,code hh returns nothing
local integer id=GetUnitPointValueByType(Rg)
set q4[id]=CreateTrigger()
call TriggerAddAction(q4[id],hh)
endfunction
function ih takes unit u returns nothing
local integer id=GetUnitPointValue(u)
if(q4[id]!=null)then
set r4=u
call TriggerExecute(q4[id])
endif
endfunction
function jh takes integer Rg,integer kh,code dh returns nothing
local integer id=GetUnitPointValueByType(Rg)
set s4[id]=CreateTrigger()
call TriggerAddAction(s4[id],dh)
set t4[id]=kh
endfunction
function mh takes unit u,integer kh,unit t returns nothing
local integer id=GetUnitPointValue(u)
if(s4[id]!=null and kh==t4[id])then
set u4=u
set v4=t
call TriggerExecute(s4[id])
endif
endfunction
function nh takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h008')
set h4[id]=350
set i4[id]=350*.09/100.
set j4[id]=false
endfunction
function oh takes string s returns nothing
local string ph=I2S(z4)
local string qh=I2S(y4)
if(z4<$A)then
set ph="0"+ph
endif
if(y4<$A)then
set qh="0"+qh
endif
set w4[x4]=w4[x4]+("["+I2S(A4)+":"+ph+":"+qh+"] "+s+"")
if(StringLength(w4[x4])>=a4)then
set x4=x4+1
endif
endfunction
function LogClear takes nothing returns nothing
local integer i=0
loop
exitwhen not(i<=x4)
set w4[i]=""
set i=i+1
endloop
set x4=0
endfunction
function rh takes nothing returns nothing
local integer i=0
call PreloadGenClear()
call PreloadGenStart()
loop
exitwhen not(i<=x4)
call Preload("\")"+w4[i]+"(\"")
set i=i+1
endloop
call PreloadGenEnd("Replay\\LastReplay.log")
endfunction
function sh takes nothing returns nothing
set y4=y4+1
if(y4>59)then
set y4=0
set z4=z4+1
if(z4>59)then
set z4=0
set A4=A4+1
endif
endif
endfunction
function th takes nothing returns nothing
call TimerStart(CreateTimer(),.01,true,function sh)
call oh("Castle Fight ES game log")
call oh("Map compilation: 2011.09.10 03:01:25")
call rh()
endfunction
function uh takes nothing returns nothing
local integer i=0
loop
if(GetPlayerController(Player(i))==MAP_CONTROL_USER and GetPlayerSlotState(Player(i))==PLAYER_SLOT_STATE_PLAYING and(IsPlayerInForce(Player(i),J8)or IsPlayerInForce(Player(i),K8)))then
set b4[i]=true
endif
set i=i+1
exitwhen i>$B
endloop
set B4=false
endfunction
function vh takes nothing returns boolean
local integer i=0
loop
if(b4[i])then
return false
endif
set i=i+1
exitwhen i>$B
endloop
set B4=true
return true
endfunction
function wh takes integer xh returns nothing
if(B4)then
return
endif
if(b4[xh])then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+" has voted for a draw!")
set b4[xh]=false
if(vh())then
call TriggerExecute(Ed)
endif
else
call DisplayTextToPlayer(Player(xh),.0,.0,"|cffFF0000You have already voted for a draw!|r")
endif
endfunction
function yh takes integer Vg returns string
if(Vg==1)then
return"first"
endif
if(Vg==2)then
return"second"
endif
if(Vg==3)then
return"third"
endif
return"fourth"
endfunction
function zh takes nothing returns nothing
local integer Ah
local player p=GetTriggerPlayer()
if(not IsPlayerInForce(p,c4))then
if(C4==null)then
set C4=p
endif
call AdjustPlayerStateBJ(E4,GetTriggerPlayer(),PLAYER_STATE_RESOURCE_GOLD)
call DisplayTextToPlayer(p,.0,.0,"|cffFFFF80You receive |cffFFCC00"+I2S(E4)+"|cffFFFF80 gold for being the "+yh(F4)+" player that finishes a structure!")
set Ah=GetPlayerId(p)
set F8[Ah]=F8[Ah]+(E4)
set E4=E4-(5)
set F4=F4+1
if(F4>4)then
call DisableTrigger(D4)
else
call ForceAddPlayer(c4,p)
endif
endif
endfunction
function ah takes nothing returns nothing
set C4=null
call ForceClear(c4)
set E4=20
set F4=1
call EnableTrigger(D4)
endfunction
function Bh takes nothing returns nothing
call TriggerAddAction(D4,function zh)
call TriggerRegisterAnyUnitEventBJ(D4,EVENT_PLAYER_UNIT_CONSTRUCT_FINISH)
call DisableTrigger(D4)
endfunction
function bh takes nothing returns nothing
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\Barkskin\\BarkSkinTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\HowlOfTerror\\HowlCaster.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Units\\NightElf\\Wisp\\WispExplode.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIam\\AIamTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\AncestralSpirit\\AncestralSpiritCaster.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\TomeOfRetraining\\TomeOfRetrainingCaster.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Polymorph\\PolyMorphTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\ControlMagic\\ControlMagicTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIda\\AIdaCaster.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Feedback\\SpellBreakerAttack.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIvi\\AIviTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\TomeOfRetraining\\TomeOfRetrainingCaster.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Demon\\DarkPortal\\DarkPortalTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NEDeathMedium\\NEDeath.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\EntBirthTarget\\EntBirthTarget.mdl",.0,.0))
call DestroyEffect(AddSpecialEffect("mdx\\sfx\\sin2.mdx",.0,.0))
call KillUnit(CreateUnit(Player($D),'h00O',.0,.0,.0))
call KillUnit(CreateUnit(Player($D),'u006',.0,.0,.0))
call KillUnit(CreateUnit(Player($D),'h00C',.0,.0,.0))
call KillUnit(CreateUnit(Player($D),'h019',.0,.0,.0))
call KillUnit(CreateUnit(Player($D),'h00E',.0,.0,.0))
call KillUnit(CreateUnit(Player($D),'h017',.0,.0,.0))
call KillUnit(CreateUnit(Player($D),'h089',.0,.0,.0))
call KillUnit(CreateUnit(Player($D),'h00P',.0,.0,.0))
call KillUnit(CreateUnit(Player($D),'h018',.0,.0,.0))
call KillUnit(CreateUnit(Player($D),'h06P',.0,.0,.0))
call KillUnit(CreateUnit(Player($D),'h01A',.0,.0,.0))
endfunction
function Ch takes nothing returns nothing
call bh()
endfunction
function Dh takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitAlly(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)
set u=null
return Eh
endfunction
function Fh takes nothing returns nothing
local integer i=GetRandomInt(1,3)
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,G4)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
call UnitAddAbility(bj_groupRandomCurrentPick,'A03B')
call UnitAddAbility(bj_groupRandomCurrentPick,'A03A')
call UnitAddAbility(bj_groupRandomCurrentPick,'A03D')
call UnitAddAbility(bj_groupRandomCurrentPick,'A08L')
if(i==1)then
call UnitAddAbility(bj_groupRandomCurrentPick,'A05I')
call UnitAddAbility(bj_groupRandomCurrentPick,'A06W')
elseif(i==2)then
call UnitAddAbility(bj_groupRandomCurrentPick,'A08M')
call UnitAddAbility(bj_groupRandomCurrentPick,'A06Y')
else
call UnitAddAbility(bj_groupRandomCurrentPick,'A08R')
call UnitAddAbility(bj_groupRandomCurrentPick,'A06X')
endif
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\ReplenishHealth\\ReplenishHealthCasterOverhead.mdl",bj_groupRandomCurrentPick,"overhead"))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl",GetUnitX(r4),GetUnitY(r4)))
endfunction
function Gh takes nothing returns nothing
local unit c=CreateUnit(GetOwningPlayer(r4),'e008',GetUnitX(r4),GetUnitY(r4),.0)
call UnitAddAbility(c,'A031')
call IssueImmediateOrderById(c,$D009F)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=r4
call TriggerSleepAction(1.)
call SetUnitAnimation(c,"stand")
set c=null
endfunction
function Hh takes nothing returns nothing
local unit c
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,n7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set c=CreateUnit(GetOwningPlayer(r4),'e008',GetUnitX(r4),GetUnitY(r4),.0)
call UnitAddAbility(c,'A030')
call UnitShareVision(bj_groupRandomCurrentPick,g4,true)
call IssueTargetOrderById(c,$D02B6,bj_groupRandomCurrentPick)
call UnitShareVision(bj_groupRandomCurrentPick,g4,false)
call UnitApplyTimedLife(c,'BTLF',30.)
set c=r4
call TriggerSleepAction(.5)
call SetUnitAnimation(c,"attack")
call TriggerSleepAction(1.)
call SetUnitAnimation(c,"stand")
set c=null
endfunction
function lh takes nothing returns nothing
call gh('h02R',function Fh)
call Qg('h02P','o009')
call Qg('h02K','o007')
call Qg('h092','o00B')
call Qg('h035','o008')
call Qg('h036','o006')
call gh('h02O',function Gh)
call gh('h02N',function Hh)
call Qg('h029','o002')
call Qg('h02U','o004')
call Qg('h031','o005')
call Qg('h02B','o003')
call Qg('h02I','o001')
call fh('o000',900.)
call Qg('h02H','n00V')
call Qg('h05E','n01O')
endfunction
function Jh takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h02P')
set h4[id]=$DC
set i4[id]=$DC*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h02K')
set h4[id]=260
set i4[id]=260*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h092')
set h4[id]='d'
set i4[id]='d'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h035')
set h4[id]='d'
set i4[id]='d'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h036')
set h4[id]='d'
set i4[id]='d'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h029')
set h4[id]='n'
set i4[id]='n'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h02U')
set h4[id]='d'
set i4[id]='d'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h031')
set h4[id]=$F0
set i4[id]=$F0*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h02B')
set h4[id]=$AA
set i4[id]=$AA*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h02I')
set h4[id]=380
set i4[id]=380*.18/100.
set j4[id]=true
set k4[id]=true
set id=GetUnitPointValueByType('h02H')
set h4[id]=$C8
set i4[id]=$C8*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h05E')
set h4[id]=80
set i4[id]=80*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h02R')
set h4[id]=$FA
set i4[id]=$FA*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h02O')
set h4[id]=475
set i4[id]=475*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('o000')
set h4[id]=$AF
set i4[id]=$AF*.08/100.
set j4[id]=false
set id=GetUnitPointValueByType('h02N')
set h4[id]=270
set i4[id]=270*.09/100.
set j4[id]=false
endfunction
function Kh takes nothing returns nothing
call lh()
call Jh()
set G4=Filter(function Dh)
endfunction
function Lh takes nothing returns nothing
call PlaySoundBJ(Ve)
if(p8>0 and C4!=null)then
if(IsPlayerInForce(C4,J8))then
call TriggerExecute(Dd)
else
call TriggerExecute(cd)
endif
return
endif
call TriggerExecute(Ed)
endfunction
function Mh takes nothing returns nothing
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,10.,"1 minute before round ends!")
call TimerStart(H4,60.,false,function Lh)
call PlaySoundBJ(Ve)
endfunction
function Nh takes nothing returns nothing
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,10.,"3 minutes before round ends!")
call TimerStart(H4,120.,false,function Mh)
call PlaySoundBJ(Ve)
endfunction
function Oh takes nothing returns nothing
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,10.,"Warnning! 5 minutes before round ends!")
call TimerStart(H4,120.,false,function Nh)
call PlaySoundBJ(Ve)
endfunction
function Ph takes nothing returns nothing
if(H4!=null)then
call PauseTimer(H4)
endif
if(p8!=0)then
if(H4==null)then
set H4=CreateTimer()
endif
call TimerStart(H4,(IAbsBJ(p8)-5)*60.,false,function Oh)
endif
endfunction
function Qh takes nothing returns boolean
local unit u=GetFilterUnit()
local real r=GetWidgetLife(u)
local boolean Eh=r>.405 and IsUnitEnemy(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)and IsUnitType(u,UNIT_TYPE_GROUND)and GetUnitAbilityLevel(u,'A08H')<=0 and GetUnitAbilityLevel(u,'A0BG')<=0 and GetUnitAbilityLevel(u,'B012')<=0 and GetUnitAbilityLevel(u,'BHbn')<=0 and((GetUnitState(u,UNIT_STATE_MAX_MANA)>100.and r<=600.)or r<=300.)
set u=null
return Eh
endfunction
function Rh takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitEnemy(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)and IsUnitType(u,UNIT_TYPE_GROUND)and GetUnitAbilityLevel(u,'Avul')<=0 and GetUnitAbilityLevel(u,'A08H')<=0 and GetUnitAbilityLevel(u,'A0BG')<=0 and GetUnitAbilityLevel(u,'B012')<=0 and GetUnitAbilityLevel(u,'BHbn')<=0
set u=null
return Eh
endfunction
function Sh takes nothing returns boolean
local unit u=GetFilterUnit()
local real r=GetWidgetLife(u)
local boolean Eh=r>.405 and IsUnitAlly(u,g4)and IsUnitType(u,UNIT_TYPE_STRUCTURE)and GetUnitState(u,UNIT_STATE_MAX_LIFE)-r>50.
set u=null
return Eh
endfunction
function Th takes nothing returns boolean
local unit u=GetFilterUnit()
local real r=GetWidgetLife(u)
local boolean Eh=r>.405 and IsUnitAlly(u,g4)and IsUnitType(u,UNIT_TYPE_MECHANICAL)and GetUnitState(u,UNIT_STATE_MAX_LIFE)-r>50.
set u=null
return Eh
endfunction
function Uh takes unit u returns nothing
local integer Ug=GetUnitPointValue(u)
local integer id=GetUnitUserData(u)
set g4=GetOwningPlayer(u)
if(Ug==$81)then
if(I4[id]!=null and GetWidgetLife(I4[id])>.405 and IsUnitEnemy(I4[id],g4))then
if(GetUnitAbilityLevel(I4[id],'B012')>0 or GetUnitAbilityLevel(I4[id],'BHbn')>0)then
set I4[id]=null
elseif(not IssueTargetOrderById(u,$D000F,I4[id]))then
call IssuePointOrderById(u,$D0012,GetUnitX(I4[id]),GetUnitY(I4[id]))
endif
elseif(GetUnitAbilityLevel(u,'B012')>0 or IssueImmediateOrderById(u,$D00A1))then
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,L4)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,M4)
set bj_groupRandomCurrentPick=FirstOfGroup(f4)
endif
if(bj_groupRandomCurrentPick==null)then
call IssuePointOrderById(u,$D0012,GetUnitX(u),GetUnitY(u))
else
set I4[id]=bj_groupRandomCurrentPick
call IssuePointOrderById(u,$D0012,GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick))
endif
else
call IssuePointOrderByIdLoc(u,$D000F,r8[N8[GetPlayerId(g4)]])
endif
elseif(Ug==$82)then
if(I4[id]==null)then
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,N4)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,O4)
set bj_groupRandomCurrentPick=FirstOfGroup(f4)
endif
set I4[id]=u
if(bj_groupRandomCurrentPick==null)then
set J4[id]=GetUnitX(u)
set K4[id]=GetUnitY(u)
else
set J4[id]=GetUnitX(bj_groupRandomCurrentPick)
set K4[id]=GetUnitY(bj_groupRandomCurrentPick)
endif
call IssuePointOrderById(u,$D000F,J4[id],K4[id])
else
call IssuePointOrderById(u,$D000F,J4[id],K4[id])
endif
endif
endfunction
function Vh takes unit u returns nothing
local integer i=0
loop
exitwhen l4[i]==false
set i=i+1
endloop
set l4[i]=true
set I4[i]=null
call SetUnitUserData(u,i)
endfunction
function Wh takes nothing returns nothing
set L4=Filter(function Qh)
set M4=Filter(function Rh)
set N4=Filter(function Sh)
set O4=Filter(function Th)
endfunction
function Xh takes boolean Yh returns location
local integer i=0
if(not Yh)then
set i=6
endif
loop
if(not Q4[i])then
set Q4[i]=true
return P4[i]
endif
set i=i+1
exitwhen i>$B
endloop
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"GENERAL FAILURE AT MODULE 'SP:GMR'. PLEASE REPORT ABOUT THIS BUG!")
return Location(.0,.0)
endfunction
function Zh takes location di returns nothing
local integer i=0
loop
if(di==P4[i])then
set Q4[i]=false
return
endif
set i=i+1
exitwhen i>$B
endloop
endfunction
function ei takes nothing returns nothing
local integer i=0
loop
set P4[i]=GetPlayerStartLocationLoc(Player(i))
set i=i+1
exitwhen i>$B
endloop
endfunction
function fi takes nothing returns nothing
local destructable d=GetTriggerDestructable()
local timer t=CreateTimer()
call TimerStart(t,30.,false,null)
loop
call TriggerSleepAction(1.)
exitwhen TimerGetRemaining(t)<.5
endloop
call PauseTimer(t)
call DestroyTimer(t)
set t=null
call DestructableRestoreLife(d,GetDestructableMaxLife(d),true)
set d=null
endfunction
function gi takes nothing returns nothing
call TriggerRegisterDeathEvent(R4,GetEnumDestructable())
endfunction
function hi takes nothing returns boolean
local destructable d=GetFilterDestructable()
local integer t=GetDestructableTypeId(d)
local boolean Eh=t=='ATtc' or t=='ATtr' or t=='B001' or t=='B000' or t=='ITtw' or t=='ITtc'
set d=null
return Eh
endfunction
function ii takes nothing returns nothing
local boolexpr f
if(S4)then
return
endif
set S4=true
set f=Filter(function hi)
call EnumDestructablesInRect(bj_mapInitialPlayableArea,f,function gi)
call DestroyBoolExpr(f)
set f=null
call TriggerAddAction(R4,function fi)
endfunction
function ji takes nothing returns integer
local integer u=ng()
set vf[u]=0
return u
endfunction
function ki takes integer og,integer mi returns nothing
set tf[uf[og]+vf[og]]=mi
set vf[og]=vf[og]+1
endfunction
function ni takes integer og,integer mi returns nothing
local integer i=0
loop
exitwhen tf[uf[og]+i]==mi or i>=vf[og]
set i=i+1
endloop
if(i>=vf[og])then
return
endif
set vf[og]=vf[og]-1
set tf[uf[og]+i]=tf[uf[og]+vf[og]]
endfunction
function oi takes integer og returns integer
return tf[uf[og]+GetRandomInt(0,vf[og]-1)]
endfunction
function pi takes force f returns player
local integer i=0
loop
if(IsPlayerInForce(Player(i),f))then
return Player(i)
endif
set i=i+1
exitwhen i>$B
endloop
return null
endfunction
function qi takes force f1,force f2 returns nothing
local integer i=0
local player p
loop
set p=Player(i)
if(IsPlayerInForce(p,f2)and not IsPlayerInForce(p,f1))then
call ForceAddPlayer(f1,p)
endif
set i=i+1
exitwhen i>$B
endloop
endfunction
function ri takes nothing returns integer
local integer i=0
local integer j=0
loop
if(IsPlayerInForce(Player(i),J8)and v7[i]!=null)then
set j=j+1
endif
set i=i+1
exitwhen i>$B
endloop
return j
endfunction
function si takes nothing returns integer
local integer i=0
local integer j=0
loop
if(IsPlayerInForce(Player(i),K8)and v7[i]!=null)then
set j=j+1
endif
set i=i+1
exitwhen i>$B
endloop
return j
endfunction
function ti takes integer Sg returns string
if(Sg=='h00O')then
return"Chaos Legions"
elseif(Sg=='u006')then
return"Corrupted Conglomerate"
elseif(Sg=='h00C')then
return"Human Alliance"
elseif(Sg=='h019')then
return"Orcish Horde"
elseif(Sg=='h00E')then
return"Naga Faction"
elseif(Sg=='h017')then
return"Northern Realms"
elseif(Sg=='h089')then
return"Night Elfs"
elseif(Sg=='h00P')then
return"Elven Union"
elseif(Sg=='h018')then
return"Undead Forces"
elseif(Sg=='h06P')then
return"Mech Coalition"
elseif(Sg=='h01A')then
return"Nature Force"
endif
return"Default race name"
endfunction
function ui takes integer xh returns nothing
local string vi=ti(x8[xh])
if(vi=="Default race name")then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+" skipped selection.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+" controls |cffFFFF00"+vi+"|r.")
endif
endfunction
function wi takes integer Sg returns integer
if(Sg=='h00O')then
return 0
endif
if(Sg=='u006')then
return 1
endif
if(Sg=='h00C')then
return 2
endif
if(Sg=='h019')then
return 3
endif
if(Sg=='h00E')then
return 4
endif
if(Sg=='h017')then
return 5
endif
if(Sg=='h089')then
return 6
endif
if(Sg=='h00P')then
return 7
endif
if(Sg=='h018')then
return 8
endif
if(Sg=='h06P')then
return 9
endif
if(Sg=='h01A')then
return $A
endif
return 0
endfunction
function xi takes boolean Yh returns player
local integer i=0
set T4=true
if(not Yh)then
set i=7
endif
loop
exitwhen IsPlayerInForce(Player(i),L8)or i>$B
set i=i+1
endloop
if(i>$B)then
if(Yh)then
return null
endif
set i=0
loop
exitwhen IsPlayerInForce(Player(i),L8)or i>6
set i=i+1
endloop
if(i>6)then
return null
endif
endif
return Player(i)
endfunction
function yi takes nothing returns nothing
local integer i=0
local integer j
loop
set j=0
loop
call SetPlayerAllianceStateBJ(Player(i),Player(j),0)
set j=j+1
exitwhen j>$B
endloop
set i=i+1
exitwhen i>$B
endloop
endfunction
function zi takes nothing returns nothing
local integer i=0
call yi()
call SetForceAllianceStateBJ(J8,J8,3)
call SetForceAllianceStateBJ(K8,K8,3)
loop
if(O8[i]!=null)then
call SetForceAllianceStateBJ(O8[i],bj_FORCE_PLAYER[i],5)
call SetForceAllianceStateBJ(bj_FORCE_PLAYER[i],O8[i],3)
endif
set i=i+1
exitwhen i>$B
endloop
call SetForceAllianceStateBJ(bj_FORCE_ALL_PLAYERS,bj_FORCE_PLAYER[$F],2)
call SetForceAllianceStateBJ(bj_FORCE_PLAYER[$F],bj_FORCE_ALL_PLAYERS,2)
set T4=false
endfunction
function Ai takes nothing returns nothing
local unit u=GetTriggerUnit()
local integer p=GetPlayerId(GetOwningPlayer(u))
if((not IsUnitType(u,UNIT_TYPE_FLYING))and p<$C and GetUnitPointValue(u)!=$81 and d7!=N8[p])then
if(d7!=-1)then
if(j7[d7]==k7)then
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,8.,w8[d7]+"|cffFFFF00 are no longer dominating!|r")
set U4[d7]=1.
endif
set j7[d7]=j7[d7]-1
endif
set d7=N8[p]
set j7[d7]=j7[d7]+1
call SetUnitColor(h7,V4[d7])
if(j7[d7]==k7)then
set U4[d7]=1.+.15
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,8.,w8[d7]+"|cffFFFF00 are dominating, they gain +"+I2S(R2I(.15*'d'))+"% income!|r")
endif
endif
set u=null
endfunction
function Bi takes nothing returns nothing
local unit u=GetTriggerUnit()
local integer p=GetPlayerId(GetOwningPlayer(u))
if((not IsUnitType(u,UNIT_TYPE_FLYING))and p<$C and GetUnitPointValue(u)!=$81 and e7!=N8[p])then
if(e7!=-1)then
if(j7[e7]==k7)then
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,8.,w8[e7]+"|cffFFFF00 are no longer dominating!|r")
set U4[e7]=1.
endif
set j7[e7]=j7[e7]-1
endif
set e7=N8[p]
set j7[e7]=j7[e7]+1
call SetUnitColor(i7,V4[e7])
if(j7[e7]==k7)then
set U4[e7]=1.+.15
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,8.,w8[e7]+"|cffFFFF00 are dominating, they gain +"+I2S(R2I(.15*'d'))+"% income!|r")
endif
endif
set u=null
endfunction
function Ci takes nothing returns nothing
local rect ci
if(not X4)then
set ci=Rect(-160.,448.,160.,1216.)
set Y4=CreateRegion()
call RegionAddRect(Y4,ci)
call RemoveRect(ci)
set ci=Rect(-160.,-1216.,160.,-448.)
set Z4=CreateRegion()
call RegionAddRect(Z4,ci)
call RemoveRect(ci)
set ci=null
set f7=CreateTrigger()
set g7=CreateTrigger()
call TriggerAddAction(f7,function Ai)
call TriggerAddAction(g7,function Bi)
call TriggerRegisterEnterRegion(f7,Y4,null)
call TriggerRegisterEnterRegion(g7,Z4,null)
set V4[0]=PLAYER_COLOR_RED
set V4[1]=PLAYER_COLOR_GREEN
set h7=CreateUnit(Player($F),'ncp2',.0,832.,.0)
set i7=CreateUnit(Player($F),'ncp2',.0,-832.,.0)
set X4=true
endif
if(N7==0)then
set k7=2
else
set k7=1
if(N7==1)then
call ShowUnit(i7,false)
call DisableTrigger(g7)
else
call ShowUnit(h7,false)
call DisableTrigger(f7)
endif
endif
call SetUnitColor(h7,W4)
call SetUnitColor(i7,W4)
set j7[0]=0
set j7[1]=0
set d7=-1
set e7=-1
set U4[0]=1.
set U4[1]=1.
endfunction
function Di takes unit u,real r returns nothing
local integer Ei=20+R2I((r-500.)/50)
local real x=GetUnitX(u)
local real y=GetUnitY(u)
local integer i=0
local string Fi=""
local real an
local effect array e
if(GetOwningPlayer(u)==GetLocalPlayer())then
set Fi="Abilities\\Spells\\NightElf\\Barkskin\\BarkSkinTarget.mdl"
endif
loop
exitwhen i>=Ei
set an=2.*bj_PI*i/Ei
set e[i]=AddSpecialEffect("Abilities\\Spells\\NightElf\\Barkskin\\BarkSkinTarget.mdl",x+r*Cos(an),y+r*Sin(an))
set i=i+1
endloop
call TriggerSleepAction(6.)
set i=0
loop
exitwhen i>=Ei
call DestroyEffect(e[i])
set e[i]=null
set i=i+1
endloop
endfunction
function Gi takes unit u returns nothing
call IssuePointOrderByIdLoc(u,$D0012,r8[N8[GetPlayerId(GetOwningPlayer(u))]+2])
endfunction
function Hi takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitEnemy(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)and IsUnitType(u,UNIT_TYPE_GROUND)and GetUnitAbilityLevel(u,'Avul')<=0 and GetUnitAbilityLevel(u,'A08H')<=0
set u=null
return Eh
endfunction
function Ii takes unit u returns nothing
call IssuePointOrderByIdLoc(u,$D000F,r8[N8[GetPlayerId(GetOwningPlayer(u))]])
endfunction
function li takes unit u returns nothing
if(IsUnitType(u,UNIT_TYPE_TAUREN))then
return
endif
if(GetUnitAbilityLevel(u,'A07M')>=1)then
call Uh(u)
else
call IssuePointOrderByIdLoc(u,$D000F,r8[N8[GetPlayerId(GetOwningPlayer(u))]])
endif
endfunction
function Ji takes unit u,integer Ki returns nothing
local player p=GetOwningPlayer(u)
local integer xh=GetPlayerId(p)
if(k8>0)then
if(l8[xh]+Ki>=k8)then
set Ki=k8-l8[xh]
if(Ki<=0)then
return
endif
set l8[xh]=k8
else
set l8[xh]=l8[xh]+(Ki)
endif
endif
call AdjustPlayerStateBJ(Ki,p,PLAYER_STATE_RESOURCE_LUMBER)
set bj_lastCreatedTextTag=CreateTextTag()
call SetTextTagText(bj_lastCreatedTextTag,I2S(Ki),.024)
call SetTextTagPos(bj_lastCreatedTextTag,GetUnitX(u)-36.,GetUnitY(u)-16.,.0)
call SetTextTagColor(bj_lastCreatedTextTag,0,$C8,80,$FF)
call SetTextTagPermanent(bj_lastCreatedTextTag,false)
call SetTextTagLifespan(bj_lastCreatedTextTag,3.)
call SetTextTagFadepoint(bj_lastCreatedTextTag,1.)
call SetTextTagVelocity(bj_lastCreatedTextTag,0,.06)
if(p!=GetLocalPlayer())then
call SetTextTagVisibility(bj_lastCreatedTextTag,false)
else
call SetTextTagVisibility(bj_lastCreatedTextTag,true)
endif
endfunction
function Li takes unit u returns nothing
local integer i=GetUnitAbilityLevel(u,'A09L')
if(i==2)then
call SetUnitAbilityLevel(u,'A09L',1)
call SetUnitState(u,UNIT_STATE_LIFE,GetWidgetLife(u)+200.)
call SetUnitState(u,UNIT_STATE_MANA,GetUnitState(u,UNIT_STATE_MANA)+100.)
call UnitAddAbility(u,'A09M')
call SetUnitAbilityLevel(u,'A09M',3)
call UnitRemoveAbility(u,'A09M')
else
call UnitRemoveAbility(u,'A09L')
endif
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIvi\\AIviTarget.mdl",u,"origin"))
endfunction
function Mi takes unit u returns nothing
local integer i=GetUnitAbilityLevel(u,'A09C')+1
if(i>=6)then
return
endif
call SetUnitAbilityLevel(u,'A09C',i)
call SetUnitAbilityLevel(u,'A09B',i)
call SetUnitAbilityLevel(u,'A00J',i)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl",u,"origin"))
endfunction
function Ni takes unit u returns boolean
if(GetUnitAbilityLevel(u,'A09L')>0)then
call Li(u)
return true
elseif(GetUnitTypeId(u)=='n01T')then
if(GetRandomInt(0,99)<60)then
call Mi(u)
return true
else
return false
endif
endif
return GetUnitAbilityLevel(u,'A070')>0
endfunction
function Oi takes unit u returns boolean
if(Ni(u))then
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl",u,"origin"))
return true
endif
return false
endfunction
function Pi takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitEnemy(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)and GetUnitAbilityLevel(u,'Avul')<=0 and GetUnitAbilityLevel(u,'A08H')<=0
set u=null
return Eh
endfunction
function Qi takes nothing returns nothing
call Uh(GetEnumUnit())
endfunction
function Ri takes nothing returns nothing
call ForGroup(o7,function Qi)
endfunction
function Si takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and GetUnitCurrentOrder(u)==0 and IsUnitType(u,UNIT_TYPE_SAPPER)and GetUnitAbilityLevel(u,'A07I')<=0 and GetUnitAbilityLevel(u,'A07M')<=0
set u=null
return Eh
endfunction
function Ti takes nothing returns nothing
call Ii(GetEnumUnit())
endfunction
function Ui takes nothing returns nothing
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,p7)
call ForGroup(f4,function Ti)
endfunction
function Vi takes nothing returns nothing
local boolean Wi=false
local integer i=0
loop
if(x8[i]=='h089' or x8[i]=='h06P')then
set Wi=true
endif
set i=i+1
exitwhen i>$B or Wi
endloop
if(Wi)then
call TimerStart(q7,2.,true,function Ri)
endif
endfunction
function Functions_CheckAndStartCommon takes nothing returns nothing
call TimerStart(r7,4.,true,function Ui)
endfunction
function Xi takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitType(u,UNIT_TYPE_PEON)
set u=null
return Eh
endfunction
function Yi takes nothing returns nothing
call SetUnitAnimation(GetEnumUnit(),"stand")
endfunction
function Zi takes nothing returns nothing
set n7=Filter(function Pi)
set p7=Filter(function Si)
set m7=Filter(function Hi)
set s7=Filter(function Xi)
endfunction
function dj takes integer x,integer y,string lb returns nothing
local integer i=0
loop
if(v7[i]!=null)then
set B7=MultiboardGetItem(v7[i],y,x)
call MultiboardSetItemValue(B7,lb)
call MultiboardReleaseItem(B7)
endif
set i=i+1
exitwhen i>$B
endloop
if(x==1)then
set B7=MultiboardGetItem(y7,1,(y-1)*6+1)
call MultiboardSetItemValue(B7,lb)
call MultiboardReleaseItem(B7)
elseif(x>2 and x<5)then
set B7=MultiboardGetItem(y7,1,(y-1)*6+x-1)
call MultiboardSetItemValue(B7,lb)
call MultiboardReleaseItem(B7)
elseif(x==5)then
set B7=MultiboardGetItem(y7,A7,$A)
call MultiboardSetItemValue(B7,lb)
call MultiboardReleaseItem(B7)
endif
endfunction
function ej takes integer x,integer y,string lb returns nothing
set B7=MultiboardGetItem(y7,x,y)
call MultiboardSetItemValue(B7,lb)
call MultiboardReleaseItem(B7)
endfunction
function fj takes nothing returns string
local string s=I2S(D7)
if(D7<$A)then
set s="0"+s
endif
return"|cffFFFF00"+I2S(c7)+"|cffFF8000:|cffFFFF00"+s+"|r"
endfunction
function gj takes nothing returns nothing
set D7=D7+1
if(D7==60)then
set D7=0
set c7=c7+1
endif
call dj(5,3,fj())
endfunction
function hj takes boolean fl returns nothing
set T7=not fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Artillery|r enabled. You can build structures that attack enemy structures.")
set M9='n01C'
set nd='A07T'
set l9='A01I'
set hd='A0BD'
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Artillery|r has been chosen. You cannot build structures that attack enemy structures.")
set M9='n021'
set nd='A08T'
set l9='A05H'
set hd='A0BQ'
endif
set bj_forLoopAIndex=0
set bj_forLoopAIndexEnd=$B
loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEnd
call SetPlayerUnitAvailableBJ('h001',fl,Player(bj_forLoopAIndex))
call SetPlayerUnitAvailableBJ('h048',fl,Player(bj_forLoopAIndex))
call SetPlayerUnitAvailableBJ('h01E',fl,Player(bj_forLoopAIndex))
set bj_forLoopAIndex=bj_forLoopAIndex+1
endloop
endfunction
function ij takes boolean fl returns nothing
set h8=fl
if(not fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No AFK|r mode has been disabled. Command -afk enabled.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No AFK|r has been chosen. Command -afk disabled.")
endif
endfunction
function jj takes nothing returns nothing
set o8=1
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Coin|r has been chosen. There will be a coin spawn every 40 seconds.")
endfunction
function kj takes nothing returns nothing
set o8=$A
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Crazy Coins|r has been chosen. Ten coins will spawn every 40 seconds.")
endfunction
function mj takes boolean fl returns nothing
set S7=fl
if(not fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Dual Race|r mode has been disabled.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Dual Race|r has been chosen. Each race can be chosen more than once per team.")
endif
endfunction
function nj takes boolean fl returns nothing
set d8=fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Unique Races|r has been chosen. Each race can be chosen only once (even across the teams).")
if((CountPlayersInForceBJ(J8)+CountPlayersInForceBJ(K8))+m8*2>$A)then
set d8=false
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Unique Races|r mode has been disabled due so many players.")
endif
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Unique Races|r mode has been disabled.")
endif
endfunction
function oj takes boolean fl returns nothing
set U7=fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Treasure Box|r mode has been disabled.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Treasure Box|r has been chosen. You cannot build Treasure Boxes.")
endif
set bj_forLoopAIndex=0
set bj_forLoopAIndexEnd=$B
loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEnd
call SetPlayerUnitAvailableBJ('h008',fl,Player(bj_forLoopAIndex))
set bj_forLoopAIndex=bj_forLoopAIndex+1
endloop
endfunction
function pj takes boolean fl returns nothing
set V7=fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Bounty|r mode has been disabled.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Bounty|r has been chosen. Neither units nor buildings will give bounty when destroyed.")
endif
set bj_forLoopAIndex=0
set bj_forLoopAIndexEnd=$B
loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEnd
call SetPlayerFlagBJ(PLAYER_STATE_GIVES_BOUNTY,fl,Player(bj_forLoopAIndex))
set bj_forLoopAIndex=bj_forLoopAIndex+1
endloop
endfunction
function qj takes boolean fl returns nothing
set W7=fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Specials|r mode has been disabled.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Specials|r has been chosen. You can't build special buildings except towers and Treasure Boxes.")
endif
set bj_forLoopAIndex=0
set bj_forLoopAIndexEnd=$B
loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEnd
call SetPlayerUnitAvailableBJ('h01P',fl,Player(bj_forLoopAIndex))
call SetPlayerUnitAvailableBJ('h056',fl,Player(bj_forLoopAIndex))
call SetPlayerUnitAvailableBJ('h014',fl,Player(bj_forLoopAIndex))
call SetPlayerUnitAvailableBJ('h03Q',fl,Player(bj_forLoopAIndex))
call SetPlayerUnitAvailableBJ('h01O',fl,Player(bj_forLoopAIndex))
call SetPlayerUnitAvailableBJ('o000',fl,Player(bj_forLoopAIndex))
call SetPlayerUnitAvailableBJ('h006',fl,Player(bj_forLoopAIndex))
call SetPlayerUnitAvailableBJ('n01J',fl,Player(bj_forLoopAIndex))
call SetPlayerUnitAvailableBJ('h073',fl,Player(bj_forLoopAIndex))
call SetPlayerUnitAvailableBJ('h05L',fl,Player(bj_forLoopAIndex))
set bj_forLoopAIndex=bj_forLoopAIndex+1
endloop
endfunction
function rj takes boolean fl returns nothing
set X7=fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Items|r mode has been disabled.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Items|r has been chosen. The castle doesn't sell any items.")
endif
endfunction
function sj takes boolean fl returns nothing
set Y7=fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Legendaries|r mode has been disabled.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Legendaries|r has been chosen. You don't get food to buy legendary buildings.")
endif
endfunction
function tj takes boolean fl returns nothing
set Z7=fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Rescue Strike|r mode has been disabled.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Rescue Strike|r has been chosen. Your worker doesn't have a Rescue Strike!")
endif
endfunction
function uj takes integer vj returns nothing
if(vj<$96)then
set k8=-1
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Lumber Limit|r mode has been disabled.")
else
set k8=vj
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Lumber Limit|r has been set to |cffFFFF00"+I2S(k8)+"|r.")
endif
endfunction
function wj takes integer vj returns nothing
set Q7=IMaxBJ(IMinBJ(vj,'x'),2)
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Income Timer|r has been set to |cffFFFF00"+I2S(Q7)+"|r.")
endfunction
function xj takes integer yj returns nothing
set j8=yj
if(j8==1)then
set U9=1000.
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00No Taxes|r has been chosen. You don't have to pay taxes on your income.")
elseif(j8==2)then
set U9=12.5
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00High Taxes|r has been chosen. Tax rate increases 10% every 12.5 income.")
endif
endfunction
function zj takes boolean fl returns nothing
set e8=fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Caging|r mode has been disabled.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Caging|r has been chosen. You can trap units with your buildings")
endif
endfunction
function Aj takes boolean fl returns nothing
set f8=fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Domination|r has been chosen. You gain extra income by controlling the lanes.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"TODO::SetDOMStatus(false)")
endif
endfunction
function aj takes integer yj returns nothing
local integer pc
if(yj==0)then
set m8=1
else
set m8=yj
endif
set pc=CountPlayersInForceBJ(J8)+CountPlayersInForceBJ(K8)
if(n8>0 and pc*n8>$A-m8)then
call DisplayTextToPlayer(Player(0),.0,.0,"|cffFF0000Too many players for Ban Race mode!|r")
set m8=0
return
elseif(pc>$A-m8)then
call DisplayTextToPlayer(Player(0),.0,.0,"|cffFF0000Too many players for Ban Race mode!|r")
set m8=0
return
endif
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Ban Race|r has been chosen. Number of bans per team: |cffFFFF00"+I2S(yj)+"|r")
endfunction
function Bj takes integer yj returns nothing
local integer pc=(CountPlayersInForceBJ(J8)+CountPlayersInForceBJ(K8))*(yj-1)
if(yj<1 or yj>5)then
call DisplayTextToPlayer(Player(0),.0,.0,"|cffFF0000Wrong number of players per player! Must be between 2 and 4!|r")
return
endif
if(pc>CountPlayersInForceBJ(L8))then
call DisplayTextToPlayer(Player(0),.0,.0,"|cffFF0000Too many players for Multi Race mode!|r")
return
endif
set n8=yj
set O7=1
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Multiple Players|r has been chosen. Number of additional players per human player: |cffFFFF00"+I2S(yj)+"|r")
if(pc>$A and d8)then
call nj(false)
endif
endfunction
function bj takes boolean fl returns nothing
set g8=fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Stop-detection|r system has been activated. Any player will be detected on bug usage.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"TODO::SetSDStatus(false)")
endif
endfunction
function Cj takes boolean fl returns nothing
set i8=fl
if(fl)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Debuging|r is on.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Debuging|r is off.")
endif
endfunction
function cj takes integer Pg returns nothing
if(IAbsBJ(Pg)>5)then
set p8=Pg
if(Pg>0)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Round time limit for win|r has been activated. Round will automatically end after "+I2S(IAbsBJ(Pg))+" minutes and owner of first building will win.")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Round time limit for draw|r has been activated. Round will automatically end after "+I2S(IAbsBJ(Pg))+" minutes with draw result.")
endif
else
call DisplayTextToPlayer(Player(0),.0,.0,"|cffFF0000Wrong value of minutes for round time limitation! Must be more 5!|r")
endif
endfunction
function Dj takes nothing returns nothing
local integer i=0
local integer j
local player p
local unit u
loop
exitwhen i>$B
set j=1
set p=Player(i)
loop
set u=CreateUnitAtLoc(p,'tec0'+j,H7,.0)
call ShowUnit(u,false)
set j=j+1
exitwhen j>3
endloop
set i=i+1
endloop
endfunction
function Ej takes integer i returns nothing
set I8[i]=0
set V9[i]=.0
set z8[i]=-1
set A8[i]=-1
set a8[i]=-1
set B8[i]=-1
set b8[i]=-1
set C8[i]=-1
set c8[i]=-1
set D8[i]=-1
set E8[i]=-1
set F8[i]=-1
set G8[i]=-1
set H8[i]=-1
set l8[i]=0
endfunction
function Fj takes integer i returns nothing
set I8[i]=0
set V9[i]=.5
set z8[i]=0
set A8[i]=0
set a8[i]=0
set B8[i]=0
set b8[i]=0
set C8[i]=0
set c8[i]=0
set D8[i]=0
set E8[i]=0
set F8[i]=0
set G8[i]=0
set H8[i]=0
set l8[i]='}'
endfunction
function Gj takes integer xh returns string
local playercolor pc=GetPlayerColor(Player(xh))
local string Eh
if(pc==PLAYER_COLOR_RED)then
set Eh="|cffff0000"
elseif(pc==PLAYER_COLOR_BLUE)then
set Eh="|cff0000FF"
elseif(pc==PLAYER_COLOR_CYAN)then
set Eh="|cff00FFFF"
elseif(pc==PLAYER_COLOR_PURPLE)then
set Eh="|cff800080"
elseif(pc==PLAYER_COLOR_YELLOW)then
set Eh="|cffFFFF00"
elseif(pc==PLAYER_COLOR_ORANGE)then
set Eh="|cffFFCC00"
elseif(pc==PLAYER_COLOR_GREEN)then
set Eh="|cff00ff00"
elseif(pc==PLAYER_COLOR_PINK)then
set Eh="|cffff00ff"
elseif(pc==PLAYER_COLOR_LIGHT_GRAY)then
set Eh="|cffc0c0c0"
elseif(pc==PLAYER_COLOR_LIGHT_BLUE)then
set Eh="|cffCCFFFF"
elseif(pc==PLAYER_COLOR_AQUA)then
set Eh="|cff087329"
elseif(pc==PLAYER_COLOR_BROWN)then
set Eh="|cffC16D00"
else
set Eh="|CFFFFFFFF"
endif
set pc=null
return Eh
endfunction
function Hj takes integer xh returns nothing
set Q8[xh]=Gj(xh)+GetPlayerName(Player(xh))+"|r"
endfunction
function Ij takes nothing returns nothing
local player p=GetEnumPlayer()
local integer i=GetPlayerId(p)
call ForceRemovePlayer(J8,p)
call ForceRemovePlayer(K8,p)
call ForceAddPlayer(L8,p)
set w7[i]=null
endfunction
function lj takes nothing returns nothing
local integer i=0
local integer j
local player p
local boolean Jj
loop
if(O8[i]!=null)then
call ForForce(O8[i],function Ij)
call SetPlayerName(Player(i),a7[i])
endif
set i=i+1
exitwhen i>$B
endloop
set i=0
loop
if(O8[i]!=null)then
set j=1
loop
set Jj=IsPlayerInForce(Player(i),J8)
set p=xi(Jj)
call ForceRemovePlayer(L8,p)
call ForceAddPlayer(O8[i],p)
if(Jj)then
call ForceAddPlayer(J8,p)
set y8[GetPlayerId(p)]=Rf(y8[i],96.*j,.0)
else
call ForceAddPlayer(K8,p)
set y8[GetPlayerId(p)]=Rf(y8[i],96.*j,180.)
endif
call SetPlayerName(p,a7[i])
set Q8[GetPlayerId(p)]=Gj(GetPlayerId(p))+GetPlayerName(p)+"|r"
set N8[GetPlayerId(p)]=N8[i]
set j=j+1
exitwhen j>=n8
endloop
endif
set i=i+1
exitwhen i>$B
endloop
endfunction
function Kj takes nothing returns nothing
local integer i=0
local player p=Player($C)
set G7=Rect(-288.,3296.,-96.,3488.)
loop
set N8[i]=0
if(GetPlayerSlotState(Player(i))==PLAYER_SLOT_STATE_PLAYING)then
call ForceAddPlayer(J8,Player(i))
call CreateFogModifierRectBJ(true,Player(i),FOG_OF_WAR_VISIBLE,G7)
set y8[i]=Xh(true)
set O8[i]=CreateForce()
set a7[i]=GetPlayerName(Player(i))
elseif(GetPlayerSlotState(Player(i))==PLAYER_SLOT_STATE_EMPTY)then
call ForceAddPlayer(L8,Player(i))
endif
set N8[i+6]=1
if(GetPlayerSlotState(Player(i+6))==PLAYER_SLOT_STATE_PLAYING)then
call ForceAddPlayer(K8,Player(i+6))
call CreateFogModifierRectBJ(true,Player(i+6),FOG_OF_WAR_VISIBLE,G7)
set y8[i+6]=Xh(false)
set O8[i+6]=CreateForce()
set a7[i+6]=GetPlayerName(Player(i+6))
elseif(GetPlayerSlotState(Player(i+6))==PLAYER_SLOT_STATE_EMPTY)then
call ForceAddPlayer(L8,Player(i+6))
endif
set i=i+1
exitwhen i>=6
endloop
set H7=Location(-192.,3392.)
set r8[0]=GetRectCenter(Te)
set r8[1]=GetRectCenter(Se)
set r8[2]=GetRectCenter(Se)
set r8[3]=GetRectCenter(Te)
set t8[0]=Re
set t8[1]=Qe
set w8[0]="|cffff0303Western Forces|r"
set w8[1]="|cff20c000Eastern Forces|r"
set i=0
loop
call GroupAddUnit(F7,CreateUnit(p,'h00L',-192.,3392.,270.))
set i=i+1
exitwhen i>33
endloop
set p=Player($F)
call CreateUnit(p,'h00L',-192.,3392.,270.)
call CreateUnit(p,'nshp',320.,1856.,270.)
call SetUnitColor(CreateUnit(p,'nmrk',-256.,-2816.,270.),ConvertPlayerColor(0))
call CreateUnit(p,'nder',-4735.4,3246.1,109.526)
call CreateUnit(p,'nfro',-1091.1,2532.8,224.842)
call CreateUnit(p,'nfro',-1750.8,3170.3,12.503)
call CreateUnit(p,'nfro',-4208.5,-3103.9,62.844)
call CreateUnit(p,'nrac',3575.1,-3410.6,28.565)
call CreateUnit(p,'nrac',215.3,-2989.1,39.991)
call CreateUnit(p,'nder',-734.9,-2927.2,354.77)
call CreateUnit(p,'nder',-778.4,3161.3,100.297)
call CreateUnit(p,'nder',486.3,3092.6,147.507)
call CreateUnit(p,'nder',2097.6,2634.9,173.293)
call CreateUnit(p,'necr',2734.8,2968.,320.909)
call CreateUnit(p,'necr',-601.3,1917.2,359.418)
call CreateUnit(p,'necr',-2505.3,3205.6,108.405)
call CreateUnit(p,'necr',-2553.8,3097.9,314.669)
call CreateUnit(p,'nfro',4466.5,3139.7,42.463)
call CreateUnit(p,'nfro',539.6,2646.5,108.054)
call CreateUnit(p,'necr',-5469.2,2773.2,240.63)
call CreateUnit(p,'nrac',-3882.6,3455.9,171.348)
call CreateUnit(p,'necr',-2951.9,3480.5,75.248)
call CreateUnit(p,'nder',-1995.2,3031.8,320.569)
call CreateUnit(p,'nder',-4755.9,-3285.9,96.265)
call CreateUnit(p,'necr',-2813.4,-3182.2,270.799)
call CreateUnit(p,'nrac',-2009.7,-3134.2,263.79)
call CreateUnit(p,'nder',5212.3,-3150.6,44.199)
call CreateUnit(p,'nfro',4753.5,-3152.8,349.596)
call CreateUnit(p,'nrac',-10.6,3013.2,169.052)
call CreateUnit(p,'ndwm',1689.8,-2774.7,192.19)
call CreateUnit(p,'ndog',-3610.9,-3243.8,118.216)
call CreateUnit(p,'ndog',1334.7,2849.5,136.344)
call CreateUnit(p,'ndog',3868.8,3221.9,302.375)
call CreateUnit(p,'nshe',-5537.3,3457.1,52.22)
call CreateUnit(p,'nsno',824.5,3262.9,175.677)
call CreateUnit(p,'nsno',202.1,-2945.4,216.679)
call CreateUnit(p,'npnw',745.5,2441.4,238.74)
call CreateUnit(p,'npnw',-1503.3,3397.6,70.468)
call CreateUnit(p,'nhmc',-1045.4,2540.1,279.314)
call CreateUnit(p,'nskk',-1729.,3470.5,317.767)
call CreateUnit(p,'nskk',-2433.4,2555.1,311.109)
call CreateUnit(p,'nskk',3859.9,-3350.3,329.995)
call CreateUnit(p,'ncrb',4721.1,-3370.7,285.192)
call CreateUnit(p,'nalb',4473.6,-3164.3,324.601)
call CreateUnit(p,'nhmc',4158.9,-3098.4,273.93)
call Dj()
set bj_forLoopAIndex=0
set bj_forLoopAIndexEnd=$B
loop
exitwhen bj_forLoopAIndex>bj_forLoopAIndexEnd
call SetPlayerFlagBJ(PLAYER_STATE_GIVES_BOUNTY,true,Player(bj_forLoopAIndex))
set Q8[bj_forLoopAIndex]=Gj(bj_forLoopAIndex)+GetPlayerName(Player(bj_forLoopAIndex))+"|r"
set bj_forLoopAIndex=bj_forLoopAIndex+1
endloop
call SetMapFlag(MAP_LOCK_RESOURCE_TRADING,true)
call FogMaskEnable(false)
call FogEnable(false)
call CreateQuestBJ(0,"Game Modes","Gamemodes are entered by the red player in the first 20 seconds of game time. A gamemode consists of a dash followed by two characters and a number: The first character determines the race distribution. |cffFFFF00p :|r pick race |cffFFFF00d :|r draft race |cffFFFF00r :|r random race |cffFFFF00m :|r mirror mode (random) The second character determines how long races are kept: |cffFFFF00g :|r The race is determined in round one and then |cffFFFF80kept for the whole game|r |cffFFFF00r :|r The race is determined before |cffFFFF80EACH round|r The 3rd character is a number between |cffFFFF001|r and |cffFFFF006|r determining the number of wins for overall victory |cffFFFF00Examples:|r -|cffFF0000r|cff00FF00r|cffFFFF002|r would start a |cffFF0000RANDOM|r race |cff00FF00EACH ROUND|r game with |cffFFFF002 wins|r for overall victory -|cffFF0000p|cff00FF00g|cffFFFF004|r would start a |cffFF0000PICK|r race |cff00FF00ONCE FOR WHOLE GAME|r game with |cffFFFF004 wins|r for overall victory","ReplaceableTextures\\CommandButtons\\BTNPickUpItem.blp")
call CreateQuestBJ(0,"Modifications","TRIGSTR_005","ReplaceableTextures\\CommandButtons\\BTNSpy.blp")
call CreateQuestBJ(0,"Other Commands","|cffFFFF00Host Commands (red player only!):|r |cff80FF00-fillX|r : This command fills both Teams with AI players until the given Number is reached. |cff80FF00-skip|r : Use this command in the first 20 seconds to skip the remaining mode choose time and start round 1 immediately. |cff80FF00-roll|r : Shows a random value :E |cff80FF00-xrX|r : Increases the number of wins for overall victory by X. All players must agree to this change by typing -agree. |cff80FF00-roll|r : Shows a random value :E |cff80FF00-pause|r : Allows to pause start game timer |cffFFFF00Player Commands (all players):|r |cff80FF00-income|r : Shows a detailed overview about your income. |cff80FF00-armor|r : Shows a short description which damage type is good/bad against what armor. |cff80FF00-stats|r : Shows your current statistics. |cff80FF00-draw|r : Type it to vote for drawing the round. |cff80FF00-agree|r : Type it to agree with -xrX. |cff80FF00-afk|r : Type it to activate AI. |cff80FF00-mode|r : Shows a game config string.","ReplaceableTextures\\CommandButtons\\BTNAuraOfDarkness.blp")
call CreateQuestBJ(2,"First Match?","|cffFFFF80This is your very first match of Castle Fight?|r Well, no problem, this game is very easy (even if playing with real good strategy can be very difficult). Just pick a worker and start building. Listen to your teammates, you will learn fast. Read the basic hints in this questlog and when you have played a couple of games and want even more information and tactics about this game, visit |cffFFFF80castle-fight.net.ru|r for a detailed documentation. |cffFF0000Note that the game has more than one round, so please don't leave if your castle is about to fall. Another round may come after this one and you ruin the game by leaving after round 1.|r Good luck and have fun!","ReplaceableTextures\\CommandButtons\\BTNSelectHeroOff.blp")
call CreateQuestBJ(2,"Basic Hints","TRIGSTR_010","ReplaceableTextures\\CommandButtons\\BTNMilitia.blp")
call CreateQuestBJ(2,"About","TRIGSTR_011","ReplaceableTextures\\CommandButtons\\BTNTomeOfRetraining.blp")
endfunction
function Lj takes integer Rg,integer Ug returns nothing
local integer at
local real Mj=Y8[Rg]
local real Nj=.5*Y8[Rg]
if(Z8[Rg]>0)then
set at=Ug+4
set e9[at]=e9[at]+(Nj)
endif
set at=X8[Rg]
if(at==1)then
set e9[Ug+1]=e9[Ug+1]+(Mj)
set e9[Ug+2]=e9[Ug+2]+(Nj)
elseif(at==2)then
set e9[Ug+2]=e9[Ug+2]+(Mj)
set e9[Ug+3]=e9[Ug+3]+(Nj)
elseif(at==3)then
set e9[Ug+3]=e9[Ug+3]+(Mj)
set e9[Ug+1]=e9[Ug+1]+(Nj)
elseif(at==4)then
set e9[Ug+4]=e9[Ug+4]+(Mj)
if(Z8[Rg]<2)then
set e9[Ug+1]=e9[Ug+1]+(Nj)
set e9[Ug+2]=e9[Ug+2]+(Nj)
set e9[Ug+3]=e9[Ug+3]+(Nj)
endif
elseif(at==6)then
set e9[Ug+6]=e9[Ug+6]+(Mj*1.5)
set e9[Ug+1]=e9[Ug+1]+(Nj)
set e9[Ug+2]=e9[Ug+2]+(Nj)
set e9[Ug+3]=e9[Ug+3]+(Nj)
elseif(at==5)then
set e9[Ug+5]=e9[Ug+5]+(Mj)
endif
set e9[Ug+5]=e9[Ug+5]+(Nj)
endfunction
function Oj takes nothing returns nothing
local unit u=GetTriggerUnit()
local integer id=GetUnitPointValue(u)
local integer r=W8[id]
local integer a=id*7
local integer z=7*N8[GetPlayerId(GetOwningPlayer(u))]
if(r>0)then
set r=r+(z)
set V8[r]=V8[r]+(Y8[id])
call Lj(id,z)
endif
set u=null
endfunction
function Pj takes unit Qj,integer to returns boolean
local player p=GetOwningPlayer(Qj)
call SetUnitOwner(Qj,Player($F),false)
call SetUnitOwner(Qj,p,false)
return IssueImmediateOrderById(Qj,to)
endfunction
function Rj takes nothing returns nothing
if(GetExpiredTimer()==j9[0])then
set k9[0]=true
else
set k9[1]=true
endif
endfunction
function Sj takes integer xh returns boolean
if(GetUnitAbilityLevel(f9[xh],'A005')<=0)then
set m9[N8[xh]]=Player($E)
call ForceRemovePlayer(i9[N8[xh]],Player(xh))
else
set k9[N8[xh]]=false
set m9[N8[xh]]=Player(xh)
call TimerStart(j9[N8[xh]],10.,false,function Rj)
return Ag(f9[xh],h9[N8[xh]])
endif
return false
endfunction
function Tj takes integer xh returns nothing
local integer ai=7*N8[xh]+1
local integer bi=7*ModuloInteger(N8[xh]+1,2)+1
local real d1=V8[bi+5]-e9[ai+5]
local real d2=d1
local real t
local integer i=1
set q9=6
set r9=6
loop
set t=V8[bi]-e9[ai]
if(t>d1 and V8[bi]>e9[ai])then
set d1=t
set q9=i
elseif(t<d2)then
set d2=t
set r9=i
endif
set ai=ai+1
set bi=bi+1
set i=i+1
exitwhen i>=p9
endloop
endfunction
function Uj takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitType(u,UNIT_TYPE_PEON)
set u=null
return Eh
endfunction
function Vj takes nothing returns boolean
local unit u=GetTriggerUnit()
local integer Wj
local player p
if(IsUnitType(u,UNIT_TYPE_STRUCTURE))then
set Wj=N8[GetPlayerId(GetOwningPlayer(u))]
set h9[Wj]=u
set g4=GetOwningPlayer(u)
call GroupEnumUnitsInRange(f4,GetUnitX(u),GetUnitY(u),1590.1,n7)
set p=pi(i9[Wj])
if((GetWidgetLife(u)/GetUnitState(u,UNIT_STATE_MAX_LIFE)*100.<40.4 or CountUnitsInGroup(f4)>=20)and(k9[Wj]or m9[Wj]==p))then
call Sj(GetPlayerId(p))
endif
endif
set u=null
return false
endfunction
function Xj takes nothing returns boolean
local unit u=GetFilterUnit()
local real r=GetWidgetLife(u)
local boolean Eh=r>.405 and IsUnitAlly(u,g4)and IsUnitType(u,UNIT_TYPE_STRUCTURE)and GetUnitState(u,UNIT_STATE_MAX_LIFE)-r>50.
set u=null
return Eh
endfunction
function Yj takes integer Zj,integer dk,integer ek,integer fk returns integer
local integer v=rg()
local integer i=0
set zf[Af[v]]=Zj
set zf[Af[v]+1]=dk
set zf[Af[v]+2]=ek
set zf[Af[v]+3]=fk
loop
if(zf[Af[v]+i]!=0)then
set af[v]=i
endif
set i=i+1
exitwhen i>=4
endloop
return v
endfunction
function gk takes integer og,unit hk returns nothing
local integer i=af[og]-1
local integer ik=$A
local unit jk
set g4=GetOwningPlayer(hk)
loop
if(i<0)then
set bj_groupEnumTypeId=zf[Af[og]]
if(GetPlayerState(g4,PLAYER_STATE_RESOURCE_GOLD)>h4[GetUnitPointValueByType(bj_groupEnumTypeId)])then
set i=U8[GetPlayerId(g4)]
loop
call wg(i)
exitwhen IssueBuildOrderById(hk,bj_groupEnumTypeId,o,q)or ik<0
set ik=ik-1
call yg(i)
endloop
endif
exitwhen true
else
set bj_groupEnumTypeId=zf[Af[og]+i]
call GroupEnumUnitsOfPlayer(f4,g4,filterGetUnitsOfPlayerAndTypeId)
set jk=FirstOfGroup(f4)
if(jk==null)then
set i=i-1
else
if(GetPlayerState(g4,PLAYER_STATE_RESOURCE_GOLD)>h4[GetUnitPointValueByType(zf[Af[og]+i+1])])then
call Pj(jk,zf[Af[og]+i+1])
endif
set jk=null
exitwhen true
endif
endif
endloop
endfunction
function kk takes integer og,unit hk returns nothing
call gk(og,hk)
set bj_groupEnumTypeId=zf[Af[og]+af[og]]
call GroupEnumUnitsOfPlayer(f4,g4,filterGetUnitsOfPlayerAndTypeId)
set d9[GetPlayerId(g4)]=FirstOfGroup(f4)!=null
endfunction
function mk takes integer og returns integer
return W8[GetUnitPointValueByType(zf[Af[og]+af[og]])]
endfunction
function nk takes integer og,integer ok,integer pk returns nothing
set cf[Df[og]+ok*7+Ef[Ff[og]+ok]]=pk
set Ef[Ff[og]+ok]=Ef[Ff[og]+ok]+1
endfunction
function qk takes integer og,unit hk returns nothing
local integer i=0
local integer rk=-1
call Tj(GetPlayerId(GetOwningPlayer(hk)))
loop
if(mk(cf[Df[og]+q9*7+i])==r9)then
set rk=i
endif
set i=i+1
exitwhen i>Ef[Ff[og]+q9]
endloop
if(rk>-1)then
call gk(cf[Df[og]+q9*7+rk],hk)
else
call gk(cf[Df[og]+q9*7+GetRandomInt(0,Ef[Ff[og]+q9])],hk)
endif
endfunction
function sk takes integer og returns nothing
local integer i=0
loop
set Ef[Ff[og]+i]=Ef[Ff[og]+i]-1
set i=i+1
exitwhen i>=7
endloop
set If[lf[og]]=If[lf[og]]-1
set If[lf[og]+1]=If[lf[og]+1]-1
set If[lf[og]+2]=If[lf[og]+2]-1
set If[lf[og]+3]=If[lf[og]+3]-1
endfunction
function tk takes integer og,integer uk,integer pk returns nothing
set Gf[Hf[og]+4*uk+If[lf[og]+uk]]=pk
set If[lf[og]+uk]=If[lf[og]+uk]+1
endfunction
function vk takes integer og,unit hk returns nothing
local integer xh=GetPlayerId(GetOwningPlayer(hk))
if(Y7 and(not d9[xh]))then
if((not T7)and If[lf[og]+3]>=0)then
call kk(Gf[Hf[og]+4*3+GetRandomInt(0,If[lf[og]+3])],hk)
elseif(If[lf[og]]>=0)then
call kk(Gf[Hf[og]+4*0+GetRandomInt(0,If[lf[og]])],hk)
else
set d9[xh]=true
endif
elseif((not T7)and If[lf[og]+1]>=0)then
call gk(Gf[Hf[og]+4*1+GetRandomInt(0,If[lf[og]+1])],hk)
elseif(If[lf[og]+2]>=0)then
call gk(Gf[Hf[og]+4*2+GetRandomInt(0,If[lf[og]+2])],hk)
else
call qk(og,hk)
endif
endfunction
function wk takes integer Sg returns integer
if(Sg=='h00O')then
return u9
endif
if(Sg=='u006')then
return v9
endif
if(Sg=='h00C')then
return w9
endif
if(Sg=='h019')then
return x9
endif
if(Sg=='h00E')then
return y9
endif
if(Sg=='h017')then
return z9
endif
if(Sg=='h089')then
return A9
endif
if(Sg=='h00P')then
return a9
endif
if(Sg=='h018')then
return B9
endif
if(Sg=='h06P')then
return b9
endif
if(Sg=='h01A')then
return C9
endif
return-1
endfunction
function xk takes nothing returns nothing
local integer i=0
if(n9)then
return
endif
loop
if(g9[i]and f9[i]!=null and GetWidgetLife(f9[i])>.405)then
if(h9[N8[i]]==null)then
if(GetUnitCurrentOrder(f9[i])==0)then
call IssuePointOrderByIdLoc(f9[i],$D022D,y8[i])
endif
elseif(GetWidgetLife(h9[N8[i]])>.405 and GetUnitState(h9[N8[i]],UNIT_STATE_MAX_LIFE)-GetWidgetLife(h9[N8[i]])>50.)then
call IssueTargetOrderById(f9[i],$D0038,h9[N8[i]])
else
set g4=Player(i)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,t9)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
set h9[N8[i]]=bj_groupRandomCurrentPick
endif
endif
set i=i+1
exitwhen i>$B
endloop
endfunction
function yk takes nothing returns nothing
local integer i=0
local integer t
if(n9)then
return
endif
loop
if(g9[i])then
set g4=Player(i)
if(f9[i]==null or GetWidgetLife(f9[i])<=.405)then
call GroupEnumUnitsOfPlayer(f4,g4,s9)
set f9[i]=FirstOfGroup(f4)
if(f9[i]!=null)then
set c9[i]=wk(GetUnitTypeId(f9[i]))
call ForceAddPlayer(i9[N8[i]],g4)
endif
else
set t=GetPlayerState(Player(i),PLAYER_STATE_RESOURCE_LUMBER)
if(t<$7D0 or t>$BB8 or GetPlayerState(g4,PLAYER_STATE_RESOURCE_GOLD)>=$3E8)then
call qk(c9[i],f9[i])
else
call vk(c9[i],f9[i])
endif
endif
endif
set i=i+1
exitwhen i>$B
endloop
endfunction
function AILibrary_PrepareAI takes nothing returns nothing
call ExecuteFunc("zk")
endfunction
function Ak takes nothing returns nothing
local integer i=0
if(not o9)then
return
endif
loop
if(g9[i])then
if(IsPlayerInForce(Player(i),J8))then
set U8[i]=ModuloInteger(i,2)+2
elseif(IsPlayerInForce(Player(i),K8))then
set U8[i]=ModuloInteger(i,2)
endif
endif
set i=i+1
exitwhen i>$B
endloop
endfunction
function ak takes integer xh returns nothing
local string s
call ExecuteFunc("zk")
if(IsPlayerInForce(Player(xh),J8))then
set U8[xh]=ModuloInteger(xh,2)+2
elseif(IsPlayerInForce(Player(xh),K8))then
set U8[xh]=ModuloInteger(xh,2)
endif
set s=sg()
call SetPlayerName(Player(xh),s)
set a7[xh]=s
call Hj(xh)
set g9[xh]=true
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+" joined to game with AI savvy!")
endfunction
function Bk takes integer xh returns boolean
if(not g9[xh])then
return false
endif
set g9[xh]=false
call ForceRemovePlayer(i9[N8[xh]],Player(xh))
return true
endfunction
function bk takes nothing returns nothing
local integer i=0
loop
if(R8[i])then
call DisplayTextToPlayer(Player(i),.0,.0,"|cffCA0000WARNING|r: AI took control over your units! Type -afk to disable AI.")
endif
set i=i+1
exitwhen i>$B
endloop
endfunction
function Ck takes integer xh returns nothing
if(R8[xh])then
set R8[xh]=false
call Bk(xh)
call SetPlayerName(Player(xh),a7[xh])
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+"|cffCA0000 is no longer AFK!|r")
set S8=S8-1
if(S8==0)then
call PauseTimer(T8)
call DestroyTimer(T8)
set T8=null
endif
else
set R8[xh]=true
call ExecuteFunc("zk")
if(IsPlayerInForce(Player(xh),J8))then
set U8[xh]=ModuloInteger(xh,2)+2
elseif(IsPlayerInForce(Player(xh),K8))then
set U8[xh]=ModuloInteger(xh,2)
endif
call SetPlayerName(Player(xh),"[AFK] "+a7[xh])
set g9[xh]=true
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+"|cffCA0000 is AFK!|r AI took control over his units.")
if(S8==0)then
set T8=CreateTimer()
call TimerStart(T8,5.,true,function bk)
endif
set S8=S8+1
endif
endfunction
function ck takes nothing returns nothing
local integer i=0
local boolean b=false
loop
if(GetPlayerController(Player(i))==MAP_CONTROL_COMPUTER)then
call ak(i)
set b=true
endif
set i=i+1
exitwhen i>$B
endloop
if(b)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"AI functionality damaged: you are playing with computer slots. In future use command -fill.")
endif
endfunction
function Dk takes nothing returns nothing
local integer i=0
loop
set V8[i]=0
set e9[i]=0
set i=i+1
exitwhen i>7*2
endloop
set i=0
loop
set d9[i]=false
exitwhen i>$B
set i=i+1
endloop
call ug()
call ForceClear(i9[0])
call ForceClear(i9[1])
call PauseTimer(j9[0])
call PauseTimer(j9[1])
set k9[0]=true
set k9[1]=true
set m9[0]=Player($E)
set m9[1]=Player($E)
set n9=false
endfunction
function AILibrary_Sleep takes nothing returns nothing
set n9=true
endfunction
function zk takes nothing returns nothing
local integer i
local trigger t
local integer Ek
local integer Fk
local integer Gk
local integer Hk
local integer Ik
local integer lk
local integer Jk
local integer Kk
local integer Lk
local integer Mk
local integer Nk
local integer Ok
local integer Pk
local integer Qk
local integer Rk
local integer Sk
local integer Tk
local integer Uk
local integer Vk
local integer Wk
local integer Xk
local integer Yk
local integer Zk
local integer dm
local integer em
local integer fm
local integer gm
local integer hm
local integer im
local integer jm
local integer km
local integer mm
local integer nm
local integer om
local integer pm
local integer qm
local integer rm
local integer sm
local integer tm
local integer um
local integer vm
if(o9)then
return
endif
call tg()
call ug()
set s9=Filter(function Uj)
set t9=Filter(function Xj)
call TimerStart(CreateTimer(),2.,true,function yk)
call TimerStart(CreateTimer(),5.,true,function xk)
set t=CreateTrigger()
call TriggerAddAction(t,function Oj)
call TriggerRegisterAnyUnitEventBJ(t,EVENT_PLAYER_UNIT_CONSTRUCT_FINISH)
call TriggerRegisterAnyUnitEventBJ(t,EVENT_PLAYER_UNIT_UPGRADE_FINISH)
set t=CreateTrigger()
call TriggerAddCondition(t,Condition(function Vj))
call TriggerRegisterAnyUnitEventBJ(t,EVENT_PLAYER_UNIT_ATTACKED)
set t=null
set i9[0]=CreateForce()
set i9[1]=CreateForce()
set j9[0]=CreateTimer()
set j9[1]=CreateTimer()
set k9[0]=true
set k9[1]=true
set m9[0]=Player($E)
set m9[1]=Player($E)
set u9=qg()
set Ek=Yj('h025',0,0,0)
set Fk=Yj('h009',0,0,0)
set Gk=Yj('h007',0,0,0)
set Hk=Yj('h01C',0,0,0)
call nk(u9,2,Yj('h01I','h026',0,0))
call nk(u9,2,Yj('h01D','h03G',0,0))
call nk(u9,3,Hk)
call nk(u9,6,Ek)
call nk(u9,6,Fk)
call nk(u9,6,Gk)
call nk(u9,1,Ek)
call nk(u9,1,Hk)
call nk(u9,4,Gk)
call nk(u9,5,Fk)
set i=GetUnitPointValueByType('h025')
set W8[i]=5
set X8[i]=6
set Y8[i]=1.
set Z8[i]=0
set i=GetUnitPointValueByType('h009')
set W8[i]=4
set X8[i]=6
set Y8[i]=1.
set Z8[i]=1
set i=GetUnitPointValueByType('h007')
set W8[i]=3
set X8[i]=6
set Y8[i]=1.5
set Z8[i]=1
set i=GetUnitPointValueByType('h01C')
set W8[i]=1
set X8[i]=6
set Y8[i]=1.
set Z8[i]=1
set i=GetUnitPointValueByType('h01I')
set W8[i]=1
set X8[i]=2
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h026')
set W8[i]=1
set X8[i]=2
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h01D')
set W8[i]=2
set X8[i]=2
set Y8[i]=.9
set Z8[i]=0
set i=GetUnitPointValueByType('h03G')
set W8[i]=2
set X8[i]=2
set Y8[i]=.4
set Z8[i]=0
call tk(u9,0,Yj('h01M','h01W','h01X',0))
call tk(u9,3,Yj('h01E',0,0,0))
call tk(u9,2,Yj('h01F',0,0,0))
call sk(u9)
set w9=qg()
set Ik=Yj('h000','h039',0,0)
set lk=Yj('h003','h05D',0,0)
set Jk=Yj('h037','h038',0,0)
set Kk=Yj('h015',0,0,0)
call nk(w9,1,lk)
call nk(w9,2,Ik)
call nk(w9,2,lk)
call nk(w9,2,Jk)
call nk(w9,3,Jk)
call nk(w9,3,Kk)
call nk(w9,4,Yj('h003','h0A1',0,0))
call nk(w9,5,Yj('h004',0,0,0))
call nk(w9,5,Kk)
call nk(w9,6,Jk)
call nk(w9,6,Yj('h00K',0,0,0))
set i=GetUnitPointValueByType('h000')
set W8[i]=3
set X8[i]=2
set Y8[i]=.4
set Z8[i]=0
set i=GetUnitPointValueByType('h039')
set W8[i]=3
set X8[i]=2
set Y8[i]=.8
set Z8[i]=0
set i=GetUnitPointValueByType('h003')
set W8[i]=2
set X8[i]=1
set Y8[i]=.5
set Z8[i]=1
set i=GetUnitPointValueByType('h05D')
set W8[i]=2
set X8[i]=1
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h0A1')
set W8[i]=2
set X8[i]=1
set Y8[i]=.7
set Z8[i]=2
set i=GetUnitPointValueByType('h004')
set W8[i]=1
set X8[i]=5
set Y8[i]=.9
set Z8[i]=0
set i=GetUnitPointValueByType('h015')
set W8[i]=4
set X8[i]=3
set Y8[i]=1.
set Z8[i]=1
set i=GetUnitPointValueByType('h037')
set W8[i]=3
set X8[i]=6
set Y8[i]=1.1
set Z8[i]=0
set i=GetUnitPointValueByType('h038')
set W8[i]=3
set X8[i]=6
set Y8[i]=.6
set Z8[i]=0
set i=GetUnitPointValueByType('h00K')
set W8[i]=5
set X8[i]=6
set Y8[i]=1.
set Z8[i]=1
call tk(w9,0,Yj('h05G',0,0,0))
call tk(w9,1,Yj('h001',0,0,0))
call sk(w9)
set v9=qg()
set Lk=Yj('h04L','h04N',0,0)
set Mk=Yj('h04O','h04M',0,0)
set Nk=Yj('h04Q','h04P',0,0)
set Ok=Yj('h04U',0,0,0)
call nk(v9,1,Yj('h04S',0,0,0))
call nk(v9,2,Yj('h04V','h04W',0,0))
call nk(v9,3,Lk)
call nk(v9,3,Mk)
call nk(v9,3,Nk)
call nk(v9,4,Lk)
call nk(v9,4,Ok)
call nk(v9,5,Nk)
call nk(v9,5,Mk)
call nk(v9,6,Ok)
set i=GetUnitPointValueByType('h04S')
set W8[i]=2
set X8[i]=1
set Y8[i]=1.
set Z8[i]=0
set i=GetUnitPointValueByType('h04V')
set W8[i]=3
set X8[i]=2
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h04W')
set W8[i]=3
set X8[i]=2
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h09Y')
set W8[i]=3
set X8[i]=2
set Y8[i]=1.
set Z8[i]=0
set i=GetUnitPointValueByType('h04L')
set W8[i]=1
set X8[i]=3
set Y8[i]=.6
set Z8[i]=1
set i=GetUnitPointValueByType('h04N')
set W8[i]=1
set X8[i]=3
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h04O')
set W8[i]=4
set X8[i]=3
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h04M')
set W8[i]=4
set X8[i]=3
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h04Q')
set W8[i]=3
set X8[i]=5
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h04P')
set W8[i]=3
set X8[i]=5
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h04U')
set W8[i]=2
set X8[i]=6
set Y8[i]=1.2
set Z8[i]=1
call tk(v9,0,Yj('h04T',0,0,0))
call tk(v9,0,Yj('h04V','h04W','h09Y',0))
call tk(v9,2,Yj('h04K',0,0,0))
call tk(v9,2,Yj('h04R',0,0,0))
call sk(v9)
set x9=qg()
set Pk=Yj('h029','h02U','h031',0)
set Qk=Yj('h02H','h05E',0,0)
set Rk=Yj('h02I',0,0,0)
set Sk=Yj('h02B',0,0,0)
call nk(x9,1,Yj('h02K','h092',0,0))
call nk(x9,1,Yj('h02K','h035',0,0))
call nk(x9,1,Yj('h02K','h036',0,0))
call nk(x9,1,Yj('h02P',0,0,0))
call nk(x9,2,Pk)
call nk(x9,2,Qk)
call nk(x9,3,Pk)
call nk(x9,3,Sk)
call nk(x9,4,Qk)
call nk(x9,5,Rk)
call nk(x9,6,Pk)
call nk(x9,6,Rk)
call nk(x9,6,Sk)
set i=GetUnitPointValueByType('h02K')
set W8[i]=1
set X8[i]=1
set Y8[i]=.8
set Z8[i]=1
set i=GetUnitPointValueByType('h092')
set W8[i]=1
set X8[i]=1
set Y8[i]=.4
set Z8[i]=1
set i=GetUnitPointValueByType('h035')
set W8[i]=1
set X8[i]=1
set Y8[i]=.4
set Z8[i]=1
set i=GetUnitPointValueByType('h036')
set W8[i]=1
set X8[i]=1
set Y8[i]=.4
set Z8[i]=1
set i=GetUnitPointValueByType('h02P')
set W8[i]=4
set X8[i]=1
set Y8[i]=.9
set Z8[i]=1
set i=GetUnitPointValueByType('h029')
set W8[i]=3
set X8[i]=2
set Y8[i]=.6
set Z8[i]=0
set i=GetUnitPointValueByType('h02U')
set W8[i]=3
set X8[i]=2
set Y8[i]=.6
set Z8[i]=0
set i=GetUnitPointValueByType('h031')
set W8[i]=3
set X8[i]=2
set Y8[i]=.8
set Z8[i]=0
set i=GetUnitPointValueByType('h02H')
set W8[i]=2
set X8[i]=2
set Y8[i]=.8
set Z8[i]=1
set i=GetUnitPointValueByType('h05E')
set W8[i]=2
set X8[i]=2
set Y8[i]=.4
set Z8[i]=1
set i=GetUnitPointValueByType('h02B')
set W8[i]=5
set X8[i]=3
set Y8[i]=.9
set Z8[i]=1
set i=GetUnitPointValueByType('h02I')
set W8[i]=2
set X8[i]=5
set Y8[i]=1.2
set Z8[i]=0
call tk(x9,0,Yj('h02O',0,0,0))
call tk(x9,2,Yj('h02R',0,0,0))
call tk(x9,2,Yj('h02N',0,0,0))
call sk(x9)
set y9=qg()
set Tk=Yj('h00F','h032',0,0)
set Uk=Yj('h020','h021','h022',0)
set Vk=Yj('h01B',0,0,0)
set Wk=Yj('h01Z',0,0,0)
set Xk=Yj('h00J',0,0,0)
call nk(y9,1,Tk)
call nk(y9,2,Uk)
call nk(y9,2,Vk)
call nk(y9,2,Xk)
call nk(y9,3,Tk)
call nk(y9,3,Uk)
call nk(y9,3,Vk)
call nk(y9,3,Yj('h01Y',0,0,0))
call nk(y9,4,Xk)
call nk(y9,4,Vk)
call nk(y9,4,Wk)
call nk(y9,5,Vk)
call nk(y9,5,Wk)
call nk(y9,6,Wk)
set i=GetUnitPointValueByType('h00F')
set W8[i]=3
set X8[i]=1
set Y8[i]=1.
set Z8[i]=0
set i=GetUnitPointValueByType('h032')
set W8[i]=3
set X8[i]=1
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h020')
set W8[i]=5
set X8[i]=2
set Y8[i]=.6
set Z8[i]=0
set i=GetUnitPointValueByType('h021')
set W8[i]=5
set X8[i]=2
set Y8[i]=.4
set Z8[i]=0
set i=GetUnitPointValueByType('h022')
set W8[i]=5
set X8[i]=2
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h01B')
set W8[i]=3
set X8[i]=5
set Y8[i]=1.1
set Z8[i]=1
set i=GetUnitPointValueByType('h01Z')
set W8[i]=5
set X8[i]=6
set Y8[i]=1.3
set Z8[i]=1
set i=GetUnitPointValueByType('h01Y')
set W8[i]=4
set X8[i]=3
set Y8[i]=.8
set Z8[i]=1
set i=GetUnitPointValueByType('h00J')
set W8[i]=2
set X8[i]=2
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h05F')
set W8[i]=2
set X8[i]=6
set Y8[i]=1.7
set Z8[i]=1
call tk(y9,0,Yj('h00J','h05F',0,0))
call tk(y9,0,Yj('h00N',0,0,0))
call tk(y9,2,Yj('h00I',0,0,0))
call tk(y9,2,Yj('h00M',0,0,0))
call sk(y9)
set z9=qg()
set Yk=Yj('h03S',0,0,0)
set Zk=Yj('h03I',0,0,0)
call nk(z9,1,Yj('h03U',0,0,0))
call nk(z9,1,Yj('h03T','h043',0,0))
call nk(z9,2,Yj('h049','h04F','h03W',0))
call nk(z9,2,Yk)
call nk(z9,2,Zk)
call nk(z9,3,Yj('h03K','h03J',0,0))
call nk(z9,3,Yk)
call nk(z9,3,Zk)
call nk(z9,4,Yk)
call nk(z9,4,Zk)
call nk(z9,5,Yk)
call nk(z9,5,Zk)
call nk(z9,6,Yk)
call nk(z9,6,Zk)
set i=GetUnitPointValueByType('h03U')
set W8[i]=3
set X8[i]=1
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h03T')
set W8[i]=2
set X8[i]=1
set Y8[i]=1.1
set Z8[i]=0
set i=GetUnitPointValueByType('h043')
set W8[i]=2
set X8[i]=1
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h049')
set W8[i]=5
set X8[i]=2
set Y8[i]=.3
set Z8[i]=0
set i=GetUnitPointValueByType('h04F')
set W8[i]=5
set X8[i]=2
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h03W')
set W8[i]=5
set X8[i]=2
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h03K')
set W8[i]=1
set X8[i]=3
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h03J')
set W8[i]=1
set X8[i]=3
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h049')
set W8[i]=4
set X8[i]=6
set Y8[i]=1.1
set Z8[i]=1
set i=GetUnitPointValueByType('h04F')
set W8[i]=5
set X8[i]=6
set Y8[i]=1.5
set Z8[i]=1
call tk(z9,0,Yj('h03O',0,0,0))
call tk(z9,1,Yj('h048','h03L',0,0))
call tk(z9,2,Yj('h047',0,0,0))
call sk(z9)
set B9=qg()
set dm=Yj('h01P','h056',0,0)
set em=Yj('h01K','h04B',0,0)
set fm=Yj('h01S',0,0,0)
call nk(B9,1,Yj('h01N','h054',0,0))
call nk(B9,1,dm)
call nk(B9,1,em)
call nk(B9,1,fm)
call nk(B9,2,dm)
call nk(B9,2,em)
call nk(B9,2,fm)
call nk(B9,3,em)
call nk(B9,3,Yj('h01L',0,0,0))
call nk(B9,3,fm)
call nk(B9,4,dm)
call nk(B9,4,em)
call nk(B9,5,em)
call nk(B9,5,Yj('h01T',0,0,0))
call nk(B9,5,fm)
call nk(B9,6,Yj('h01R','h04Z','h03M',0))
set i=GetUnitPointValueByType('h01P')
set W8[i]=1
set X8[i]=6
set Y8[i]=.6
set Z8[i]=1
set i=GetUnitPointValueByType('h056')
set W8[i]=1
set X8[i]=6
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h01K')
set W8[i]=5
set X8[i]=3
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h04B')
set W8[i]=5
set X8[i]=3
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h055')
set W8[i]=5
set X8[i]=3
set Y8[i]=1.
set Z8[i]=1
set i=GetUnitPointValueByType('h01S')
set W8[i]=4
set X8[i]=2
set Y8[i]=1.6
set Z8[i]=1
set i=GetUnitPointValueByType('h01N')
set W8[i]=3
set X8[i]=1
set Y8[i]=.8
set Z8[i]=0
set i=GetUnitPointValueByType('h054')
set W8[i]=3
set X8[i]=1
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h01L')
set W8[i]=6
set X8[i]=3
set Y8[i]=1.
set Z8[i]=1
set i=GetUnitPointValueByType('h01T')
set W8[i]=2
set X8[i]=5
set Y8[i]=1.4
set Z8[i]=0
set i=GetUnitPointValueByType('h01R')
set W8[i]=2
set X8[i]=6
set Y8[i]=.6
set Z8[i]=0
set i=GetUnitPointValueByType('h04Z')
set W8[i]=2
set X8[i]=6
set Y8[i]=.6
set Z8[i]=0
set i=GetUnitPointValueByType('h03M')
set W8[i]=2
set X8[i]=6
set Y8[i]=.7
set Z8[i]=0
call tk(B9,0,Yj('h01K','h04B','h055',0))
call tk(B9,0,Yj('h01Q',0,0,0))
call tk(B9,2,Yj('h00A',0,0,0))
call sk(B9)
set A9=qg()
set gm=Yj('h00S','h03D',0,0)
call nk(A9,1,gm)
call nk(A9,1,Yj('h07M','h07L',0,0))
call nk(A9,2,gm)
call nk(A9,3,Yj('h07O','h07N',0,0))
call nk(A9,3,Yj('h00B',0,0,0))
call nk(A9,4,gm)
call nk(A9,5,gm)
call nk(A9,5,Yj('h011',0,0,0))
call nk(A9,6,Yj('h088','h07D',0,0))
set i=GetUnitPointValueByType('h00S')
set W8[i]=1
set X8[i]=1
set Y8[i]=.6
set Z8[i]=1
set i=GetUnitPointValueByType('h03D')
set W8[i]=1
set X8[i]=1
set Y8[i]=.7
set Z8[i]=1
set i=GetUnitPointValueByType('h03E')
set W8[i]=1
set X8[i]=1
set Y8[i]=1.1
set Z8[i]=1
set i=GetUnitPointValueByType('h07M')
set W8[i]=2
set X8[i]=1
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h07L')
set W8[i]=2
set X8[i]=1
set Y8[i]=.8
set Z8[i]=0
set i=GetUnitPointValueByType('h07O')
set W8[i]=1
set X8[i]=3
set Y8[i]=.9
set Z8[i]=0
set i=GetUnitPointValueByType('h07N')
set W8[i]=1
set X8[i]=3
set Y8[i]=.8
set Z8[i]=0
set i=GetUnitPointValueByType('h00B')
set W8[i]=4
set X8[i]=3
set Y8[i]=1.
set Z8[i]=1
set i=GetUnitPointValueByType('h011')
set W8[i]=3
set X8[i]=5
set Y8[i]=1.1
set Z8[i]=0
set i=GetUnitPointValueByType('h088')
set W8[i]=5
set X8[i]=6
set Y8[i]=.8
set Z8[i]=1
set i=GetUnitPointValueByType('h07D')
set W8[i]=5
set X8[i]=6
set Y8[i]=.8
set Z8[i]=1
call tk(A9,0,Yj('h00S','h03D','h03E',0))
call tk(A9,0,Yj('h07I',0,0,0))
call tk(A9,2,Yj('h07H',0,0,0))
call tk(A9,2,Yj('h08P',0,0,0))
call sk(A9)
set a9=qg()
set hm=Yj('h08X','h08Y',0,0)
set im=Yj('h06Y',0,0,0)
set jm=Yj('h00T','h03F',0,0)
set km=Yj('h09X',0,0,0)
set mm=Yj('h00V',0,0,0)
call nk(a9,1,hm)
call nk(a9,1,im)
call nk(a9,2,jm)
call nk(a9,3,mm)
call nk(a9,3,km)
call nk(a9,4,hm)
call nk(a9,4,im)
call nk(a9,5,Yj('h070',0,0,0))
call nk(a9,5,mm)
call nk(a9,6,hm)
call nk(a9,6,jm)
call nk(a9,6,km)
set i=GetUnitPointValueByType('h08X')
set W8[i]=5
set X8[i]=1
set Y8[i]=.9
set Z8[i]=1
set i=GetUnitPointValueByType('h08Y')
set W8[i]=5
set X8[i]=1
set Y8[i]=.8
set Z8[i]=1
set i=GetUnitPointValueByType('h06Y')
set W8[i]=4
set X8[i]=1
set Y8[i]=1.3
set Z8[i]=1
set i=GetUnitPointValueByType('h00T')
set W8[i]=3
set X8[i]=2
set Y8[i]=1.
set Z8[i]=0
set i=GetUnitPointValueByType('h03F')
set W8[i]=3
set X8[i]=2
set Y8[i]=1.
set Z8[i]=0
set i=GetUnitPointValueByType('h00V')
set W8[i]=2
set X8[i]=3
set Y8[i]=1.2
set Z8[i]=1
set i=GetUnitPointValueByType('h09X')
set W8[i]=5
set X8[i]=3
set Y8[i]=1.2
set Z8[i]=1
set i=GetUnitPointValueByType('h00X')
set W8[i]=5
set X8[i]=6
set Y8[i]=1.2
set Z8[i]=1
set i=GetUnitPointValueByType('h070')
set W8[i]=2
set X8[i]=5
set Y8[i]=1.3
set Z8[i]=0
call tk(a9,0,Yj('h09X','h00X',0,0))
call tk(a9,0,Yj('h059',0,0,0))
call tk(a9,2,Yj('h00Z',0,0,0))
call tk(a9,2,Yj('h005',0,0,0))
call sk(a9)
set b9=qg()
set nm=Yj('h05X','h09I',0,0)
set om=Yj('h05X','h09B',0,0)
set pm=Yj('h05X','h09J',0,0)
set qm=Yj('h05T','h09P',0,0)
call nk(b9,1,Yj('h05U',0,0,0))
call nk(b9,1,nm)
call nk(b9,1,qm)
call nk(b9,2,om)
call nk(b9,2,pm)
call nk(b9,2,qm)
call nk(b9,3,nm)
call nk(b9,3,om)
call nk(b9,3,pm)
call nk(b9,3,Yj('h05M',0,0,0))
call nk(b9,4,Yj('h05X','h09B','h09H',0))
call nk(b9,4,Yj('h05J','h09L',0,0))
call nk(b9,5,nm)
call nk(b9,5,om)
call nk(b9,5,qm)
call nk(b9,6,nm)
call nk(b9,6,Yj('h05V',0,0,0))
call nk(b9,6,qm)
set i=GetUnitPointValueByType('h05X')
set W8[i]=3
set X8[i]=2
set Y8[i]=.9
set Z8[i]=0
set i=GetUnitPointValueByType('h09I')
set W8[i]=3
set X8[i]=6
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h09B')
set W8[i]=3
set X8[i]=2
set Y8[i]=.9
set Z8[i]=0
set i=GetUnitPointValueByType('h09J')
set W8[i]=3
set X8[i]=2
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h05T')
set W8[i]=1
set X8[i]=6
set Y8[i]=.7
set Z8[i]=0
set i=GetUnitPointValueByType('h09P')
set W8[i]=1
set X8[i]=6
set Y8[i]=.8
set Z8[i]=0
set i=GetUnitPointValueByType('h05U')
set W8[i]=2
set X8[i]=1
set Y8[i]=1.4
set Z8[i]=0
set i=GetUnitPointValueByType('h05M')
set W8[i]=5
set X8[i]=3
set Y8[i]=.9
set Z8[i]=0
set i=GetUnitPointValueByType('h09H')
set W8[i]=3
set X8[i]=2
set Y8[i]=.4
set Z8[i]=1
set i=GetUnitPointValueByType('h05J')
set W8[i]=4
set X8[i]=1
set Y8[i]=.9
set Z8[i]=2
set i=GetUnitPointValueByType('h09L')
set W8[i]=4
set X8[i]=1
set Y8[i]=1.1
set Z8[i]=2
set i=GetUnitPointValueByType('h05V')
set W8[i]=2
set X8[i]=6
set Y8[i]=1.
set Z8[i]=0
set i=GetUnitPointValueByType('h097')
set W8[i]=6
set X8[i]=6
set Y8[i]=1.4
set Z8[i]=0
call tk(b9,0,Yj('h05V','h097',0,0))
call tk(b9,2,Yj('h06J','h05R',0,0))
call tk(b9,2,Yj('h069',0,0,0))
call sk(b9)
set C9=qg()
set rm=Yj('h002','h00Q','h00R',0)
set sm=Yj('h028',0,0,0)
set tm=Yj('h00Y','h012',0,0)
set um=Yj('h013','h01H',0,0)
set vm=Yj('h027',0,0,0)
call nk(C9,1,rm)
call nk(C9,1,um)
call nk(C9,2,Yj('h023','h024',0,0))
call nk(C9,2,sm)
call nk(C9,3,tm)
call nk(C9,4,tm)
call nk(C9,4,um)
call nk(C9,4,sm)
call nk(C9,5,sm)
call nk(C9,5,vm)
call nk(C9,6,sm)
call nk(C9,6,vm)
set i=GetUnitPointValueByType('h002')
set W8[i]=5
set X8[i]=1
set Y8[i]=.6
set Z8[i]=0
set i=GetUnitPointValueByType('h00Q')
set W8[i]=5
set X8[i]=1
set Y8[i]=.4
set Z8[i]=0
set i=GetUnitPointValueByType('h00R')
set W8[i]=5
set X8[i]=1
set Y8[i]=.4
set Z8[i]=1
set i=GetUnitPointValueByType('h028')
set W8[i]=5
set X8[i]=5
set Y8[i]=2.
set Z8[i]=1
set i=GetUnitPointValueByType('h00Y')
set W8[i]=1
set X8[i]=3
set Y8[i]=1.
set Z8[i]=1
set i=GetUnitPointValueByType('h012')
set W8[i]=1
set X8[i]=3
set Y8[i]=.6
set Z8[i]=1
set i=GetUnitPointValueByType('h013')
set W8[i]=2
set X8[i]=1
set Y8[i]=1.
set Z8[i]=1
set i=GetUnitPointValueByType('h01H')
set W8[i]=2
set X8[i]=1
set Y8[i]=.6
set Z8[i]=1
set i=GetUnitPointValueByType('h01J')
set W8[i]=2
set X8[i]=6
set Y8[i]=.8
set Z8[i]=1
set i=GetUnitPointValueByType('h027')
set W8[i]=4
set X8[i]=6
set Y8[i]=1.3
set Z8[i]=1
set i=GetUnitPointValueByType('h023')
set W8[i]=5
set X8[i]=2
set Y8[i]=1.2
set Z8[i]=0
set i=GetUnitPointValueByType('h024')
set W8[i]=5
set X8[i]=2
set Y8[i]=.7
set Z8[i]=0
call tk(C9,0,Yj('h013','h01H','h01J',0))
call tk(C9,0,Yj('h02D',0,0,0))
call tk(C9,2,Yj('h02C',0,0,0))
call tk(C9,2,Yj('h02A',0,0,0))
call sk(C9)
set o9=true
endfunction
function wm takes real x,real y returns real
return SquareRoot(x*x+y*y)
endfunction
function xm takes nothing returns nothing
local timer t=GetExpiredTimer()
local integer id=LoadInteger(E7,GetHandleId(t),1)
if(GetWidgetLife(D9[id])>.405 and wm(E9[id]-GetUnitX(D9[id]),F9[id]-GetUnitY(D9[id]))>768.)then
call UnitRemoveAbility(D9[id],'A0BG')
endif
set H9=H9-1
set G9[id]=G9[H9]
set E9[id]=E9[H9]
set F9[id]=F9[H9]
set D9[id]=D9[H9]
call SaveInteger(E7,GetHandleId(G9[H9]),1,id)
set G9[H9]=t
set t=null
endfunction
function ym takes nothing returns nothing
local timer t=GetExpiredTimer()
local integer id=LoadInteger(E7,GetHandleId(t),1)
if(GetWidgetLife(D9[id])>.405)then
call SetUnitPathing(D9[id],true)
call TimerStart(t,4.,false,I9)
else
set H9=H9-1
set G9[id]=G9[H9]
set E9[id]=E9[H9]
set F9[id]=F9[H9]
set D9[id]=D9[H9]
call SaveInteger(E7,GetHandleId(G9[H9]),1,id)
set G9[H9]=t
endif
set t=null
endfunction
function zm takes nothing returns nothing
local timer t=GetExpiredTimer()
local integer id=LoadInteger(E7,GetHandleId(t),1)
if(GetWidgetLife(D9[id])>.405 and wm(E9[id]-GetUnitX(D9[id]),F9[id]-GetUnitY(D9[id]))<768.)then
call SetUnitPathing(D9[id],false)
call li(D9[id])
call TimerStart(t,.7,false,function ym)
else
call UnitRemoveAbility(D9[id],'A0BG')
set H9=H9-1
set G9[id]=G9[H9]
set E9[id]=E9[H9]
set F9[id]=F9[H9]
set D9[id]=D9[H9]
call SaveInteger(E7,GetHandleId(G9[H9]),1,id)
set G9[H9]=t
endif
set t=null
endfunction
function Am takes unit u returns nothing
call UnitAddAbility(u,'A0BG')
if(G9[H9]==null)then
set G9[H9]=CreateTimer()
endif
set E9[H9]=GetUnitX(u)
set F9[H9]=GetUnitY(u)
set D9[H9]=u
call SaveInteger(E7,GetHandleId(G9[H9]),1,H9)
call TimerStart(G9[H9],4.,false,I9)
set H9=H9+1
endfunction
function am takes nothing returns nothing
if(e8)then
set I9=function zm
else
set I9=function xm
endif
endfunction
function Bm takes nothing returns nothing
local unit c
local integer i=GetRandomInt(0,8)
local real x
local real y
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,n7)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",GetUnitX(r4),GetUnitY(r4)))
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",bj_groupRandomCurrentPick,"origin"))
if(Oi(bj_groupRandomCurrentPick))then
return
endif
if(i==0)then
call ExplodeUnitBJ(bj_groupRandomCurrentPick)
set i=GetPlayerId(g4)
set A8[i]=A8[i]+1
elseif(i==1)then
call UnitDamageTarget(r4,bj_groupRandomCurrentPick,50000.,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_DEATH,WEAPON_TYPE_WHOKNOWS)
elseif(i==2)then
call UnitDamageTarget(r4,bj_groupRandomCurrentPick,500.,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_DEATH,WEAPON_TYPE_WHOKNOWS)
elseif(i==3)then
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Avatar\\AvatarCaster.mdl",bj_groupRandomCurrentPick,"origin"))
call UnitAddAbility(bj_groupRandomCurrentPick,'A06T')
call UnitAddAbility(bj_groupRandomCurrentPick,'A06U')
call SetUnitState(bj_groupRandomCurrentPick,UNIT_STATE_LIFE,GetUnitState(bj_groupRandomCurrentPick,UNIT_STATE_MAX_LIFE))
elseif(i==4)then
set c=CreateUnit(g4,'e008',GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick),.0)
call UnitAddAbility(c,'A018')
call UnitShareVision(bj_groupRandomCurrentPick,g4,true)
call IssueTargetOrderById(c,$D0216,bj_groupRandomCurrentPick)
call UnitShareVision(bj_groupRandomCurrentPick,g4,false)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=bj_groupRandomCurrentPick
call TriggerSleepAction(1.)
call Ii(c)
if(GetUnitTypeId(c)=='h03A')then
call TriggerSleepAction(44.5)
call IssueImmediateOrderById(c,$D0057)
call TriggerSleepAction(.5)
call Ii(c)
endif
set c=null
elseif(i==5)then
set c=CreateUnit(g4,'e008',GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick),.0)
call UnitAddAbility(c,'A06S')
call UnitShareVision(bj_groupRandomCurrentPick,g4,true)
call IssueTargetOrderById(c,$D007F,bj_groupRandomCurrentPick)
call UnitShareVision(bj_groupRandomCurrentPick,g4,false)
call UnitApplyTimedLife(c,'BTLF',2.)
set c=null
elseif(i==6)then
set i=GetPlayerId(g4)
set A8[i]=A8[i]+1
call ShowUnit(bj_groupRandomCurrentPick,false)
set x=GetUnitX(bj_groupRandomCurrentPick)
set y=GetUnitY(bj_groupRandomCurrentPick)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\FeralSpirit\\feralspiritdone.mdl",x,y))
call Ii(CreateUnit(g4,'n01S',x,y,GetUnitFacing(bj_groupRandomCurrentPick)))
call RemoveUnit(bj_groupRandomCurrentPick)
endif
endfunction
function bm takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitEnemy(u,g4)and GetUnitTypeId(u)==J9
set u=null
return Eh
endfunction
function Cm takes nothing returns nothing
local unit u=GetEnumUnit()
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\AIil\\AIilTarget.mdl",u,"origin"))
call UnitDamageTarget(r4,u,100500.,true,false,ATTACK_TYPE_CHAOS,DAMAGE_TYPE_DEATH,WEAPON_TYPE_WHOKNOWS)
set u=null
endfunction
function cm takes nothing returns nothing
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,n7)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\TomeOfRetraining\\TomeOfRetrainingCaster.mdl",GetUnitX(r4),GetUnitY(r4)))
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set J9=GetUnitTypeId(bj_groupRandomCurrentPick)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,K9)
call ForGroup(f4,function Cm)
endfunction
function Dm takes nothing returns nothing
local real x
local real y
local unit c
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,m7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set x=GetUnitX(bj_groupRandomCurrentPick)
set y=GetUnitY(bj_groupRandomCurrentPick)
set c=CreateUnit(g4,'e008',x,y,.0)
call UnitAddAbility(c,l9)
call IssuePointOrderById(c,$D0208,x,y)
call UnitApplyTimedLife(c,'BTLF',6.)
set c=null
endfunction
function Em takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitEnemy(u,g4)and IsUnitType(u,UNIT_TYPE_STRUCTURE)and GetPlayerId(GetOwningPlayer(u))<$C and GetUnitTypeId(u)!='hcas' and GetUnitAbilityLevel(u,'A06V')<=0
set u=null
return Eh
endfunction
function Fm takes nothing returns nothing
local integer t
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,L9)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosTarget.mdl",GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick)))
call KillUnit(bj_groupRandomCurrentPick)
set t=N8[GetPlayerId(g4)]
set v8[t]=v8[t]+1
call dj(3,t+1,I2S(v8[t]))
endfunction
function Gm takes nothing returns nothing
local unit c
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\NightElf\\BattleRoar\\RoarCaster.mdl",u4,"origin"))
set c=CreateUnit(GetOwningPlayer(u4),'e008',GetUnitX(u4),GetUnitY(u4),.0)
call UnitAddAbility(c,'A03R')
call IssueImmediateOrderById(c,$D00C4)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=null
endfunction
function Hm takes nothing returns boolean
call Tg(o4,'h094',74.,38.5,28.)
call Tg(o4,'h093',160.,-42.,-18.75)
call Tg(o4,'h093',250.,3.75,-55.5)
call Tg(o4,'h08Z',220.,43.,27.5)
return false
endfunction
function Im takes nothing returns nothing
call gh('h05I',function Bm)
call Qg('h025','n00L')
call gh('h01M',function cm)
call gh('h01W',function cm)
call gh('h01X',function cm)
call Qg('h01I','n00A')
call Qg('h026','z000')
call gh('h01F',function Dm)
call gh('h01E',function Fm)
call Qg('h01C','n008')
call Qg('h01D','n009')
call Qg('h03G','n00Z')
call Zg('h03G',function Hm)
call Qg('h009','n001')
call Qg('h007','n000')
endfunction
function lm takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h025')
set h4[id]=280
set i4[id]=280*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01I')
set h4[id]='x'
set i4[id]='x'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h026')
set h4[id]=$E6
set i4[id]=$E6*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01C')
set h4[id]=$E6
set i4[id]=$E6*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01D')
set h4[id]=$A0
set i4[id]=$A0*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03G')
set h4[id]=$BE
set i4[id]=$BE*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h009')
set h4[id]=350
set i4[id]=350*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h007')
set h4[id]=500
set i4[id]=500*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h05I')
set h4[id]=$C8
set i4[id]=$C8*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h01M')
set h4[id]=350
set i4[id]=350*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h01W')
set h4[id]=$AF
set i4[id]=$AF*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h01X')
set h4[id]=$AF
set i4[id]=$AF*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h01F')
set h4[id]=340
set i4[id]=340*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h01E')
set h4[id]=850
set i4[id]=850*.12/100.
set j4[id]=false
endfunction
function Chaos__RegisterUnitCasts takes nothing returns nothing
call jh('n00Z','A03S',function Gm)
endfunction
function Jm takes unit u,integer Sg returns unit
local unit n
call ShowUnit(u,false)
set n=CreateUnit(GetOwningPlayer(u),Sg,GetUnitX(u),GetUnitY(u),GetUnitFacing(u))
call RemoveUnit(u)
return n
endfunction
function Km takes unit u returns unit
local integer i=GetRandomInt(0,99)
if(i<5)then
set u=Jm(u,'n00M')
elseif(i<$E)then
set u=Jm(u,'n00R')
else
set i=GetRandomInt(0,3)
if(i==0)then
set u=Jm(u,'n00Q')
elseif(i==1)then
set u=Jm(u,'n00N')
elseif(i==2)then
set u=Jm(u,'n00O')
else
set u=Jm(u,'n00P')
endif
endif
set i=GetRandomInt(0,99)
if(i<20)then
call UnitAddAbility(u,'A009')
elseif(i<55)then
call UnitAddAbility(u,'A01F')
endif
set i=GetRandomInt(0,99)
if(i<18)then
call UnitAddAbility(u,'A02B')
elseif(i<30)then
call UnitAddAbility(u,'A01B')
elseif(i<33)then
call UnitAddAbility(u,'A00Z')
elseif(i<43)then
call UnitAddAbility(u,'A07L')
endif
set i=GetRandomInt(0,99)
if(i<$A)then
call UnitAddAbility(u,'A00U')
elseif(i<32)then
call UnitAddAbility(u,'A00T')
elseif(i<35)then
call UnitAddAbility(u,'A05J')
endif
set i=GetRandomInt(0,99)
if(i<25)then
call UnitAddAbility(u,'A01A')
endif
set i=GetRandomInt(0,99)
if(i<$F)then
call UnitAddAbility(u,'A00V')
elseif(i<40)then
call UnitAddAbility(u,'A00D')
endif
set i=GetRandomInt(0,99)
if(i<8)then
call UnitAddAbility(u,'A01U')
elseif(i<16)then
call UnitAddAbility(u,'A010')
elseif(i<24)then
call UnitAddAbility(u,'A01P')
elseif(i<34)then
call UnitAddAbility(u,'A006')
elseif(i<44)then
call UnitAddAbility(u,'A01R')
elseif(i<47)then
call UnitAddAbility(u,'A012')
endif
return u
endfunction
function Lm takes nothing returns nothing
call Im()
call lm()
call jh('n00Z','A03S',function Gm)
set K9=Filter(function bm)
set L9=Filter(function Em)
endfunction
function Mm takes nothing returns nothing
local integer i=0
local real x
local real y
local real an
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,m7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set x=GetUnitX(bj_groupRandomCurrentPick)
set y=GetUnitY(bj_groupRandomCurrentPick)
loop
set an=60.*I2R(i)
call UnitApplyTimedLife(CreateUnit(g4,M9,x+64.*Cos(an*bj_DEGTORAD),y+64.*Sin(an*bj_DEGTORAD),360.-an),'BTLF',9.)
set i=i+1
exitwhen i>=6
endloop
endfunction
function Nm takes nothing returns nothing
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,n7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Undead\\DeathPact\\DeathPactTarget.mdl",bj_groupRandomCurrentPick,"origin"))
if not Oi(bj_groupRandomCurrentPick)then
call UnitDamageTarget(r4,bj_groupRandomCurrentPick,200.,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_SONIC,WEAPON_TYPE_WHOKNOWS)
endif
endfunction
function Om takes nothing returns nothing
local player p=GetOwningPlayer(u4)
local real x=GetUnitX(u4)
local real y=GetUnitY(u4)
local real an=bj_RADTODEG*Atan2(GetUnitY(v4)-y,GetUnitX(v4)-x)-20.
local integer i=0
local unit c
loop
set c=CreateUnit(p,'e008',x,y,an)
call UnitAddAbility(c,'A0AF')
call IssuePointOrderById(c,$D024B,x+10.*Cos(an*bj_DEGTORAD),y+10.*Sin(an*bj_DEGTORAD))
call UnitApplyTimedLife(c,'BTLF',2.)
set an=an+(10.)
set i=i+1
exitwhen i>3
endloop
set c=null
endfunction
function Pm takes nothing returns boolean
call Tg(o4,'h04J',191.,.0,.0)
return false
endfunction
function Qm takes nothing returns boolean
call Tg(o4,'h09Z',270.,.0,.0)
return false
endfunction
function Rm takes nothing returns boolean
call SetUnitVertexColor(o4,82,0,$87,'f')
return false
endfunction
function Sm takes nothing returns boolean
call Tg(o4,'h08I',.0,.0,.0)
return false
endfunction
function Tm takes nothing returns nothing
call fh('n01J',800.)
call Qg('h04V','n01I')
call Qg('h04W','n01H')
call Qg('h09Y','n027')
call Zg('h09Y',function Qm)
call Qg('h04U','h04I')
call Zg('h04U',function Pm)
call Qg('h04S','n01G')
call gh('h04R',function Mm)
call Qg('h04Q','n01F')
call Qg('h04P','n01E')
call Qg('h04O','n01D')
call Qg('h04M','n01B')
call Zg('h04M',function Rm)
call Qg('h04L','n019')
call Qg('h04N','n01A')
call gh('h04K',function Nm)
call Zg('h04K',function Sm)
endfunction
function Um takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h04V')
set h4[id]='}'
set i4[id]='}'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h04W')
set h4[id]='}'
set i4[id]='}'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h04U')
set h4[id]=520
set i4[id]=520*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h04S')
set h4[id]=$F0
set i4[id]=$F0*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h04Q')
set h4[id]=250
set i4[id]=250*.18/100.
set j4[id]=true
set k4[id]=true
set id=GetUnitPointValueByType('h04P')
set h4[id]=200
set i4[id]=200*.18/100.
set j4[id]=true
set k4[id]=true
set id=GetUnitPointValueByType('h04O')
set h4[id]=$EB
set i4[id]=$EB*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h04M')
set h4[id]=$A5
set i4[id]=$A5*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h04L')
set h4[id]=$BE
set i4[id]=$BE*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h04N')
set h4[id]=$BE
set i4[id]=$BE*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('n01J')
set h4[id]=$C8
set i4[id]=$C8*.08/100.
set j4[id]=false
set id=GetUnitPointValueByType('h09Y')
set h4[id]=500
set i4[id]=500*.2/100.
set j4[id]=false
set id=GetUnitPointValueByType('h04T')
set h4[id]=500
set i4[id]=500*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h04R')
set h4[id]=260
set i4[id]=260*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h04K')
set h4[id]=275
set i4[id]=275*.09/100.
set j4[id]=false
endfunction
function Corrupted__RegisterUnitCasts takes nothing returns nothing
call jh('n027','A0AE',function Om)
endfunction
function Vm takes nothing returns nothing
call Tm()
call Um()
call jh('n027','A0AE',function Om)
endfunction
function Wm takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=IsUnitType(u,UNIT_TYPE_FLYING)and GetWidgetLife(u)>.405 and IsUnitEnemy(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)and not IsUnitType(u,UNIT_TYPE_MECHANICAL)
set u=null
return Eh
endfunction
function Xm takes nothing returns nothing
local real x
local real y
local integer i=0
local unit t
local unit c
set g4=GetOwningPlayer(u4)
set x=GetUnitX(u4)
set y=GetUnitY(u4)
call GroupEnumUnitsInRange(f4,GetUnitX(v4),GetUnitY(v4),400.,N9)
loop
set t=FirstOfGroup(f4)
set i=i+1
exitwhen i>4 or t==null
call GroupRemoveUnit(f4,t)
set c=CreateUnit(GetOwningPlayer(u4),'e008',x,y,.0)
call UnitAddAbility(c,'A08U')
call IssueTargetOrderById(c,$D007F,t)
call UnitApplyTimedLife(c,'BTLF',3.)
endloop
set t=null
set c=null
endfunction
function Ym takes nothing returns nothing
local unit c
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,n7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null or Oi(bj_groupRandomCurrentPick))then
return
endif
set c=CreateUnit(g4,'e008',GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick),.0)
call UnitAddAbility(c,'A018')
call UnitShareVision(bj_groupRandomCurrentPick,g4,true)
call IssueTargetOrderById(c,$D0216,bj_groupRandomCurrentPick)
call UnitShareVision(bj_groupRandomCurrentPick,g4,false)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=bj_groupRandomCurrentPick
call TriggerSleepAction(1.)
call Ii(c)
if(GetUnitTypeId(c)=='h03A')then
call TriggerSleepAction(44.5)
call IssueImmediateOrderById(c,$D0057)
call TriggerSleepAction(.5)
call Ii(c)
endif
set c=null
endfunction
function Zm takes nothing returns nothing
local unit c=CreateUnit(GetOwningPlayer(u4),'e008',GetUnitX(u4),GetUnitY(u4),.0)
call UnitAddAbility(c,'A0A8')
call IssueTargetOrderById(c,$D0215,v4)
call UnitApplyTimedLife(c,'BTLF',2.)
set c=u4
call TriggerSleepAction(.8)
call Ii(c)
set c=null
endfunction
function dn takes nothing returns nothing
local unit c=CreateUnit(GetOwningPlayer(u4),'e008',GetUnitX(u4),GetUnitY(u4),.0)
call UnitAddAbility(c,'A00Y')
call IssueTargetOrderById(c,$D0215,v4)
call UnitApplyTimedLife(c,'BTLF',2.)
set c=u4
call TriggerSleepAction(.8)
call Ii(c)
set c=null
endfunction
function en takes nothing returns boolean
call SetUnitVertexColor(o4,$FF,$FF,$FF,0)
call Tg(o4,'h08Z',250.,46.,33.5)
call Tg(o4,'h090',270.,-17.,18.)
return false
endfunction
function fn takes nothing returns boolean
call SetUnitVertexColor(o4,$FF,$FF,$FF,0)
call Tg(o4,'h08Z',250.,46.,33.5)
call Tg(o4,'h091',270.,-17.,18.)
call Tg(o4,'h08Z',350.,-22.,-40.)
return false
endfunction
function gn takes nothing returns nothing
call gh('h00Z',function Ym)
call fh('h014',675.)
call Qg('h09X','h07B')
call Qg('h00X','h00W')
call Qg('h00V','h00U')
call Qg('h00T','n006')
call Qg('h03F','n00Y')
call Qg('h08X','n022')
call Zg('h08X',function en)
call Qg('h08Y','n023')
call Zg('h08Y',function fn)
call Qg('h070','e005')
call Qg('h06Y','n01Y')
endfunction
function hn takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h09X')
set h4[id]=360
set i4[id]=360*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h00V')
set h4[id]=275
set i4[id]=275*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h00T')
set h4[id]=200
set i4[id]=200*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03F')
set h4[id]=200
set i4[id]=200*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h08X')
set h4[id]=$B4
set i4[id]=$B4*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h08Y')
set h4[id]=$C8
set i4[id]=$C8*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h070')
set h4[id]=350
set i4[id]=350*.18/100.
set j4[id]=true
set k4[id]=true
set id=GetUnitPointValueByType('h06Y')
set h4[id]=310
set i4[id]=310*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h00Z')
set h4[id]=$F0
set i4[id]=$F0*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h00X')
set h4[id]=440
set i4[id]=440*.2/100.
set j4[id]=false
set id=GetUnitPointValueByType('h059')
set h4[id]=650
set i4[id]=650*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h005')
set h4[id]=$FA
set i4[id]=$FA*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h014')
set h4[id]=$FA
set i4[id]=$FA*.08/100.
set j4[id]=false
endfunction
function in takes nothing returns nothing
call jh('n01Y','A08V',function Xm)
call jh('h07B','A0A7',function Zm)
call jh('h00W','A00X',function dn)
endfunction
function jn takes player p returns nothing
local integer id=N8[GetPlayerId(p)]
set s8[id]=s8[id]+(20)
endfunction
function kn takes unit u returns nothing
local integer id=N8[GetPlayerId(GetOwningPlayer(u))]
set s8[id]=s8[id]-(20)
endfunction
function mn takes nothing returns nothing
call gn()
call hn()
call in()
set N9=Filter(function Wm)
endfunction
function nn takes nothing returns nothing
local unit u=GetEnumUnit()
local unit c=CreateUnit(g4,'e008',GetUnitX(u),GetUnitY(u),.0)
call UnitAddAbility(c,'A016')
call IssueTargetOrderById(c,$D0085,u)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=null
set u=null
endfunction
function on takes nothing returns nothing
local real x=GetUnitX(r4)
local real y=GetUnitY(r4)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Other\\HowlOfTerror\\HowlCaster.mdl",x,y))
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRange(f4,x,y,500.,P9)
call ForGroup(f4,function nn)
endfunction
function pn takes nothing returns nothing
local unit u=u4
call IssueTargetOrderById(u,$D0062,v4)
call TriggerSleepAction(1.)
call Ii(u)
set u=null
endfunction
function qn takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=IsUnitAlly(u,g4)and GetWidgetLife(u)<.405 and not IsUnitType(u,UNIT_TYPE_MECHANICAL)
set u=null
return Eh
endfunction
function rn takes nothing returns nothing
local unit u=u4
call IssueTargetOrderById(u,$D0062,v4)
call UnitAddAbility(v4,'A03L')
call TriggerSleepAction(1.)
set g4=GetOwningPlayer(u)
call GroupEnumUnitsInRange(f4,GetUnitX(u),GetUnitY(u),900.,Q9)
if(FirstOfGroup(f4)!=null)then
call IssueImmediateOrderById(u,$D007E)
call TriggerSleepAction(1.)
endif
call Ii(u)
set u=null
endfunction
function sn takes nothing returns nothing
local unit u=u4
local unit c
call UnitRemoveAbility(u,'A00F')
set c=CreateUnit(GetOwningPlayer(u),'e008',GetUnitX(u),GetUnitY(u),.0)
call UnitAddAbility(c,'A00I')
call IssueImmediateOrderById(c,$D022E)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=null
call TriggerSleepAction(.3)
call Gi(u)
call TriggerSleepAction(5.)
call IssueImmediateOrderById(u,$D0019)
call TriggerSleepAction(6.6)
call UnitAddAbility(u,'A00F')
call Ii(u)
set u=null
endfunction
function tn takes nothing returns boolean
call SetUnitVertexColor(o4,$FF,$FF,$FF,0)
call Tg(o4,'h0A0',170.,31.25,-43.)
call Tg(o4,'h0A0',80.,-38.,-40.25)
call Tg(o4,'h0A0',350.,-30.25,30.)
call Tg(o4,'h08Z',220.,43.,27.5)
return false
endfunction
function un takes nothing returns nothing
call Qg('h000','hfoo')
call Qg('h039','h03A')
call Qg('h003','hrif')
call Qg('h0A1','h05C')
call Zg('h0A1',function tn)
call Qg('h05D','h0A2')
call Qg('h004','hmtm')
call fh('h006',950.)
call Qg('h00K','n005')
call fh('h010',500.)
call gh('h010',function on)
call Qg('h015','h016')
call Qg('h037','h03B')
call Qg('h038','h03C')
endfunction
function vn takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h037')
set h4[id]=265
set i4[id]=265*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h015')
set h4[id]=$FA
set i4[id]=$FA*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h00K')
set h4[id]=300
set i4[id]=300*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h004')
set h4[id]=$D2
set i4[id]=$D2*.18/100.
set j4[id]=true
set k4[id]=true
set id=GetUnitPointValueByType('h003')
set h4[id]=$8C
set i4[id]=$8C*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h000')
set h4[id]='d'
set i4[id]='d'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h039')
set h4[id]=$AF
set i4[id]=$AF*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h0A1')
set h4[id]=$A0
set i4[id]=$A0*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h05D')
set h4[id]=$B4
set i4[id]=$B4*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h038')
set h4[id]=260
set i4[id]=260*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h001')
set h4[id]=$C8
set i4[id]=$C8*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h006')
set h4[id] = 180
set i4[id] = 180 * .08/100.
set j4[id] = false
set id=GetUnitPointValueByType('h010')
set h4[id]=$E1
set i4[id]=$E1*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h05G')
set h4[id]=600
set i4[id]=600*.12/100.
set j4[id]=false
endfunction
function wn takes nothing returns nothing
call jh('h03B','A03K',function pn)
call jh('h03C','A03K',function rn)
call jh('n005','A00K',function sn)
endfunction
function xn takes unit u returns nothing
local rect r=t8[N8[GetPlayerId(GetOwningPlayer(u))]]
call IssuePointOrderById(u,$D0010,GetRandomReal(GetRectMinX(r),GetRectMaxX(r)),GetRandomReal(GetRectMinY(r),GetRectMaxY(r)))
set r=null
endfunction
function yn takes nothing returns nothing
call xn(GetEnumUnit())
endfunction
function zn takes nothing returns nothing
call ForGroup(O9,function yn)
endfunction
function An takes nothing returns nothing
local unit u=GetTrainedUnit()
local boolean Bn=GetUnitAbilityLevel(GetTriggerUnit(),'B01K')>0
local trigger t
local integer id=0
if(GetUnitAbilityLevel(u,'A07H')<=0 and GetRandomInt(0,99)<19)then
set t=GetTriggeringTrigger()
loop
exitwhen R9[id]==t
set id=id+1
endloop
set z8[id]=z8[id]+1
set u=CreateUnit(Player(id),GetUnitTypeId(u),GetUnitX(u),GetUnitY(u),.0)
if(Bn)then
call UnitAddAbility(u,'A09M')
call SetUnitAbilityLevel(u,'A09M',3)
call UnitRemoveAbility(u,'A09M')
call UnitAddAbility(u,'A09Q')
call UnitAddAbility(u,'A09R')
endif
call Am(u)
call Ii(u)
if(GetUnitAbilityLevel(u,'A09H')>0)then
set u=CreateUnit(Player(id),GetUnitTypeId(u),GetUnitX(u),GetUnitY(u),.0)
if(Bn)then
call UnitAddAbility(u,'A09M')
call SetUnitAbilityLevel(u,'A09M',3)
call UnitRemoveAbility(u,'A09M')
call UnitAddAbility(u,'A09Q')
call UnitAddAbility(u,'A09R')
endif
call Am(u)
call Ii(u)
elseif(GetUnitAbilityLevel(u,'A07M')>=1)then
call Vh(u)
call GroupAddUnit(o7,u)
endif
set t=null
endif
set u=null
endfunction
function bn takes player p returns nothing
local integer id=GetPlayerId(p)
local integer i=0
if(R9[id]==null)then
set R9[id]=CreateTrigger()
call TriggerAddAction(R9[id],function An)
loop
if(IsPlayerAlly(p,Player(i)))then
call TriggerRegisterPlayerUnitEventSimple(R9[id],Player(i),EVENT_PLAYER_UNIT_TRAIN_FINISH)
endif
set i=i+1
exitwhen i>=$C
endloop
endif
endfunction
function Cn takes unit u returns nothing
local player p=GetOwningPlayer(u)
local integer xh
call GroupEnumUnitsOfPlayer(f4,p,S9)
if(FirstOfGroup(f4)==null)then
set xh=GetPlayerId(p)
call TriggerClearActions(R9[xh])
call DestroyTrigger(R9[xh])
set R9[xh]=null
endif
endfunction
function cn takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and GetUnitTypeId(u)=='h05G'
set u=null
return Eh
endfunction
function Dn takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitAlly(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)
set u=null
return Eh
endfunction
function En takes nothing returns nothing
call un()
call vn()
call wn()
call TimerStart(CreateTimer(),9.,true,function zn)
set S9=Filter(function cn)
set Q9=Filter(function qn)
set P9=Filter(function Dn)
endfunction
function Fn takes integer x returns real
if(x<$A)then
return Y9[x]*.25+1.
endif
return((((I2R(x-9))*.25)+5.11)*.25)+1.
endfunction
function Gn takes integer xh returns real
return(V9[(xh)]*10.)*Fn(I8[xh])
endfunction
function Hn takes integer xh returns integer
local real i=Gn(xh)
local real j=.0
local real k=.0
loop
exitwhen(i<U9)or(k>=8)
set i=i-U9
set j=j+U9*(1.-k/10.)
set k=k+1.
endloop
set j=j+i*(1.-k/10.)
return R2I(j*U4[N8[xh]])
endfunction
function In takes integer xh,unit u returns nothing
local real l=i4[GetUnitPointValue(u)]
local integer Sg=GetHandleId(u)
set V9[xh]=V9[xh]+(l)
call SaveReal(E7,Sg,$A,LoadReal(E7,Sg,$A)+l)
endfunction
function ln takes integer xh,unit u returns nothing
set V9[xh]=V9[xh]-(LoadReal(E7,GetHandleId(u),$A))
endfunction
function Jn takes integer xh,unit u returns nothing
set V9[xh]=V9[xh]+(LoadReal(E7,GetHandleId(u),$A))
endfunction
function Kn takes nothing returns nothing
set X9=X9+(" "+I2S(W9[GetPlayerId(GetEnumPlayer())]))
endfunction
function Ln takes nothing returns nothing
local player p=GetEnumPlayer()
local integer id=GetPlayerId(p)
local integer vj=Hn(id)
set b8[id]=b8[id]+(vj)
call SetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD,GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+vj)
call SetPlayerState(p,PLAYER_STATE_GOLD_GATHERED,GetPlayerState(p,PLAYER_STATE_GOLD_GATHERED)+vj)
set W9[id]=vj
set Z9=Z9+(vj)
endfunction
function Mn takes nothing returns nothing
local integer i=0
set Z9=0
call ForForce(J8,function Ln)
call dj(4,1,I2S(Z9))
set Z9=0
call ForForce(K8,function Ln)
call dj(4,2,I2S(Z9))
loop
if(W9[i]>0)then
set X9="Income: |cffFFFF00"+I2S(W9[i])
if(O8[i]!=null)then
call ForForce(O8[i],function Kn)
endif
call DisplayTextToPlayer(Player(i),0,0,X9)
endif
set i=i+1
exitwhen i>$B
endloop
endfunction
function Nn takes player p returns nothing
local integer xh=GetPlayerId(p)
local string s="Your basic income is |cffFFFF00"+I2S(R2I((V9[(xh)]*10.)))
set s=s+("|r. Your Treasure Box income multiplier is |cffFFFF00"+R2SW(Fn(I8[xh]),1,2))
set s=s+("|r, boosting your income to |cffFFFF00"+I2S(R2I(Gn(xh))))
set s=s+("|r. After paying taxes your income is |cffFFFF00"+I2S(W9[xh])+"|r.")
call DisplayTextToPlayer(p,.0,.0,s)
endfunction
function On takes player p returns nothing
local integer id=GetPlayerId(p)
call DisplayTimedTextToPlayer(p,.0,.0,15.,"-------- Current statistics: --------")
call DisplayTimedTextToPlayer(p,.0,.0,15.,"Income: |cffFFFF00"+I2S(Hn(id))+"|r (|cffFFFF00"+I2S(b8[id])+"|r gold in total)")
if(o8>0)then
call DisplayTimedTextToPlayer(p,.0,.0,15.,"Coins collected: |cffFFFF00"+I2S(D8[id])+"|r (|cffFFFF00"+I2S(E8[id])+"|r gold in total)")
endif
call DisplayTimedTextToPlayer(p,.0,.0,15.,"Units killed: |cffFFFF00"+I2S(A8[id])+"|r (|cffFFFF00"+I2S(GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+G8[id]+H8[id]-F8[id]-b8[id]-E8[id]-$FA)+"|r gold in total)")
call DisplayTimedTextToPlayer(p,.0,.0,15.,"Units trained: |cffFFFF00"+I2S(z8[id])+"|r (|cffFFFF00"+I2S(a8[id])+"|r creepspawning buildings in total)")
call DisplayTimedTextToPlayer(p,.0,.0,15.,"Specials built: |cffFFFF00"+I2S(B8[id])+"|r")
call DisplayTimedTextToPlayer(p,.0,.0,15.,"Rescue Strike damage: |cffFFFF00"+I2S(C8[id])+"|r (|cffFFFF00"+I2S(c8[id])+"|r units killed)")
call DisplayTimedTextToPlayer(p,.0,.0,15.,"----------------------------------------------------")
endfunction
function Pn takes nothing returns integer
local integer j=0
local integer i=1
loop
if(C8[i]>C8[j])then
set j=i
endif
set i=i+1
exitwhen i>$B
endloop
return j
endfunction
function Qn takes nothing returns integer
local integer j=0
local integer i=1
loop
if(B8[i]>B8[j])then
set j=i
endif
set i=i+1
exitwhen i>$B
endloop
return B8[j]
endfunction
function Rn takes nothing returns integer
local integer j=0
local integer i=0
loop
if(a8[j]>a8[i])then
set i=j
endif
set j=j+1
exitwhen j>$B
endloop
return j
endfunction
function Sn takes nothing returns integer
local integer j=0
local integer i=1
loop
if(A8[i]>A8[j])then
set j=i
endif
set i=i+1
exitwhen i>$B
endloop
return j
endfunction
function Tn takes nothing returns integer
local integer j=0
local integer i=1
loop
if(D8[i]>D8[j])then
set j=i
endif
set i=i+1
exitwhen i>$B
endloop
return j
endfunction
function Un takes nothing returns integer
local integer j=0
local integer v=Hn(0)
local integer i=1
local integer t
loop
set t=Hn(i)
if(t>v)then
set v=t
set j=i
endif
set i=i+1
exitwhen i>$B
endloop
return j
endfunction
function Vn takes nothing returns nothing
local string s
local string t
local integer g
local integer i
local player p
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20.,"|cffFFFF80-----------  End of round statistics  -----------|r")
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20.,"Round time: "+fj())
set g=Hn(Un())
set s=""
set i=0
loop
if(Hn(i)==g)then
if(s=="")then
set s=Q8[i]
set t=I2S(b8[i])
else
set s=s+", "+Q8[i]
set t=t+"|r, |cffFFFF00"+I2S(b8[i])
endif
endif
set i=i+1
exitwhen i>$B
endloop
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20.,"Highest income: "+s+" - |cffFFFF00"+I2S(g)+"|r (|cffFFFF00"+t+"|r gold in total)")
if(o8>0)then
set g=Tn()
set s=""
set i=0
loop
set p=Player(i)
if(D8[i]==D8[g])then
if(s=="")then
set s=Q8[i]
set t=I2S(E8[i])
else
set s=s+", "+Q8[i]
set t=t+"|r, |cffFFFF00"+I2S(E8[i])
endif
endif
set i=i+1
exitwhen i>$B
endloop
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20.,"Most coins collected: "+s+" - |cffFFFF00"+I2S(D8[g])+"|r (|cffFFFF00"+t+"|r gold in total)")
endif
set g=Sn()
set s=""
set i=0
loop
set p=Player(i)
if(A8[i]==A8[g])then
if(s=="")then
set s=Q8[i]
set t=I2S(GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+G8[i]+H8[i]-F8[i]-b8[i]-E8[i]-$FA)
else
set s=s+", "+Q8[i]
set t=t+"|r, |cffFFFF00"+I2S(GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)+G8[i]+H8[i]-F8[i]-b8[i]-E8[i]-$FA)
endif
endif
set i=i+1
exitwhen i>$B
endloop
set s="Most units killed: "+s+" - |cffFFFF00"+I2S(A8[g])+"|r"
if(V7)then
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20.,s)
else
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20.,s+" (|cffFFFF00"+t+"|r gold in total)")
endif
set g=a8[Rn()]
set s=""
set i=0
loop
if(a8[i]==a8[g])then
if(s=="")then
set s=Q8[i]
set t=I2S(z8[i])
else
set s=s+", "+Q8[i]
set t=t+"|r, |cffFFFF00"+I2S(z8[i])
endif
endif
set i=i+1
exitwhen i>$B
endloop
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20.,"Most creepspawning buildings: "+s+" - |cffFFFF00"+I2S(a8[g])+"|r (|cffFFFF00"+t+"|r units in total)")
if(W7)then
set g=Qn()
set s=""
set i=0
loop
if(B8[i]==g)then
if(s=="")then
set s=Q8[i]
else
set s=s+", "+Q8[i]
endif
endif
set i=i+1
exitwhen i>$B
endloop
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20.,"Most special buildings: "+s+" - |cffFFFF00"+I2S(g)+"|r")
endif
set g=Pn()
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20.,"Most damage dealt with RS: "+Q8[g]+" - |cffFFFF00"+I2S(C8[g])+"|r (|cffFFFF00"+I2S(c8[g])+"|r units killed)")
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,20.,"|cffFFFF80--------------------------------------------------------------------|r")
endfunction
function Wn takes nothing returns nothing
set Y9[0]=.0
set Y9[1]=1.
set Y9[2]=1.85
set Y9[3]=2.57
set Y9[4]=3.18
set Y9[5]=3.7
set Y9[6]=4.14
set Y9[7]=4.52
set Y9[8]=4.84
set Y9[9]=5.11
set U4[0]=1.
set U4[1]=1.
endfunction
function Xn takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitAlly(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)and GetUnitAbilityLevel(u,'Avul')<=0 and GetUnitAbilityLevel(u,'A09L')<=0
set u=null
return Eh
endfunction
function Yn takes nothing returns nothing
local unit u
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,ed)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
call UnitAddAbility(bj_groupRandomCurrentPick,'A09L')
set u=r4
call SetUnitAnimation(u,"death")
call TriggerSleepAction(.3)
call SetUnitAnimation(u,"stand")
set u=null
endfunction
function Zn takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitAlly(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)and GetUnitAbilityLevel(u,'Avul')<=0
set u=null
return Eh
endfunction
function do takes nothing returns nothing
local unit u
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,ed)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,fd)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
else
call UnitAddAbility(bj_groupRandomCurrentPick,'A09L')
endif
call SetUnitAbilityLevel(bj_groupRandomCurrentPick,'A09L',2)
set u=r4
call SetUnitAnimation(u,"death")
call TriggerSleepAction(.3)
call SetUnitAnimation(u,"stand")
set u=null
endfunction
function eo takes nothing returns nothing
local player p=GetOwningPlayer(u4)
local real x=GetUnitX(v4)
local real y=GetUnitY(v4)
local real sx=GetUnitX(u4)
local real sy=GetUnitY(u4)
local unit c=CreateUnit(p,'h09Q',sx,sy,.0)
local unit t
call IssuePointOrderById(c,$D0010,x,y)
call UnitApplyTimedLife(c,'BTLF',3.)
set sx=sx-(x)
set sy=sy-(y)
call TriggerSleepAction(SquareRoot(sx*sx+sy*sy)/700.)
set c=CreateUnit(p,'e008',x,y,.0)
call UnitAddAbility(c,'A09E')
call IssueImmediateOrderById(c,$D0080)
call UnitApplyTimedLife(c,'BTLF',3.)
set g4=p
call GroupEnumUnitsInRange(f4,x,y,300.,m7)
loop
set t=FirstOfGroup(f4)
exitwhen t==null
call GroupRemoveUnit(f4,t)
set sx=GetUnitState(t,UNIT_STATE_MANA)
if(sx>.0)then
set sy=RMinBJ(sx,'d')
call SetUnitState(t,UNIT_STATE_MANA,sx-sy)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\Feedback\\SpellBreakerAttack.mdl",t,"origin"))
call UnitDamageTarget(c,t,sy,true,false,ATTACK_TYPE_CHAOS,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
endif
endloop
set c=null
endfunction
function fo takes nothing returns nothing
local player p=GetOwningPlayer(u4)
local real sx=GetUnitX(u4)
local real sy=GetUnitY(u4)
local real r=GetRandomReal(70.,300.)
local real y=GetRandomReal(.0,360.)*bj_DEGTORAD
local real x=sx+r*Cos(y)
local unit c=CreateUnit(p,'h09M',sx,sy,.0)
set y=sy+r*Sin(y)
call IssuePointOrderById(c,$D0010,x,y)
call UnitApplyTimedLife(c,'BTLF',3.)
call TriggerSleepAction(r/700.)
call CreateUnit(p,'n025',x,y,.0)
set c=null
endfunction
function go takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean fl=GetWidgetLife(u)>=.405 and IsUnitType(u,UNIT_TYPE_STRUCTURE)and GetUnitTypeId(u)!='h09T' and(GetUnitAbilityLevel(u,'Bfrz')>0 or GetUnitAbilityLevel(u,'B00M')>0)and GetRandomInt(0,99)<50
set u=null
return fl
endfunction
function ho takes nothing returns nothing
local unit u=GetEnumUnit()
call UnitRemoveAbility(u,'Bfrz')
call UnitRemoveAbility(u,'B00M')
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Orc\\LightningShield\\LightningShieldTarget.mdl",GetUnitX(u),GetUnitY(u)))
set u=null
endfunction
function io takes nothing returns nothing
local unit u=GetEnumUnit()
call GroupEnumUnitsInRange(f4,GetUnitX(u),GetUnitY(u),252.,gd)
call ForGroup(f4,function ho)
set u=null
endfunction
function jo takes nothing returns nothing
call ForGroup(dd,function io)
endfunction
function ko takes nothing returns boolean
call Tg(o4,'h09V',270.,.0,.0)
call Tg(o4,'h09U',90.,20.,.0)
call Tg(o4,'h09U',.0,.0,-20.)
call Tg(o4,'h09U',270.,-20.,.0)
call Tg(o4,'h09U',180.,.0,20.)
return false
endfunction
function mo takes nothing returns boolean
call Tg(o4,'h09R',300.,3.5,65.25)
call Tg(o4,'h09R',70.,-16.5,-51.)
call Tg(o4,'h09N',238.,36.,53.)
call Tg(o4,'h09O',314.,-38.,-39.5)
return false
endfunction
function no takes nothing returns boolean
call Tg(o4,'h09O',279.,-45.5,24.75)
call Tg(o4,'h09N',300.,31.,-32.25)
return false
endfunction
function oo takes nothing returns boolean
call Tg(o4,'h09K',238.,.0,.0)
return false
endfunction
function po takes nothing returns boolean
call Tg(o4,'h09F',2.,36.25,41.)
call Tg(o4,'h09F',2.,33.25,-33.5)
call Tg(o4,'h09F',2.,-46.25,10.75)
call Tg(o4,'h09A',45.,-5.25,17.)
return false
endfunction
function qo takes nothing returns boolean
call Tg(o4,'h09D',225.,35.,-29.75)
call Tg(o4,'h09D',45.,20.,22.5)
call Tg(o4,'h09D',225.,-31.,26.25)
call Tg(o4,'h09G',23.,-25.25,-36.)
return false
endfunction
function ro takes nothing returns boolean
call Tg(o4,'h09C',33.,36.25,36.5)
call Tg(o4,'h09C',13.,21.,-47.5)
call Tg(o4,'h09C',319.,-46.25,11.75)
return false
endfunction
function so takes nothing returns boolean
call Tg(o4,'h09C',33.,36.25,36.5)
call Tg(o4,'h09C',13.,21.,-47.5)
call Tg(o4,'h09C',319.,-46.25,11.75)
call Tg(o4,'h09E',348.,-6.5,9.)
return false
endfunction
function uo takes nothing returns boolean
call Tg(o4,'h09K',45.,.0,.0)
return false
endfunction
function vo takes nothing returns boolean
call Tg(o4,'h096',180.,-45.75,21.75)
call Tg(o4,'h096',110.,9.,-62.5)
return false
endfunction
function wo takes nothing returns nothing
call Zg('h09T',function ko)
call fh('h09T',180.)
call Qg('h069','n01U')
call Zg('h069',function mo)
call gh('h06J',function Yn)
call gh('h05R',function do)
call Qg('h05T','z002')
call Qg('h09P','z003')
call Zg('h09P',function no)
call Qg('h05U','n01T')
call Qg('h05M','n01V')
call Qg('h05J','h06Q')
call Qg('h09L','h06R')
call Zg('h09L',function oo)
call Qg('h05V','n01X')
call Qg('h097','n024')
call Zg('h097',function vo)
call Qg('h05X','h06T')
call Qg('h09J','h06U')
call Zg('h09J',function po)
call Qg('h09I','h099')
call Zg('h09I',function qo)
call Qg('h09B','h06S')
call Zg('h09B',function ro)
call Qg('h09H','h098')
call Zg('h09H',function so)
call fh('h05L',600.)
call Zg('h05L',function uo)
endfunction
function xo takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h05T')
set h4[id]=$DC
set i4[id]=$DC*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h09P')
set h4[id]=$8C
set i4[id]=$8C*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h05U')
set h4[id]=375
set i4[id]=375*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h05M')
set h4[id]=$C8
set i4[id]=$C8*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h05J')
set h4[id]=$A0
set i4[id]=$A0*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h09L')
set h4[id]=$B4
set i4[id]=$B4*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h05V')
set h4[id]=270
set i4[id]=270*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h05X')
set h4[id]=$B4
set i4[id]=$B4*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h09J')
set h4[id]=$96
set i4[id]=$96*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h09I')
set h4[id]=$C8
set i4[id]=$C8*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h09B')
set h4[id]=$C8
set i4[id]=$C8*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h09H')
set h4[id]=$96
set i4[id]=$96*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h09T')
set h4[id]=340
set i4[id]=340*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h069')
set h4[id]=$FA
set i4[id]=$FA*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h06J')
set h4[id]=$BE
set i4[id]=$BE*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h05R')
set h4[id]=$8C
set i4[id]=$8C*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h097')
set h4[id]=500
set i4[id]=500*.2/100.
set j4[id]=false
set id=GetUnitPointValueByType('h05L')
set h4[id]=$F0
set i4[id]=$F0*.08/100.
set j4[id]=false
endfunction
function yo takes nothing returns nothing
call jh('z003','A09D',function eo)
call jh('h06U','A095',function fo)
endfunction
function zo takes nothing returns nothing
call wo()
call xo()
call yo()
set fd=Filter(function Zn)
set ed=Filter(function Xn)
set gd=Filter(function go)
call TimerStart(CreateTimer(),4.,true,function jo)
endfunction
function Ao takes nothing returns nothing
local unit c
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,n7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set c=CreateUnit(GetOwningPlayer(r4),'e008',GetUnitX(r4),GetUnitY(r4),.0)
call UnitAddAbility(c,'A00P')
call UnitShareVision(bj_groupRandomCurrentPick,g4,true)
call IssueTargetOrderById(c,$D00FA,bj_groupRandomCurrentPick)
call UnitShareVision(bj_groupRandomCurrentPick,g4,false)
call UnitApplyTimedLife(c,'BTLF',20.)
set c=null
endfunction
function ao takes nothing returns nothing
local unit c
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,n7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null or Oi(bj_groupRandomCurrentPick))then
return
endif
set c=CreateUnit(GetOwningPlayer(r4),'e008',GetUnitX(r4),GetUnitY(r4),.0)
call UnitAddAbility(c,'A00N')
call UnitShareVision(bj_groupRandomCurrentPick,g4,true)
call IssueTargetOrderById(c,$D0265,bj_groupRandomCurrentPick)
call UnitShareVision(bj_groupRandomCurrentPick,g4,false)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=null
endfunction
function Bo takes nothing returns nothing
local unit c
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,m7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set c=CreateUnit(g4,'e008',GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick),.0)
call UnitAddAbility(c,'A00B')
call IssueImmediateOrderById(c,$D0080)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=null
endfunction
function bo takes nothing returns nothing
local unit c=CreateUnit(GetOwningPlayer(u4),'e008',GetUnitX(u4),GetUnitY(u4),.0)
call UnitAddAbility(c,'A02T')
call IssueTargetOrderById(c,$D008F,v4)
call UnitApplyTimedLife(c,'BTLF',2.)
set c=u4
call TriggerSleepAction(1.)
if(IssueImmediateOrderById(c,$D009E))then
call TriggerSleepAction(1.)
endif
call Ii(c)
set c=null
endfunction
function Co takes nothing returns nothing
call Qg('h01Z','n00S')
call gh('h00N',function Ao)
call gh('h00M',function ao)
call Qg('h00J','n004')
call Qg('h05F','n01P')
call Qg('h01B','n007')
call gh('h00I',function Bo)
call Qg('h020','n00I')
call Qg('h021','n00J')
call Qg('h022','n00K')
call fh('h00G',700.)
call Qg('h01Y','n00H')
call Qg('h00F','n002')
call Qg('h032','n00X')
endfunction
function co takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h01Z')
set h4[id]=350
set i4[id]=350*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h00J')
set h4[id]=$AF
set i4[id]=$AF*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01B')
set h4[id]=280
set i4[id]=280*.18/100.
set j4[id]=true
set k4[id]=true
set id=GetUnitPointValueByType('h020')
set h4[id]=$AA
set i4[id]=$AA*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h021')
set h4[id]=$B4
set i4[id]=$B4*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h022')
set h4[id]=$BE
set i4[id]=$BE*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01Y')
set h4[id]=$E6
set i4[id]=$E6*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h00F')
set h4[id]=$FA
set i4[id]=$FA*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h032')
set h4[id]=$C8
set i4[id]=$C8*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h00N')
set h4[id]=750
set i4[id]=750*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h00I')
set h4[id]=360
set i4[id]=360*.18/100.
set j4[id]=false
set id=GetUnitPointValueByType('h00M')
set h4[id]=310
set i4[id]=310*.18/100.
set j4[id]=false
set id=GetUnitPointValueByType('h00G')
set h4[id]=$FA
set i4[id]=$FA*.18/100.
set j4[id]=false
set id=GetUnitPointValueByType('h05F')
set h4[id]=725
set i4[id]=725*.2/100.
set j4[id]=false
endfunction
function Naga__RegisterUnitCasts takes nothing returns nothing
call jh('n00S','A02U',function bo)
endfunction
function Do takes nothing returns nothing
call Co()
call co()
call jh('n00S','A02U',function bo)
endfunction
function Eo takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean b=GetWidgetLife(u)>.405 and IsUnitType(u,UNIT_TYPE_GROUND)and IsUnitType(u,UNIT_TYPE_SAPPER)
set u=null
return b
endfunction
function Fo takes nothing returns nothing
local player p=GetOwningPlayer(u4)
local integer i=0
local real x=GetUnitX(u4)
local real y=GetUnitY(u4)
local destructable array Go
local real an
local real r
local unit u
local real x2
local real y2
call GroupEnumUnitsInRange(f4,x,y,144.,kd)
loop
set u=FirstOfGroup(f4)
exitwhen u==null
call GroupRemoveUnit(f4,u)
if(u!=u4)then
set r=GetRandomReal(160.,218.)
set an=(GetRandomReal(135.,234.)+180.*N8[GetPlayerId(GetOwningPlayer(u))])*bj_DEGTORAD
set x2=x+r*Cos(an)
set y2=y+r*Sin(an)
call SetUnitX(u,x2)
call SetUnitY(u,y2)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\MassTeleport\\MassTeleportCaster.mdl",x2,y2))
endif
endloop
set u=u4
loop
set an=72.*I2R(i)
set Go[i]=CreateDestructable('YTct',x+120.*Cos(an*bj_DEGTORAD),y+120.*Sin(an*bj_DEGTORAD),an,1.,0)
set i=i+1
exitwhen i>=5
endloop
call TriggerSleepAction(3.)
if(GetWidgetLife(u)>.405)then
set i=0
loop
if(GetWidgetLife(Go[i])>.405)then
call KillDestructable(Go[i])
set an=72.*I2R(i)
set x2=x+112.*Cos(an*bj_DEGTORAD)
set y2=y+112.*Sin(an*bj_DEGTORAD)
call UnitApplyTimedLife(CreateUnit(p,'e00D',x2,y2,an),'B021',20.)
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\EntBirthTarget\\EntBirthTarget.mdl",x2,y2))
endif
set i=i+1
exitwhen i>=5
endloop
call Ii(u)
else
set i=0
loop
call KillDestructable(Go[i])
set i=i+1
exitwhen i>=5
endloop
endif
call TriggerSleepAction(3.)
set i=0
loop
call RemoveDestructable(Go[i])
set Go[i]=null
set i=i+1
exitwhen i>=5
endloop
set u=null
endfunction
function Ho takes nothing returns nothing
local unit c=CreateUnit(GetOwningPlayer(u4),'e008',GetUnitX(u4),GetUnitY(u4),.0)
call UnitAddAbility(c,'A0AW')
call IssueTargetOrderById(c,$D00C0,v4)
call UnitApplyTimedLife(c,'BTLF',2.)
set c=u4
call TriggerSleepAction(.8)
call Ii(c)
set c=null
endfunction
function Io takes nothing returns nothing
local unit c=CreateUnit(GetOwningPlayer(u4),'e008',GetUnitX(u4),GetUnitY(u4),.0)
call UnitAddAbility(c,'A0AW')
call IssueTargetOrderById(c,$D00C0,v4)
call UnitApplyTimedLife(c,'BTLF',2.)
set c=u4
call TriggerSleepAction(.8)
call Ii(c)
set c=null
endfunction
function lo takes nothing returns nothing
local unit u=u4
call IssueImmediateOrderById(u,$D0228)
call TriggerSleepAction(.6)
call Ii(u)
set u=null
endfunction
function Jo takes nothing returns boolean
local unit u=GetFilterUnit()
local real r=GetWidgetLife(u)
local boolean Eh=r>.405 and IsUnitAlly(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)and GetUnitAbilityLevel(u,'A08C')<=0 and GetUnitAbilityLevel(u,'Bhea')<=0 and GetUnitState(u,UNIT_STATE_MAX_LIFE)-r>200.
set u=null
return Eh
endfunction
function Ko takes nothing returns nothing
local unit u=u4
call UnitAddAbility(v4,'AId2')
call DestroyEffect(AddSpecialEffectTarget("mdx\\sfx\\sin2.mdx",v4,"overhead"))
call TriggerSleepAction(.6)
call Ii(u)
set u=null
endfunction
function Lo takes nothing returns nothing
local unit u=u4
call UnitAddAbility(v4,'AId3')
call DestroyEffect(AddSpecialEffectTarget("mdx\\sfx\\sin2.mdx",v4,"overhead"))
call TriggerSleepAction(.6)
if(IssueImmediateOrderById(u,$D009E))then
call TriggerSleepAction(1.)
endif
call Ii(u)
set u=null
endfunction
function Mo takes nothing returns nothing
local unit u=u4
call TriggerSleepAction(3.)
call IssueImmediateOrderById(u,$D00F4)
call TriggerSleepAction(3.)
call IssueImmediateOrderById(u,$D027A)
call Ii(u)
set u=null
endfunction
function No takes nothing returns nothing
local real x=GetUnitX(r4)
local real y=GetUnitY(r4)
local player p=GetOwningPlayer(r4)
local unit c=CreateUnit(p,'e008',x,y,.0)
call UnitAddAbility(c,'A0BR')
call UnitApplyTimedLife(c,'BTLF',15.)
set c=null
call UnitApplyTimedLife(CreateUnit(p,'h02V',x,y,.0),'BTLF',2.)
call EnableWeatherEffect(jd,true)
call TriggerSleepAction(6.)
call EnableWeatherEffect(jd,false)
endfunction
function Oo takes nothing returns nothing
local unit c
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,n7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null or Oi(bj_groupRandomCurrentPick))then
return
endif
set c=CreateUnit(g4,'e008',GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick),.0)
call UnitAddAbility(c,'A0BL')
call UnitShareVision(bj_groupRandomCurrentPick,g4,true)
call IssueTargetOrderById(c,$D0206,bj_groupRandomCurrentPick)
call UnitShareVision(bj_groupRandomCurrentPick,g4,false)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=null
endfunction
function Po takes nothing returns nothing
local unit c
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,m7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set c=CreateUnit(g4,'e008',GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick),.0)
call UnitAddAbility(c,hd)
call IssuePointOrderById(c,$D0275,GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick))
call UnitApplyTimedLife(c,'BTLF',5.)
set c=null
endfunction
function Qo takes nothing returns boolean
call Tg(o4,'h02J',270.,.0,.0)
return false
endfunction
function Ro takes nothing returns boolean
call Tg(o4,'h02J',270.,.0,.0)
call Tg(o4,'h02E',270.,.0,.0)
return false
endfunction
function So takes nothing returns boolean
call Tg(o4,'h02J',270.,.0,.0)
call Tg(o4,'h02E',270.,.0,.0)
call Tg(o4,'h02F',270.,-25.,-25.)
return false
endfunction
function To takes nothing returns boolean
call Tg(o4,'h02J',270.,.0,.0)
call Tg(o4,'h02E',270.,.0,.0)
call Tg(o4,'h02F',270.,-35.,-40.)
call Tg(o4,'h02G',211.,-35.,35.)
return false
endfunction
function Uo takes nothing returns boolean
call Tg(o4,'h02Q',270.,-35.,30.)
return false
endfunction
function Vo takes nothing returns boolean
call Tg(o4,'h02L',270.,.0,.0)
call Tg(o4,'h02M',270.,25,20.)
return false
endfunction
function Wo takes nothing returns boolean
call Tg(o4,'h02T',49.,-40.,20.)
return false
endfunction
function Xo takes nothing returns nothing
call Qg('n02C','n00T')
call Zg('n02C',function Qo)
call Qg('h002','n00U')
call Zg('h002',function Ro)
call Qg('h00Q','n01N')
call Zg('h00Q',function So)
call Qg('h00R','n01W')
call Zg('h00R',function To)
call Qg('h00Y','n026')
call Qg('h012','n028')
call Zg('h012',function Uo)
call Qg('h013','e006')
call Qg('h01H','e009')
call Qg('h01J','e00C')
call Qg('h023','n029')
call Qg('h024','n02B')
call Zg('h024',function Vo)
call Qg('h027','n02A')
call Qg('h028','e00F')
call Zg('h028',function Wo)
call fh('n02D',700.)
call gh('h02D',function No)
call gh('h02C',function Oo)
call gh('h02A',function Po)
endfunction
function Yo takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h002')
set h4[id]=$AA
set i4[id]=$AA*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h00Q')
set h4[id]=$C8
set i4[id]=$C8*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h00R')
set h4[id]=$FA
set i4[id]=$FA*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h00Y')
set h4[id]=$C8
set i4[id]=$C8*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h012')
set h4[id]=$C8
set i4[id]=$C8*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h013')
set h4[id]=$DC
set i4[id]=$DC*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01H')
set h4[id]=$DC
set i4[id]=$DC*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h023')
set h4[id]=260
set i4[id]=260*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h024')
set h4[id]=260
set i4[id]=260*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h027')
set h4[id]=310
set i4[id]=310*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h028')
set h4[id]=510
set i4[id]=510*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('n02D')
set h4[id]=$D2
set i4[id]=$D2*.08/100.
set j4[id]=false
set id=GetUnitPointValueByType('h01J')
set h4[id]=400
set i4[id]=400*.2/100.
set j4[id]=false
set id=GetUnitPointValueByType('h02A')
set h4[id]=350
set i4[id]=350*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h02C')
set h4[id]=$FA
set i4[id]=$FA*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h02D')
set h4[id]=600
set i4[id]=600*.12/100.
set j4[id]=false
endfunction
function Zo takes nothing returns nothing
call jh('n026','A0C0',function Ho)
call jh('n028','A0C1',function Io)
call jh('e006','A004',function Ko)
call jh('e009','A0BT',function Lo)
call jh('e00C','A0BX',function Fo)
call jh('n01W','A0AV',function Mo)
call jh('e00F','A0BJ',function lo)
endfunction
function dp takes unit u returns nothing
local real x=GetUnitX(u)
local real y=GetUnitY(u)
local real an=GetUnitFacing(u)*bj_DEGTORAD
local destructable d=CreateDestructable('VTlt',x+32.*Cos(an),y+32.*Sin(an),GetRandomReal(0,360),GetRandomReal(.5,.8),0)
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\NightElf\\NEDeathMedium\\NEDeath.mdl",GetDestructableX(d),GetDestructableY(d)))
call IssueTargetOrderById(u,$D021F,d)
call TriggerSleepAction(1.6)
call Ii(u)
call TriggerSleepAction(2.)
call RemoveDestructable(d)
set d=null
endfunction
function ep takes unit u returns nothing
call UnitRemoveAbility(u,'A0C4')
call Gi(u)
call TriggerSleepAction(5.)
call UnitRemoveBuffs(u,true,true)
call IssueImmediateOrderById(u,$D0019)
call UnitAddAbility(u,'Asla')
call UnitAddAbility(u,'A0C7')
call UnitAddAbility(u,'A0C8')
call TriggerSleepAction(10.)
call UnitRemoveAbility(u,'Asla')
call UnitRemoveAbility(u,'A0C7')
call Ii(u)
endfunction
function fp takes unit u returns nothing
call UnitRemoveAbility(u,'A0C4')
call Gi(u)
call TriggerSleepAction(5.)
call UnitRemoveBuffs(u,true,true)
call IssueImmediateOrderById(u,$D0019)
call UnitAddAbility(u,'Asla')
call UnitAddAbility(u,'A0C6')
call TriggerSleepAction(10.)
call UnitRemoveAbility(u,'Asla')
call UnitRemoveAbility(u,'A0C6')
call Ii(u)
endfunction
function gp takes nothing returns nothing
call Xo()
call Yo()
call Zo()
set md=Filter(function Jo)
set kd=Filter(function Eo)
set jd=AddWeatherEffect(bj_mapInitialPlayableArea,'FDgh')
call EnableWeatherEffect(jd,false)
endfunction
function hp takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitAlly(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)and GetUnitAbilityLevel(u,'A08C')<=0
set u=null
return Eh
endfunction
function ip takes nothing returns nothing
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,od)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Polymorph\\PolyMorphTarget.mdl",GetUnitX(r4),GetUnitY(r4)))
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\ControlMagic\\ControlMagicTarget.mdl",bj_groupRandomCurrentPick,"overhead"))
call UnitAddAbility(bj_groupRandomCurrentPick,'A08C')
call UnitAddAbility(bj_groupRandomCurrentPick,'A08D')
call UnitAddAbility(bj_groupRandomCurrentPick,'A08F')
endfunction
function jp takes nothing returns nothing
local unit u=GetTriggerUnit()
local player p
local integer id
local real x
local real y
if(IsUnitType(u,UNIT_TYPE_STRUCTURE)or(not IsUnitType(GetTriggerUnit(),UNIT_TYPE_SAPPER))or GetUnitAbilityLevel(u,'A08H')>0)then
set u=null
return
endif
set p=GetOwningPlayer(u)
set id=N8[GetPlayerId(p)]
if(pd[id]>0)then
set x=GetUnitX(u)
set y=GetUnitY(u)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIda\\AIdaCaster.mdl",x,y))
set u=CreateUnit(p,'e008',x,y,.0)
call UnitAddAbility(u,'A08A')
call IssueImmediateOrderById(u,$D012D)
call UnitApplyTimedLife(u,'BTLF',1.)
set pd[id]=pd[id]-1
if(pd[0]<=0 and pd[1]<=0)then
call DisableTrigger(qd)
endif
endif
set u=null
endfunction
function kp takes nothing returns nothing
local integer id=N8[GetPlayerId(GetOwningPlayer(r4))]
set pd[id]=pd[id]+1
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\TomeOfRetraining\\TomeOfRetrainingCaster.mdl",GetUnitX(r4),GetUnitY(r4)))
if(not IsTriggerEnabled(qd))then
call EnableTrigger(qd)
endif
endfunction
function mp takes nothing returns nothing
local effect e
local fogmodifier f
local real x
local real y
local boolean fl
local unit c
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,n7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set e=AddSpecialEffect("Abilities\\Spells\\NightElf\\Starfall\\StarfallCaster.mdl",GetUnitX(r4),GetUnitY(r4))
set x=GetUnitX(bj_groupRandomCurrentPick)
set y=GetUnitY(bj_groupRandomCurrentPick)
set fl=not J7
if(fl)then
set f=CreateFogModifierRadius(g4,FOG_OF_WAR_VISIBLE,x,y,1100.,true,false)
call FogModifierStart(f)
endif
set c=CreateUnit(g4,'e008',x,y,.0)
call UnitAddAbility(c,nd)
call IssueImmediateOrderById(c,$D00D7)
call UnitApplyTimedLife(c,'BTLF',11.)
set c=null
call TriggerSleepAction(8.)
if(fl)then
call DestroyFogModifier(f)
set f=null
endif
call DestroyEffect(e)
set e=null
endfunction
function np takes nothing returns nothing
local unit c=CreateUnit(GetOwningPlayer(u4),'e008',GetUnitX(v4),GetUnitY(v4),.0)
call UnitAddAbility(c,'A07A')
call IssueTargetOrderById(c,$D00CB,v4)
call UnitApplyTimedLife(c,'BTLF',6.)
set c=null
endfunction
function op takes nothing returns nothing
local real x
local real y
local integer i=0
local unit t
local unit c
set g4=GetOwningPlayer(u4)
set x=GetUnitX(u4)
set y=GetUnitY(u4)
call GroupEnumUnitsInRange(f4,GetUnitX(v4),GetUnitY(v4),900.,m7)
loop
set t=FirstOfGroup(f4)
set i=i+1
exitwhen i>3 or t==null
call GroupRemoveUnit(f4,t)
set c=CreateUnit(GetOwningPlayer(u4),'e008',x,y,.0)
call UnitAddAbility(c,'A07Q')
call IssueTargetOrderById(c,$D00CB,t)
call UnitApplyTimedLife(c,'BTLF',11.)
endloop
set t=null
set c=null
endfunction
function pp takes nothing returns nothing
local unit u=u4
call TriggerSleepAction(1.2)
call Ii(u)
set u=null
endfunction
function qp takes nothing returns boolean
call Tg(o4,'h08L',32.,12.,-11.5)
return false
endfunction
function rp takes nothing returns boolean
call Tg(o4,'h08D',116.,-3.,-10.5)
call Tg(o4,'h08N',323.,20.,5.75)
return false
endfunction
function sp takes nothing returns boolean
call Tg(o4,'h08A',.0,.0,.0)
return false
endfunction
function tp takes nothing returns boolean
call Tg(o4,'h08K',.0,.0,.0)
return false
endfunction
function up takes nothing returns boolean
call Tg(o4,'h08K',.0,.0,.0)
call Tg(o4,'h08S',.0,.0,.0)
return false
endfunction
function vp takes nothing returns boolean
call Tg(o4,'h08N',226.,37.75,-41.5)
return false
endfunction
function wp takes nothing returns boolean
call Tg(o4,'h08O',318,43.5,-41.75)
call Tg(o4,'h08N',$E2,-38.25,40.25)
return false
endfunction
function xp takes nothing returns boolean
call Tg(o4,'h08K',.0,15.,.0)
call Tg(o4,'h08R',.0,.0,.0)
return false
endfunction
function yp takes nothing returns boolean
call Tg(o4,'h08M',.0,.0,.0)
call Tg(o4,'h08Q',.0,.0,.0)
return false
endfunction
function zp takes nothing returns nothing
call gh('h07H',function ip)
call Zg('h07H',function qp)
call gh('h08P',function kp)
call Zg('h08P',function rp)
call fh('h073',850.)
call gh('h07I',function mp)
call Zg('h07I',function sp)
call Qg('h088','e007')
call Zg('h088',function tp)
call Qg('h07D','e00J')
call Zg('h07D',function up)
call Qg('h07M','n01Z')
call Zg('h07M',function vp)
call Qg('h07L','n020')
call Zg('h07L',function wp)
call Qg('h07O','e00B')
call Zg('h07O',function xp)
call Qg('h07N','e00A')
call Zg('h07N',function yp)
call Qg('h011','e002')
call Qg('h00S','e001')
call Qg('h03D','e003')
call Qg('h03E','e004')
call Qg('h00B','e000')
endfunction
function Ap takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h088')
set h4[id]=$BE
set i4[id]=$BE*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h07D')
set h4[id]=$D2
set i4[id]=$D2*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h07M')
set h4[id]=$C8
set i4[id]=$C8*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h07L')
set h4[id]=$AF
set i4[id]=$AF*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h07O')
set h4[id]=$E6
set i4[id]=$E6*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h07N')
set h4[id]=$F0
set i4[id]=$F0*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h011')
set h4[id]=285
set i4[id]=285*.18/100.
set j4[id]=true
set k4[id]=true
set id=GetUnitPointValueByType('h00S')
set h4[id]=$96
set i4[id]=$96*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03D')
set h4[id]=$C8
set i4[id]=$C8*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03E')
set h4[id]=400
set i4[id]=400*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h00B')
set h4[id]=260
set i4[id]=260*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h07H')
set h4[id]=$DC
set i4[id]=$DC*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h08P')
set h4[id]=$E1
set i4[id]=$E1*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h073')
set h4[id]=$D2
set i4[id]=$D2*.08/100.
set j4[id]=false
set id=GetUnitPointValueByType('h07I')
set h4[id]=650
set i4[id]=650*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h03E')
set h4[id]=400
set i4[id]=400*.2/100.
set j4[id]=false
endfunction
function ap takes nothing returns nothing
call jh('e007','A07P',function np)
call jh('e00J','A07R',function op)
call jh('e000','A0CG',function pp)
endfunction
function Bp takes nothing returns nothing
call zp()
call Ap()
call ap()
set od=Filter(function hp)
call TriggerAddAction(qd,function jp)
call TriggerRegisterAnyUnitEventBJ(qd,EVENT_PLAYER_UNIT_ATTACKED)
call DisableTrigger(qd)
endfunction
function bp takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitEnemy(u,g4)and IsUnitType(u,UNIT_TYPE_SAPPER)and IsUnitType(u,UNIT_TYPE_FLYING)
set u=null
return Eh
endfunction
function Cp takes nothing returns nothing
local unit c
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,rd)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null or Oi(bj_groupRandomCurrentPick))then
return
endif
set c=CreateUnit(g4,'e008',GetUnitX(r4),GetUnitY(r4),.0)
call UnitAddAbility(c,'A0AK')
call UnitShareVision(bj_groupRandomCurrentPick,g4,true)
call IssueTargetOrderById(c,$D007F,bj_groupRandomCurrentPick)
call UnitShareVision(bj_groupRandomCurrentPick,g4,false)
call UnitApplyTimedLife(c,'BTLF',10.)
set c=null
endfunction
function cp takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)>.405 and IsUnitEnemy(u,g4)and IsUnitType(u,UNIT_TYPE_STRUCTURE)and GetPlayerId(GetOwningPlayer(u))<$C and GetUnitTypeId(u)!='hcas'
set u=null
return Eh
endfunction
function Dp takes nothing returns nothing
local real x
local real y
local unit c
local fogmodifier f
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,sd)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set x=GetUnitX(r4)
set y=GetUnitY(r4)
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",x,y))
set c=CreateUnit(g4,'h04G',x,y,.0)
call UnitApplyTimedLife(c,'BTLF',20.)
if(J7)then
call IssueTargetOrderById(c,$D000F,bj_groupRandomCurrentPick)
else
set f=CreateFogModifierRadius(g4,FOG_OF_WAR_VISIBLE,GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick),128.,true,false)
call FogModifierStart(f)
call IssueTargetOrderById(c,$D000F,bj_groupRandomCurrentPick)
call TriggerSleepAction(.1)
call DestroyFogModifier(f)
set f=null
endif
set c=null
endfunction
function Ep takes nothing returns nothing
local real x
local real y
local unit c
local fogmodifier f
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,sd)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set x=GetUnitX(r4)
set y=GetUnitY(r4)
call DestroyEffect(AddSpecialEffect("Objects\\Spawnmodels\\Naga\\NagaDeath\\NagaDeath.mdl",x,y))
set c=CreateUnit(g4,'h04H',x,y,.0)
call UnitApplyTimedLife(c,'BTLF',20.)
if(J7)then
call IssueTargetOrderById(c,$D000F,bj_groupRandomCurrentPick)
else
set f=CreateFogModifierRadius(g4,FOG_OF_WAR_VISIBLE,GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick),128.,true,false)
call FogModifierStart(f)
call IssueTargetOrderById(c,$D000F,bj_groupRandomCurrentPick)
call TriggerSleepAction(.1)
call DestroyFogModifier(f)
set f=null
endif
set c=null
endfunction
function Fp takes nothing returns nothing
local integer i=0
local real x
local real y
local real an
local unit u
local unit c
local integer t
loop
exitwhen i>=vd
set u=ud[i]
set an=GetUnitFacing(u)
set x=GetUnitX(u)+10.*Cos(an*bj_DEGTORAD)
if(x>=yd or x<=xd or GetWidgetLife(u)<.405)then
call RemoveUnit(u)
set vd=vd-1
set ud[i]=ud[vd]
else
set y=GetUnitY(u)+10.*Sin(an*bj_DEGTORAD)
if(y>=Ad or y<=zd)then
set y=GetUnitY(u)+30.*Sin((360.-an)*bj_DEGTORAD)
call SetUnitFacing(u,360.-an)
endif
call SetUnitX(u,x)
call SetUnitY(u,y)
set t=GetUnitUserData(u)+1
if(t>50)then
set t=0
set g4=GetOwningPlayer(u)
call GroupEnumUnitsInRange(f4,x,y,700.,n7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick!=null)then
if(IsUnitType(bj_groupRandomCurrentPick,UNIT_TYPE_FLYING))then
set c=CreateUnit(GetOwningPlayer(r4),'e008',GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick),.0)
call UnitAddAbility(c,'A082')
call UnitShareVision(bj_groupRandomCurrentPick,g4,true)
call IssueTargetOrderById(c,$D007F,bj_groupRandomCurrentPick)
call UnitShareVision(bj_groupRandomCurrentPick,g4,false)
call UnitApplyTimedLife(c,'BTLF',2.)
else
set c=CreateUnit(GetOwningPlayer(r4),'e008',GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick),.0)
call UnitAddAbility(c,'A083')
call UnitShareVision(bj_groupRandomCurrentPick,g4,true)
call IssueTargetOrderById(c,$D007F,bj_groupRandomCurrentPick)
call UnitShareVision(bj_groupRandomCurrentPick,g4,false)
call UnitApplyTimedLife(c,'BTLF',2.)
set c=CreateUnit(GetOwningPlayer(r4),'e008',GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick),.0)
call UnitAddAbility(c,'A04H')
call UnitShareVision(bj_groupRandomCurrentPick,g4,true)
call IssueTargetOrderById(c,$D00CB,bj_groupRandomCurrentPick)
call UnitShareVision(bj_groupRandomCurrentPick,g4,false)
call UnitApplyTimedLife(c,'BTLF',16.)
endif
endif
endif
call SetUnitUserData(u,t)
set i=i+1
endif
endloop
if(vd==0)then
call PauseTimer(td)
endif
set u=null
set c=null
endfunction
function Gp takes nothing returns nothing
local unit u=r4
local real x=GetUnitX(u)
local real y=GetUnitY(u)
local player p=GetOwningPlayer(u)
local real an=N8[GetPlayerId(p)]*180.
local integer i=0
local unit c
call SetUnitAnimation(u,"death")
call TriggerSleepAction(1.5)
call TimerStart(td,.04,true,function Fp)
loop
set c=CreateUnit(p,'h08U',x,y,ModuloReal(an+GetRandomReal(-55.,55.)+360.,360.))
if(T7)then
call UnitRemoveAbility(c,'A080')
call UnitAddAbility(c,'A084')
endif
set ud[vd]=c
set vd=vd+1
set i=i+1
exitwhen i>2
endloop
set c=null
call EnableWeatherEffect(wd,true)
call TriggerSleepAction(3.7)
call SetUnitAnimation(u,"stand")
call TriggerSleepAction(2.6)
call EnableWeatherEffect(wd,false)
set u=null
endfunction
function Hp takes nothing returns boolean
call SetUnitVertexColor(o4,0,$A6,$FF,'s')
return false
endfunction
function Ip takes nothing returns nothing
local unit c=CreateUnit(GetOwningPlayer(u4),'e008',GetUnitX(u4),GetUnitY(u4),.0)
call UnitAddAbility(c,'A05D')
call IssueImmediateOrderById(c,$D009F)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=null
endfunction
function lp takes nothing returns nothing
local unit c=CreateUnit(GetOwningPlayer(u4),'e008',GetUnitX(u4),GetUnitY(u4),.0)
call UnitAddAbility(c,'A043')
call IssueTargetOrderById(c,$D0102,v4)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=null
endfunction
function Jp takes nothing returns nothing
local unit c=CreateUnit(GetOwningPlayer(u4),'e008',GetUnitX(u4),GetUnitY(u4),.0)
call UnitAddAbility(c,'A05B')
call IssueImmediateOrderById(c,$D026C)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=null
endfunction
function Kp takes nothing returns nothing
call gh('h047',function Cp)
call gh('h048',function Dp)
call gh('h03L',function Ep)
call gh('h03O',function Gp)
call Qg('h049','n017')
call Qg('h04F','n018')
call Qg('h03W','n016')
call Qg('h03T','n012')
call Qg('h043','n013')
call Qg('h03S','n014')
call Zg('h03S',function Hp)
call Qg('h03K','n015')
call Qg('h03J','o00A')
call fh('h03Q',750.)
call Qg('h03U','n011')
call Qg('h03I','n010')
endfunction
function Lp takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h049')
set h4[id]='s'
set i4[id]='s'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h04F')
set h4[id]='}'
set i4[id]='}'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03W')
set h4[id]=$FA
set i4[id]=$FA*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03T')
set h4[id]=275
set i4[id]=275*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h043')
set h4[id]=$E1
set i4[id]=$E1*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03S')
set h4[id]=400
set i4[id]=400*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03K')
set h4[id]=$AF
set i4[id]=$AF*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03J')
set h4[id]=$96
set i4[id]=$96*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03U')
set h4[id]=$A0
set i4[id]=$A0*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03I')
set h4[id]=280
set i4[id]=280*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h047')
set h4[id]=$BE
set i4[id]=$BE*.12/100.
set j4[id]=false
set id=GetUnitPointValueByType('h03Q')
set h4[id]=$E6
set i4[id]=$E6*.08/100.
set j4[id]=false
set id=GetUnitPointValueByType('h048')
set h4[id]=$D2
set i4[id]=$D2*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h03L')
set h4[id]=290
set i4[id]=290*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h03O')
set h4[id]=600
set i4[id]=600*.09/100.
set j4[id]=false
endfunction
function Mp takes nothing returns nothing
call jh('n016','A05E',function Ip)
call jh('n013','A05C',function Jp)
call jh('n014','A044',function lp)
endfunction
function Np takes nothing returns nothing
call Kp()
call Lp()
call Mp()
set rd=Filter(function bp)
set sd=Filter(function cp)
set xd=GetRectMinX(bj_mapInitialPlayableArea)
set yd=GetRectMaxX(bj_mapInitialPlayableArea)
set zd=GetRectMinY(bj_mapInitialPlayableArea)
set Ad=GetRectMaxY(bj_mapInitialPlayableArea)
set wd=AddWeatherEffect(bj_mapInitialPlayableArea,'SNhs')
call EnableWeatherEffect(wd,false)
endfunction
function Op takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=GetWidgetLife(u)<.405 and IsUnitType(u,UNIT_TYPE_SAPPER)
set u=null
return Eh
endfunction
function Pp takes nothing returns nothing
local real x
local real y
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,ad)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set x=GetUnitX(bj_groupRandomCurrentPick)
set y=GetUnitY(bj_groupRandomCurrentPick)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIam\\AIamTarget.mdl",x,y))
if(GetRandomInt(0,99)<$A)then
call Ii(CreateUnit(GetOwningPlayer(r4),Bd[3],x,y,.0))
else
call Ii(CreateUnit(GetOwningPlayer(r4),Bd[GetRandomInt(0,2)],x,y,.0))
endif
call RemoveUnit(bj_groupRandomCurrentPick)
endfunction
function Qp takes nothing returns nothing
local real x
local real y
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,ad)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
set x=GetUnitX(bj_groupRandomCurrentPick)
set y=GetUnitY(bj_groupRandomCurrentPick)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIam\\AIamTarget.mdl",x,y))
if(GetRandomInt(0,99)<$A)then
call Ii(CreateUnit(GetOwningPlayer(r4),Bd[7],x,y,.0))
else
call Ii(CreateUnit(GetOwningPlayer(r4),Bd[GetRandomInt(1,6)],x,y,.0))
endif
call RemoveUnit(bj_groupRandomCurrentPick)
endfunction
function Rp takes nothing returns nothing
local unit u
set g4=GetOwningPlayer(r4)
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,n7)
set bj_groupRandomConsidered=0
set bj_groupRandomCurrentPick=null
call ForGroup(f4,function GroupPickRandomUnitEnum)
if(bj_groupRandomCurrentPick==null)then
return
endif
if not Oi(bj_groupRandomCurrentPick)then
call UnitDamageTarget(r4,bj_groupRandomCurrentPick,50000.,true,false,ATTACK_TYPE_NORMAL,DAMAGE_TYPE_DEATH,WEAPON_TYPE_WHOKNOWS)
endif
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Undead\\DeathCoil\\DeathCoilSpecialArt.mdl",GetUnitX(bj_groupRandomCurrentPick),GetUnitY(bj_groupRandomCurrentPick)))
set u=r4
call SetUnitAnimation(u,"work")
call TriggerSleepAction(1.)
call SetUnitAnimation(u,"stand")
set u=null
endfunction
function Sp takes nothing returns nothing
call Qg('h01K','u005')
call Qg('h04B','u009')
call Qg('h055','u00D')
call fh('h01O',800.)
call Qg('h01T','n00E')
call gh('h01P',function Pp)
call gh('h056',function Qp)
call Qg('h01N','h01U')
call Qg('h054','h05H')
call Qg('h01L','u001')
call Qg('h01S','u000')
call gh('h00A',function Rp)
call Qg('h01R','n00B')
call Qg('h04Z','n01K')
call Qg('h03M','u007')
endfunction
function Tp takes nothing returns nothing
local integer id
set id=GetUnitPointValueByType('h01K')
set h4[id]=$D2
set i4[id]=$D2*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h04B')
set h4[id]=$AA
set i4[id]=$AA*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01T')
set h4[id]=370
set i4[id]=370*.18/100.
set j4[id]=true
set k4[id]=true
set id=GetUnitPointValueByType('h01P')
set h4[id]=$A0
set i4[id]=$A0*.12/100.
set j4[id]=true
set id=GetUnitPointValueByType('h056')
set h4[id]=$8C
set i4[id]=$8C*.12/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01N')
set h4[id]=230
set i4[id]=230*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h054')
set h4[id]=210
set i4[id]=210*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01L')
set h4[id]=290
set i4[id]=290*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01S')
set h4[id]=500
set i4[id]=500*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01R')
set h4[id]='x'
set i4[id]='x'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h04Z')
set h4[id]='d'
set i4[id]='d'*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h03M')
set h4[id]=$CD
set i4[id]=$CD*.2/100.
set j4[id]=true
set id=GetUnitPointValueByType('h01O')
set h4[id]=$C8
set i4[id]=$C8*.08/100.
set j4[id]=false
set id=GetUnitPointValueByType('h055')
set h4[id]=370
set i4[id]=370*.2/100.
set j4[id]=false
set id=GetUnitPointValueByType('h00A')
set h4[id]=360
set i4[id]=360*.09/100.
set j4[id]=false
set id=GetUnitPointValueByType('h01Q')
set h4[id]=650
set i4[id]=650*.09/100.
set j4[id]=false
endfunction
function Up takes nothing returns nothing
endfunction
function Vp takes nothing returns nothing
local unit u=GetSummonedUnit()
local integer Sg=GetUnitTypeId(u)
if(Sg=='u004')then
call Ii(ReplaceUnitBJ(u,Bd[GetRandomInt(0,2)],2))
elseif(Sg=='u008')then
call Ii(ReplaceUnitBJ(u,Bd[GetRandomInt(0,6)],2))
elseif(Sg=='u00E')then
set Sg=GetRandomInt(0,7)
if(Sg==0)then
set Sg=7
else
set Sg=GetRandomInt(3,6)
endif
call Ii(ReplaceUnitBJ(u,Bd[Sg],2))
call UnitAddAbility(bj_lastReplacedUnit,'A088')
call UnitAddAbility(bj_lastReplacedUnit,'A089')
endif
set u=null
endfunction
function Wp takes unit k,unit d,integer Ug returns nothing
local real x=GetUnitX(d)
local real y=GetUnitY(d)
call CreateUnit(GetOwningPlayer(k),Ug,x,y,.0)
call RemoveUnit(d)
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Items\\AIam\\AIamTarget.mdl",x,y))
endfunction
function Xp takes nothing returns nothing
local trigger t
call Sp()
call Tp()
call Up()
set ad=Filter(function Op)
set Bd[0]='u002'
set Bd[1]='n00D'
set Bd[2]='u00A'
set Bd[3]='n00C'
set Bd[4]='u00B'
set Bd[5]='n01L'
set Bd[6]='u003'
set Bd[7]='n01M'
set t=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(t,EVENT_PLAYER_UNIT_SUMMON)
call TriggerAddAction(t,function Vp)
endfunction
function Yp takes unit u,real x,real y returns nothing
local unit c=CreateUnit(GetOwningPlayer(u),'e008',x,y,.0)
call UnitAddAbility(c,'A086')
call IssuePointOrderById(c,$D00FD,x,y)
call UnitApplyTimedLife(c,'BTLF',6.)
set c=null
endfunction
function Zp takes unit u,unit v returns nothing
local integer i=GetRandomInt(0,99)
if(i<$F and GetUnitAbilityLevel(v,'A070')<=0 and not IsUnitType(v,UNIT_TYPE_MECHANICAL))then
if(GetWidgetLife(v)<.405)then
return
endif
call SetUnitState(u,UNIT_STATE_LIFE,GetUnitState(u,UNIT_STATE_LIFE)+GetUnitState(v,UNIT_STATE_LIFE)/2.)
call UnitDamageTarget(u,v,10000.,true,false,ATTACK_TYPE_CHAOS,DAMAGE_TYPE_DEATH,WEAPON_TYPE_WHOKNOWS)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Orc\\AncestralSpirit\\AncestralSpiritCaster.mdl",v,"chest"))
elseif(i<25)then
call Yp(u,GetUnitX(v),GetUnitY(v))
endif
endfunction
function dq takes unit u,unit v returns nothing
local unit c
if(GetRandomInt(0,99)<$F)then
set c=CreateUnit(GetOwningPlayer(u),'e008',GetUnitX(u),GetUnitY(u),.0)
call UnitAddAbility(c,'A09T')
call IssueTargetOrderById(c,$D0097,v)
call UnitApplyTimedLife(c,'BTLF',4.)
set c=null
endif
endfunction
function eq takes unit v returns nothing
local integer i=GetUnitAbilityLevel(v,'A0C9')
if(i<=0)then
call UnitAddAbility(v,'A0C9')
elseif(i<3)then
call SetUnitAbilityLevel(v,'A0C9',i+1)
endif
endfunction
function fq takes unit v returns nothing
local unit u
if(GetRandomInt(0,99)<5)then
set u=CreateUnit(GetOwningPlayer(v),'e008',GetUnitX(v),GetUnitY(v),.0)
call UnitAddAbility(u,'A0B7')
call IssueTargetOrderById(u,$D0062,v)
call UnitApplyTimedLife(u,'BTLF',2.)
set u=CreateUnit(GetOwningPlayer(v),'e008',GetUnitX(v),GetUnitY(v),.0)
call UnitAddAbility(u,'A0B5')
call IssueTargetOrderById(u,$D0085,v)
call UnitApplyTimedLife(u,'BTLF',2.)
set u=null
endif
endfunction
function gq takes unit v returns nothing
local unit u
if(GetRandomInt(0,99)<$A)then
set u=CreateUnit(GetOwningPlayer(v),'e008',GetUnitX(v),GetUnitY(v),.0)
call UnitAddAbility(u,'A0B8')
call IssueTargetOrderById(u,$D0062,v)
call UnitApplyTimedLife(u,'BTLF',2.)
set u=CreateUnit(GetOwningPlayer(v),'e008',GetUnitX(v),GetUnitY(v),.0)
call UnitAddAbility(u,'A0B6')
call IssueTargetOrderById(u,$D0085,v)
call UnitApplyTimedLife(u,'BTLF',2.)
set u=null
endif
endfunction
function hq takes unit u returns nothing
if(GetRandomInt(0,99)<$F)then
call UnitRemoveBuffsEx(u,true,false,true,false,false,false,false)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl",u,"overhead"))
endif
endfunction
function iq takes unit u returns nothing
if(GetRandomInt(0,99)<20)then
call UnitRemoveBuffsEx(u,true,false,true,false,false,false,false)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl",u,"overhead"))
endif
endfunction
function jq takes nothing returns nothing
local unit u=GetEnumUnit()
call UnitRemoveBuffsEx(u,true,false,true,false,false,false,false)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\MarkOfChaos\\MarkOfChaosDone.mdl",u,"overhead"))
set u=null
endfunction
function kq takes unit u,unit t returns nothing
set g4=GetOwningPlayer(u)
if(GetRandomInt(0,99)<25)then
call GroupEnumUnitsInRange(f4,GetUnitX(t),GetUnitY(t),100.,n7)
call ForGroup(f4,function jq)
endif
endfunction
function mq takes nothing returns boolean
local unit s=GetEventDamageSource()
local unit u=GetTriggerUnit()
local integer nq
if(GetUnitAbilityLevel(s,'A03Q')>0)then
set nq=GetUnitTypeId(s)
if(nq=='u00D')then
call Zp(s,u)
elseif(nq=='h05L')then
call dq(s,u)
elseif(nq=='n02A')then
call eq(u)
elseif(nq=='n02B')then
call UnitRemoveAbility(s,'A0C8')
elseif(nq=='e006')then
call hq(u)
elseif(nq=='e009')then
call iq(u)
elseif(nq=='e00C')then
call kq(s,u)
endif
endif
if(GetWidgetLife(u)>.405 and GetUnitAbilityLevel(u,'A0C5')>0)then
set nq=GetUnitTypeId(u)
if(nq=='n029')then
call fq(u)
if(GetUnitAbilityLevel(u,'A0C4')>0 and GetWidgetLife(u)<255.)then
call fp(u)
else
call UnitRemoveAbility(u,'Asla')
call UnitRemoveAbility(u,'A0C6')
endif
elseif(nq=='n02B')then
call gq(u)
if(GetUnitAbilityLevel(u,'A0C4')>0 and GetWidgetLife(u)<255.)then
call ep(u)
else
call UnitRemoveAbility(u,'Asla')
call UnitRemoveAbility(u,'A0C7')
endif
endif
endif
set u=null
set s=null
return false
endfunction
function oq takes nothing returns nothing
if(bd!=null)then
call TriggerClearActions(bd)
call DestroyTrigger(bd)
endif
set bd=CreateTrigger()
call TriggerAddAction(bd,function mq)
endfunction
function pq takes nothing returns nothing
call CustomVictoryBJ(GetEnumPlayer(),true,true)
endfunction
function qq takes nothing returns nothing
call CustomDefeatBJ(GetEnumPlayer(),"You were defeated!")
endfunction
function rq takes nothing returns nothing
call RemoveUnit(GetEnumUnit())
endfunction
function sq takes nothing returns nothing
local unit u=GetEnumUnit()
call ShowUnit(u,false)
call KillUnit(u)
call RemoveUnit(u)
set u=null
endfunction
function tq takes nothing returns nothing
call RemoveItem(GetEnumItem())
endfunction
function uq takes nothing returns nothing
local integer i=0
set Cd=false
set n9=true
call FogEnable(false)
call PauseTimer(q7)
call PauseTimer(r7)
call PauseTimer(T9)
call PauseTimer(C7)
call Eg(false)
call DestroyFogModifier(re)
call DestroyFogModifier(se)
call TriggerClearActions(cd)
call DestroyTrigger(cd)
call TriggerClearActions(Dd)
call DestroyTrigger(Dd)
call CinematicFadeBJ(1,2,"ReplaceableTextures\\CameraMasks\\Black_mask.blp",0,0,0,6.)
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"The Score is |cffFF0000West|r: |cffFFCC00"+I2S(q8[0])+" |cff00FF00East|r:|cffFFCC00 "+I2S(q8[1])+"|r. Number of wins for overall victory: |cffFFCC00"+I2S(M7)+"|r")
call Vn()
call TriggerSleepAction(6.)
set J7=false
set pf=false
loop
call GroupEnumUnitsOfPlayer(f4,Player(i),Fd)
call ForGroup(f4,function sq)
set i=i+1
exitwhen i>$B
endloop
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,Fd)
call ForGroup(f4,function rq)
call TriggerSleepAction(3.)
set i=0
loop
call GroupEnumUnitsOfPlayer(f4,Player(i),Fd)
call ForGroup(f4,function sq)
set i=i+1
exitwhen i>$B
endloop
call GroupEnumUnitsInRect(f4,bj_mapInitialPlayableArea,Fd)
call ForGroup(f4,function rq)
set pf=true
set pd[0]=0
set pd[1]=0
call EnumItemsInRect(bj_mapInitialPlayableArea,null,function tq)
if(Gd>0)then
call TriggerSleepAction(11.)
if(Gd==2)then
call ForForce(J8,function pq)
call ForForce(K8,function qq)
else
call ForForce(K8,function pq)
call ForForce(J8,function qq)
endif
else
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,10.,"Preparing for new round...")
call TriggerSleepAction(7.)
call TriggerExecute(qe)
endif
endfunction
function vq takes nothing returns boolean
local unit u=GetFilterUnit()
local boolean Eh=(GetPlayerId(GetOwningPlayer(u))<$C or GetUnitAbilityLevel(u,'Aloc')>=1)and GetUnitAbilityLevel(u,'A02E')<1
set u=null
return Eh
endfunction
function wq takes nothing returns nothing
if(not Cd)then
return
endif
set q8[1]=q8[1]+1
call dj(5,2,I2S(q8[1]))
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cff00FF00Eastern Forces|r have won the round!")
if(q8[1]>=M7)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffFFFF00Congratulations! |cff00FF00Eastern Forces|r|cffFFFF00 have won the match! Game ends in one minute.|r")
set Gd=1
set l7=true
call TriggerEvaluate(gameEndTrigger)
endif
call uq()
endfunction
function xq takes nothing returns nothing
if(not Cd)then
return
endif
set q8[0]=q8[0]+1
call dj(5,1,I2S(q8[0]))
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffFF0000Western Forces|r have won the round!")
if(q8[0]>=M7)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffFFFF00Congratulations! |cffFF0000Western Forces|r|cffFFFF00 have won the match! Game ends in one minute.|r")
set Gd=2
set l7=true
call TriggerEvaluate(gameEndTrigger)
endif
call uq()
endfunction
function yq takes nothing returns nothing
if(not Cd)then
return
endif
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffFFAC00All players have voted for a draw, round will restart!|r")
call uq()
endfunction
function zq takes nothing returns nothing
set Fd=Filter(function vq)
set Ed=CreateTrigger()
call TriggerAddAction(Ed,function yq)
endfunction
function Aq takes nothing returns nothing
local integer i=0
loop
if(v7[i]!=null)then
if(GetLocalPlayer()==Player(i))then
call MultiboardDisplay(v7[i],true)
endif
else
if(GetLocalPlayer()==Player(i))then
call MultiboardDisplay(y7,true)
endif
endif
set i=i+1
exitwhen i>$B
endloop
endfunction
function aq takes nothing returns nothing
local integer i=0
local integer x=0
local multiboarditem Bq
local player p
loop
if(w7[i]!=null)then
set p=Player(i)
set Bq=MultiboardGetItem(w7[i],x7[i],3)
call MultiboardSetItemValue(Bq,I2S(GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)))
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(w7[i],x7[i],4)
call MultiboardSetItemValue(Bq,I2S(GetPlayerState(p,PLAYER_STATE_RESOURCE_LUMBER)))
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(w7[i],x7[i],5)
call MultiboardSetItemValue(Bq,I2S(GetPlayerState(p,PLAYER_STATE_RESOURCE_FOOD_USED))+"/"+I2S(GetPlayerState(p,PLAYER_STATE_RESOURCE_FOOD_CAP)))
call MultiboardReleaseItem(Bq)
endif
if(z7[i]>0)then
set p=Player(i)
if(IsPlayerInForce(p,J8))then
set x=0
else
set x=6
endif
set Bq=MultiboardGetItem(y7,z7[i],x+2)
call MultiboardSetItemValue(Bq,I2S(GetPlayerState(p,PLAYER_STATE_RESOURCE_GOLD)))
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,z7[i],x+3)
call MultiboardSetItemValue(Bq,I2S(GetPlayerState(p,PLAYER_STATE_RESOURCE_LUMBER)))
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,z7[i],x+4)
call MultiboardSetItemValue(Bq,I2S(W9[i]))
call MultiboardReleaseItem(Bq)
endif
set i=i+1
exitwhen i>$B
endloop
set Bq=null
endfunction
function bq takes integer xh,string Cq returns nothing
local integer i=0
local integer j=0
local multiboarditem Bq
call MultiboardSetRowCount(v7[xh],CountPlayersInForceBJ(O8[xh])+6)
set Bq=MultiboardGetItem(v7[xh],4,0)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],4,1)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],4,2)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],4,3)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],4,4)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],4,5)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],5,0)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],5,1)
call MultiboardSetItemStyle(Bq,true,false)
call MultiboardSetItemValue(Bq,Cq)
call MultiboardSetItemWidth(Bq,.1)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],5,2)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],5,3)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],5,4)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],5,5)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardReleaseItem(Bq)
loop
if(IsPlayerInForce(Player(i),O8[xh]))then
set Bq=MultiboardGetItem(v7[xh],j+6,0)
call MultiboardSetItemStyle(Bq,true,false)
call MultiboardSetItemValue(Bq,Q8[i])
call MultiboardSetItemWidth(Bq,.09)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],j+6,1)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardSetItemWidth(Bq,.0001)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],j+6,2)
call MultiboardSetItemStyle(Bq,false,false)
call MultiboardSetItemWidth(Bq,.0001)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],j+6,3)
call MultiboardSetItemStyle(Bq,true,true)
call MultiboardSetItemIcon(Bq,"UI\\Feedback\\Resources\\ResourceGold.blp")
call MultiboardSetItemWidth(Bq,.035)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],j+6,4)
call MultiboardSetItemStyle(Bq,true,true)
call MultiboardSetItemIcon(Bq,"UI\\Feedback\\Resources\\ResourceLumber.blp")
call MultiboardSetItemWidth(Bq,.035)
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(v7[xh],j+6,5)
call MultiboardSetItemStyle(Bq,true,true)
call MultiboardSetItemIcon(Bq,"UI\\Feedback\\Resources\\ResourceManaStone.blp")
call MultiboardSetItemWidth(Bq,.03)
call MultiboardReleaseItem(Bq)
set w7[i]=v7[xh]
set x7[i]=j+6
set j=j+1
endif
set i=i+1
exitwhen i>$B or j>=n8
endloop
set Bq=null
endfunction
function cq takes nothing returns nothing
local integer i=IMaxBJ(CountPlayersInForceBJ(J8),CountPlayersInForceBJ(K8))
local integer j=0
local multiboarditem Bq
call MultiboardSetTitleText(y7,Hd)
call MultiboardSetRowCount(y7,6+i)
set A7=4+i
call MultiboardSetColumnCount(y7,$B)
call MultiboardSetItemStyleBJ(y7,0,0,true,false)
call MultiboardSetItemWidthBJ(y7,1,0,8.)
call MultiboardSetItemWidthBJ(y7,6,0,1.)
call MultiboardSetItemWidthBJ(y7,7,0,8.)
set Bq=MultiboardGetItem(y7,A7+1,0)
call MultiboardSetItemWidth(Bq,10.)
call MultiboardReleaseItem(Bq)
set i=0
loop
set Bq=MultiboardGetItem(y7,0,i+0)
call MultiboardSetItemValue(Bq,"|cffFFFF80Team|r")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,0,i+1)
call MultiboardSetItemValue(Bq,"|cffFFFF80Resc.|r")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,0,i+2)
call MultiboardSetItemValue(Bq,"|cffFFFF80Destr.|r")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,0,i+3)
call MultiboardSetItemValue(Bq,"|cffFFFF80Income|r")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,0,i+4)
call MultiboardSetItemValue(Bq,"|cffFFFF80Wins|r")
call MultiboardReleaseItem(Bq)
call MultiboardSetItemWidthBJ(y7,i+5,0,1.8)
set i=i+(6)
exitwhen i>6
endloop
set Bq=MultiboardGetItem(y7,1,0)
call MultiboardSetItemValue(Bq,"|cffFF0000West|r")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,1,6)
call MultiboardSetItemValue(Bq,"|cff00FF00East|r")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,1,2)
call MultiboardSetItemValue(Bq,"0")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,1,8)
call MultiboardSetItemValue(Bq,"0")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,1,4)
call MultiboardSetItemValue(Bq,I2S(q8[0]))
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,1,$A)
call MultiboardSetItemValue(Bq,I2S(q8[1]))
call MultiboardReleaseItem(Bq)
set i=0
loop
set Bq=MultiboardGetItem(y7,3,i+0)
call MultiboardSetItemValue(Bq,"|cffFFFF80Player|r")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,3,i+1)
call MultiboardSetItemStyle(Bq,false,true)
call MultiboardSetItemIcon(Bq,"ReplaceableTextures\\CommandButtons\\BTNHolyBolt.blp")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,3,i+2)
call MultiboardSetItemStyle(Bq,false,true)
call MultiboardSetItemIcon(Bq,"UI\\Feedback\\Resources\\ResourceGold.blp")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,3,i+3)
call MultiboardSetItemStyle(Bq,false,true)
call MultiboardSetItemIcon(Bq,"UI\\Feedback\\Resources\\ResourceLumber.blp")
call MultiboardReleaseItem(Bq)
set Bq=MultiboardGetItem(y7,3,i+4)
call MultiboardSetItemStyle(Bq,false,true)
call MultiboardSetItemIcon(Bq,"ReplaceableTextures\\CommandButtons\\BTNChestOfGold.blp")
call MultiboardReleaseItem(Bq)
set i=i+(6)
exitwhen i>6
endloop
set i=0
set j=4
loop
if(IsPlayerInForce(Player(i),J8))then
set z7[i]=j
set Bq=MultiboardGetItem(y7,z7[i],0)
call MultiboardSetItemValue(Bq,Q8[i])
call MultiboardReleaseItem(Bq)
set j=j+1
else
set z7[i]=0
endif
set i=i+1
exitwhen i>$B
endloop
set i=0
set j=4
loop
if(IsPlayerInForce(Player(i),K8))then
set z7[i]=j
set Bq=MultiboardGetItem(y7,z7[i],6)
call MultiboardSetItemValue(Bq,Q8[i])
call MultiboardReleaseItem(Bq)
set j=j+1
endif
set i=i+1
exitwhen i>$B
endloop
set Bq=null
endfunction
function Dq takes nothing returns nothing
local integer i=0
local player p
local string Eq
if(n8>0)then
set Eq=GetLocalizedString("TEAM_RESOURCES")
set Eq=Eq+(":")
if(T4)then
call lj()
endif
endif
if(T4)then
call zi()
endif
if(y7!=null)then
call DestroyMultiboard(y7)
endif
set y7=CreateMultiboard()
call cq()
loop
set p=Player(i)
if(O8[i]!=null)then
if(v7[i]!=null)then
call DestroyMultiboard(v7[i])
endif
set v7[i]=CreateMultiboard()
call MultiboardSetRowCount(v7[i],4)
call MultiboardSetColumnCount(v7[i],6)
call MultiboardSetTitleText(v7[i],Hd)
call MultiboardSetItemStyleBJ(v7[i],0,0,true,false)
call MultiboardSetItemValueBJ(v7[i],0,0,"0")
call MultiboardSetItemValueBJ(v7[i],0,4,"")
call MultiboardSetItemColorBJ(v7[i],6,0,'d',90.,.0,0)
call MultiboardSetItemValueBJ(v7[i],1,1,"")
call MultiboardSetItemValueBJ(v7[i],2,1,"Resc.")
call MultiboardSetItemValueBJ(v7[i],3,1,"Coins")
call MultiboardSetItemValueBJ(v7[i],4,1,"Destr.")
call MultiboardSetItemValueBJ(v7[i],5,1,"Income")
call MultiboardSetItemValueBJ(v7[i],6,1,"|cffFFFF80Wins|r")
call MultiboardSetItemValueBJ(v7[i],1,2,"|cffFF0000West|r")
call MultiboardSetItemValueBJ(v7[i],1,3,"|cff00FF00East|r")
call MultiboardSetItemValueBJ(v7[i],1,4,"|cffFFFF00Round Time:|r")
call MultiboardSetItemValueBJ(v7[i],6,4,"|cffFFFF000|cffFF8000:|cffFFFF0000|r")
call MultiboardSetItemWidthBJ(v7[i],0,4,2.)
call MultiboardSetItemWidthBJ(v7[i],1,4,7.)
call MultiboardSetItemWidthBJ(v7[i],6,4,3.)
if(n8>0)then
call bq(i,Eq)
endif
endif
set i=i+1
exitwhen i>$B
endloop
if(Id==null)then
set Id=CreateTimer()
call TimerStart(Id,1.,true,function aq)
endif
call dj(5,1,I2S(q8[0]))
call dj(5,2,I2S(q8[1]))
call Aq()
endfunction
function Fq takes nothing returns nothing
local integer i=0
loop
if(Jd[i]>3)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[i]+" |c00ff0000have used stopping bug!|r")
endif
set Jd[i]=0
set i=i+1
exitwhen i>$B
endloop
endfunction
function Gq takes nothing returns boolean
local unit u=GetTriggerUnit()
if(GetIssuedOrderId()==$D0003)then
if(IsUnitType(u,UNIT_TYPE_SAPPER))then
call li(u)
elseif(GetUnitTypeId(u)=='h001')then
call xn(u)
endif
endif
set u=null
return false
endfunction
function Hq takes nothing returns boolean
local unit u=GetTriggerUnit()
local integer xh=GetPlayerId(GetOwningPlayer(u))
if(GetIssuedOrderId()==$D0003)then
if(IsUnitType(u,UNIT_TYPE_SAPPER))then
call li(u)
set Jd[xh]=Jd[xh]+1
elseif(GetUnitTypeId(u)=='h001')then
call xn(u)
endif
endif
set u=null
return false
endfunction
function Iq takes nothing returns nothing
if(ld!=null)then
return
endif
set ld=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(ld,EVENT_PLAYER_UNIT_ISSUED_TARGET_ORDER)
call TriggerRegisterAnyUnitEventBJ(ld,EVENT_PLAYER_UNIT_ISSUED_POINT_ORDER)
if(g8)then
call TriggerAddCondition(ld,Condition(function Hq))
call TimerStart(CreateTimer(),1.5,true,function Fq)
else
call TriggerAddCondition(ld,Condition(function Gq))
endif
endfunction
function lq takes boolean fl returns nothing
local string s1
local string s2
if((not fl)and Pd)then
return
endif
set Pd=true
if(M7==1)then
if(L7==0)then
set s1=Q8[0]+" has chosen single round/pick race. You may pick your race! The first round determines the winner!"
set s2="Single Round Pick"
elseif(L7==1)then
set s1=Q8[0]+" has chosen single round/random race. You will get a random race! The first round determines the winner!"
set s2="Single Round Random"
elseif(L7==2)then
set s1=Q8[0]+" has chosen single round/mirror mode. Both teams will get the same random races! The first round determines the winner!"
set s2="Single Round Random"
elseif(L7==3)then
set s1=Q8[0]+" has chosen single round/draft race. Races will be drafted! The first round determines the winner!"
set s2="Single Round Draft"
endif
else
if(R7)then
if(L7==0)then
set s1=Q8[0]+" has chosen |cffFFFF00pick|r race. You may pick a race at the beginning that you keep for the |cffFFFF00whole game|r! Number of wins for overall victory: |cffFFFF00"+I2S(M7)+"|r"
set s2="Pick once, |cffFFCC00"+I2S(M7)+"|cffFFFF80 wins"
elseif(L7==1)then
set s1=Q8[0]+" has chosen |cffFFFF00random|r race. You will get a random race at the beginning that you keep for the |cffFFFF00whole game|r! Number of wins for overall victory: |cffFFFF00"+I2S(M7)+"|r"
set s2="Random once, |cffFFCC00"+I2S(M7)+"|cffFFFF80 wins"
elseif(L7==2)then
set s1=Q8[0]+" has chosen |cffFFFF00mirror mode|r. Both teams will get the same random races at the beginning that they will keep for the |cffFFFF00whole game|r! Number of wins for overall victory: |cffFFFF00"+I2S(M7)+"|r"
set s2="Mirror once, |cffFFCC00"+I2S(M7)+"|cffFFFF80 wins"
elseif(L7==3)then
set s1=Q8[0]+" has chosen |cffFFFF00draft|r race. You will draft a race at the beginning that you keep for the |cffFFFF00whole game|r! Number of wins for overall victory: |cffFFFF00"+I2S(M7)+"|r"
set s2="Draft once, |cffFFCC00"+I2S(M7)+"|cffFFFF80 wins"
endif
else
if(L7==0)then
set s1=Q8[0]+" has chosen |cffFFFF00pick|r race |cffFFFF00each round|r. You may pick a new race each round! Number of wins for overall victory: |cffFFFF00"+I2S(M7)+"|r"
set s2="Pick each round, |cffFFCC00"+I2S(M7)+"|cffFFFF80 wins"
elseif(L7==1)then
set s1=Q8[0]+" has chosen |cffFFFF00random|r race |cffFFFF00each round|r. You will get a new random race each round! Number of wins for overall victory: |cffFFFF00"+I2S(M7)+"|r"
set s2="Random each round, |cffFFCC00"+I2S(M7)+"|cffFFFF80 wins"
elseif(L7==2)then
set s1=Q8[0]+" has chosen  |cffFFFF00mirror mode each round|r. Both teams will get the same random races each round! Number of wins for overall victory: |cffFFFF00"+I2S(M7)+"|r"
set s2="Mirror each round, |cffFFCC00"+I2S(M7)+"|cffFFFF80 wins"
elseif(L7==3)then
set s1=Q8[0]+" has chosen |cffFFFF00draft|r race |cffFFFF00each round|r. You will draft a new race each round! Number of wins for overall victory: |cffFFFF00"+I2S(M7)+"|r"
set s2="Draft each round, |cffFFCC00"+I2S(M7)+"|cffFFFF80 wins"
endif
endif
endif
set Hd="|cffFFFF80"+s2+"|r"
if(fl or not t7)then
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,25.,s1)
endif
endfunction
function Jq takes nothing returns nothing
set Od[0]=null
set Od[1]=null
set Od[2]=null
set Od[3]=null
call DialogClear(Nd)
call DialogDestroy(Nd)
set Nd=null
call DestroyTimerDialog(Ld)
set Ld=null
call DestroyTimer(Kd)
set Kd=null
call DestroyTrigger(Md)
set Md=null
call lq(false)
call TriggerExecute(qe)
endfunction
function Kq takes nothing returns nothing
set R7=not(GetClickedButton()==Od[0])
call TriggerSleepAction(.1)
call Jq()
endfunction
function Lq takes nothing returns nothing
call TriggerSleepAction(.1)
call DialogClear(Nd)
call DialogSetMessage(Nd,"New races after each round?")
set Od[0]=DialogAddButton(Nd,"YES",0)
set Od[1]=DialogAddButton(Nd,"NO",0)
call TriggerClearActions(Md)
call TriggerAddAction(Md,function Kq)
call DialogDisplay(Player(0),Nd,true)
endfunction
function Mq takes nothing returns nothing
if(GetClickedButton()==Od[0])then
set K7="Nq"
set L7=0
else
set K7="Oq"
set L7=1
endif
if(M7==1)then
set R7=false
call Jq()
else
call Lq()
endif
endfunction
function Pq takes nothing returns nothing
call TriggerSleepAction(.1)
call DialogClear(Nd)
call DialogSetMessage(Nd,"Race selection?")
set Od[0]=DialogAddButton(Nd,"Pick your race!",0)
set Od[1]=DialogAddButton(Nd,"Random race!",0)
call TriggerClearActions(Md)
call TriggerAddAction(Md,function Mq)
call DialogDisplay(Player(0),Nd,true)
endfunction
function Qq takes nothing returns nothing
local button cl=GetClickedButton()
local integer i=0
loop
exitwhen cl==Od[i]
set i=i+1
endloop
set M7=i+1
set cl=null
call Pq()
endfunction
function Rq takes nothing returns nothing
call PauseTimer(Kd)
set I7=false
if(L7!=-1)then
call Jq()
return
endif
call DialogSetMessage(Nd,"Number of victories?")
set Od[0]=DialogAddButton(Nd,"1",0)
set Od[1]=DialogAddButton(Nd,"2",0)
set Od[2]=DialogAddButton(Nd,"3",0)
set Od[3]=DialogAddButton(Nd,"4",0)
call TriggerAddAction(Md,function Qq)
call DialogDisplay(Player(0),Nd,true)
endfunction
function Sq takes nothing returns nothing
call TimerStart(Kd,20.,false,function Rq)
set Ld=CreateTimerDialog(Kd)
call TimerDialogSetTitle(Ld,"Game starts:")
call TimerDialogDisplay(Ld,true)
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,30.,"Welcome to |cffFFFF80Castle Fight|r |c0000ffffES|r |c0080ff001.21a|r! |cffFF0000"+GetPlayerName(Player(0))+"|r has now 20 seconds to choose game modes. If you are new to this map, you can find some useful hints in the |cff80FF00Manual|r (|cffFFBA17F9|r).")
call DisplayTimedTextToPlayer(Player(0),.0,.0,30.,"Welcome to |cffFFFF80Castle Fight|r! You have 20 seconds to enter gamemodes. If you don't enter a valid command, you will be able to choose gamemodes via dialogues. If you don't know how to enter gamemodes read the |cff80FF00Manual|r (|cffFFBA17F9|r).")
call CinematicFadeBJ(1,.0,"ReplaceableTextures\\CameraMasks\\Black_mask.blp",.0,0,0,6.)
call TriggerEvaluate(gameStartTrigger)
call FlashQuestDialogButton()
endfunction
function Tq takes nothing returns nothing
call TimerStart(Kd,.01,false,function Sq)
call TriggerRegisterDialogEvent(Md,Nd)
endfunction
function Uq takes nothing returns nothing
set Sd=-1
call TimerDialogDisplay(Rd,false)
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"Time is up and not all players have agreed. Extra rounds declined!")
endfunction
function Vq takes integer xh returns nothing
if(Sd==-1)then
return
endif
if(Ud[xh])then
set Ud[xh]=false
set Td=Td-1
if(Td>0)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+" has agreed, "+I2S(Td)+" more votes needed")
else
set M7=M7+(Sd)
call PauseTimer(Qd)
call TimerDialogDisplay(Rd,false)
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"All players have agreed, number of rounds is increased by "+I2S(Sd))
set t7=true
call lq(true)
set Sd=-1
endif
else
call DisplayTextToPlayer(Player(xh),.0,.0,"You have already agreed!")
endif
endfunction
function Wq takes integer vj returns nothing
local integer i=0
if(vj<1 or vj>3)then
call DisplayTextToPlayer(Player(0),.0,.0,"Invalid number of rounds, must be between 1 and 3")
return
endif
set Sd=vj
set Td=0
loop
if(GetPlayerController(Player(i))==MAP_CONTROL_USER and GetPlayerSlotState(Player(i))==PLAYER_SLOT_STATE_PLAYING and(IsPlayerInForce(Player(i),J8)or IsPlayerInForce(Player(i),K8)))then
set Ud[i]=true
set Td=Td+1
endif
set i=i+1
exitwhen i>$B
endloop
call TimerStart(Qd,30.,false,function Uq)
call TimerDialogDisplay(Rd,true)
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,30.,"|cffC6FF00"+I2S(vj)+" Extra Rounds|r vote has been started. You have 30 seconds to agree to it by typing |cffFFFF00-agree|r. If all players agree, the number of wins for overall victory will be increased by "+I2S(vj))
endfunction
function Xq takes nothing returns nothing
call TimerDialogDisplay(Rd,false)
call TimerDialogSetTitle(Rd,"Voting XR")
endfunction
function Yq takes nothing returns string
local string Eh
if(Wd!=null)then
return Wd
endif
if(L7==1)then
set Eh=" -r"
elseif(L7==2)then
set Eh=" -m"
elseif(L7==3)then
set Eh=" -d"
else
set Eh=" -p"
endif
if(R7)then
set Eh=Eh+("p")
else
set Eh=Eh+("r")
endif
set Eh=Eh+(I2S(M7))
if(N7==1)then
set Eh=Eh+("-slt")
elseif(N7==2)then
set Eh=Eh+("-slb")
endif
if(P7>0)then
set Eh=Eh+"-fow"+I2S(P7)
elseif(P7==-1)then
set Eh=Eh+("-fow")
endif
if(Q7!=$A)then
set Eh=Eh+"-it"+I2S(Q7)
endif
if(S7)then
set Eh=Eh+("-du")
endif
if(T7)then
set Eh=Eh+("-na")
endif
if(U7)then
set Eh=Eh+("-ntb")
endif
if(V7)then
set Eh=Eh+("-nb")
endif
if(not W7)then
set Eh=Eh+("-ns")
endif
if(not X7)then
set Eh=Eh+("-ni")
endif
if(not Y7)then
set Eh=Eh+("-la")
endif
if(not Z7)then
set Eh=Eh+("-nrs")
endif
if(d8)then
set Eh=Eh+("-ur")
endif
if(not Z7)then
set Eh=Eh+("-ca")
endif
if(f8)then
set Eh=Eh+("-dom")
endif
if(g8)then
set Eh=Eh+("-sd")
endif
if(h8)then
set Eh=Eh+("-nafk")
endif
if(not i8)then
set Eh=Eh+("-ndb")
endif
if(j8==1)then
set Eh=Eh+("-nt")
elseif(j8==2)then
set Eh=Eh+("-ht")
endif
if(k8>-1)then
set Eh=Eh+"-ll"+I2S(k8)
endif
if(m8>0)then
set Eh=Eh+"-ban"+I2S(m8)
endif
if(n8>0)then
set Eh=Eh+"-mp"+I2S(n8)
endif
if(o8==$A)then
set Eh=Eh+(Eh+"-cc")
elseif(o8==1)then
set Eh=Eh+("-co")
endif
if(p8!=0)then
if(p8>0)then
set Eh=Eh+"-glw"+I2S(p8)
else
set Eh=Eh+"-gld"+I2S(IAbsBJ(p8))
endif
endif
set Wd=Eh
return Eh
endfunction
function Zq takes string s returns nothing
if(StringLength(s)>0 and SubString(s,0,1)==" ")then
set s=SubString(s,1,StringLength(s))
endif
set s=StringCase(s,false)
if(SubString(s,0,3)=="ice")then
call Og(0)
elseif(SubString(s,0,4)=="lava")then
call Og(1)
elseif(SubString(s,0,4)=="ice2")then
call Og(2)
else
call DisplayTextToPlayer(Player(0),.0,.0,"Sorry, but landscape [|c00ff0000"+s+"|r] not found.")
endif
endfunction
function dr takes nothing returns nothing
set Xd=not Xd
if(Xd)then
call PauseTimer(Kd)
else
call ResumeTimer(Kd)
if(Vd)then
call Rq()
endif
endif
endfunction
function er takes nothing returns nothing
if(not Xd)then
call ResumeTimer(Kd)
if(Vd)then
call Rq()
endif
endif
endfunction
function fr takes player gr,integer hr returns nothing
local integer i=0
local player p
if(hr>6)then
set hr=6
endif
if(CountPlayersInForceBJ(J8)+CountPlayersInForceBJ(K8)+CountPlayersInForceBJ(L8)<hr*2)then
call DisplayTextToPlayer(gr,.0,.0,"Sorry, but command [|c00ff0000Fill|r] coudn't be executed. There are small count of quota players.")
return
endif
loop
exitwhen CountPlayersInForceBJ(J8)>=hr
set p=xi(true)
call ForceRemovePlayer(L8,p)
call ForceAddPlayer(J8,p)
call CreateFogModifierRectBJ(true,p,FOG_OF_WAR_VISIBLE,G7)
set y8[GetPlayerId(p)]=Xh(true)
set O8[GetPlayerId(p)]=CreateForce()
call ak(GetPlayerId(p))
set i=i+1
endloop
loop
exitwhen CountPlayersInForceBJ(K8)>=hr
set p=xi(false)
call ForceRemovePlayer(L8,p)
call ForceAddPlayer(K8,p)
call CreateFogModifierRectBJ(true,p,FOG_OF_WAR_VISIBLE,G7)
set y8[GetPlayerId(p)]=Xh(false)
set O8[GetPlayerId(p)]=CreateForce()
call ak(GetPlayerId(p))
set i=i+1
endloop
call zi()
call DisplayTextToPlayer(gr,.0,.0,"There are added "+I2S(i)+" players.")
endfunction
function ir takes string s returns boolean
local integer i=S2I(s)
if(i<=0)then
return false
endif
set M7=IMinBJ(i,6)
return true
endfunction
function jr takes string s returns boolean
if(s=="g")then
set R7=true
return true
elseif(s=="r")then
set R7=false
return true
endif
return false
endfunction
function kr takes integer t returns nothing
if(t<0)then
return
endif
if(t==0)then
set P7=-1
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"Permanent |cffC6FF00Fog of War|r has been chosen")
return
endif
set P7=t
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Fog of War|r time has been set to |cffFFFF00"+I2S(t)+"|r seconds.")
endfunction
function mr takes integer nr returns nothing
if(nr==0)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,I2S(GetRandomInt(0,99)))
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,I2S(GetRandomInt(0,nr)))
endif
endfunction
function qr takes string YC returns nothing
local integer zC
local string ZC
local real i=$C0
local real rr
if N7>0 then
return
endif
if YC=="u"or YC=="t"then
set zC=-1
elseif YC=="d"or YC=="b"then
set zC=1
else
set zC=(GetRandomInt(0,1)*2)-1
endif
if zC==1 then
set N7=2
set ZC="bottom"
else
set N7=1
set ZC="top"
endif
set rr=GetRectMaxY(bj_mapInitialPlayableArea)
loop
exitwhen i>rr
call CreateDestructable('YTfc',$5C0,i*zC,270,1,0)
call CreateDestructable('YTfc',-$5C0,i*zC,270,1,0)
set i=i+$80
endloop
set i=-$5F0
loop
exitwhen i>$5F0
call SetTerrainPathable(i,272*zC,PATHING_TYPE_WALKABILITY,false)
call SetTerrainPathable(i,272*zC,PATHING_TYPE_FLYABILITY,false)
set i=i+32
endloop
call CreateDestructable('B004',$5C0,640*zC,270,1.1,0)
call CreateDestructable('B004',-$5C0,640*zC,270,1.1,0)
call CreateDestructable('B004',$5C0,960*zC,270,1.1,0)
call CreateDestructable('B004',-$5C0,960*zC,270,1.1,0)
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"|cffC6FF00Single Lane|r has been chosen. Units are only able to walk/fly over the |cffFFFF00"+ZC+" lane|r.")
endfunction
function sr takes string s,integer kg returns nothing
local player p
if(StringLength(s)<=2)then
return
endif
if(I7 and kg==0 and SubString(s,1,3)=="na")then
call hj(false)
elseif(I7 and kg==0 and SubString(s,1,3)=="co")then
call jj()
elseif(I7 and kg==0 and SubString(s,1,3)=="cc")then
call kj()
elseif(I7 and kg==0 and SubString(s,1,3)=="du")then
call mj(true)
elseif(I7 and kg==0 and SubString(s,1,4)=="ntb")then
call oj(false)
elseif(I7 and kg==0 and SubString(s,1,3)=="nb")then
call pj(false)
elseif(I7 and kg==0 and SubString(s,1,3)=="ns")then
call qj(false)
elseif(I7 and kg==0 and SubString(s,1,3)=="ni")then
call rj(false)
elseif(I7 and kg==0 and SubString(s,1,3)=="la")then
call sj(false)
elseif(I7 and kg==0 and SubString(s,1,4)=="nrs")then
call tj(false)
elseif(I7 and kg==0 and SubString(s,1,3)=="sl"and N7==0)then
call qr(SubString(s,3,4))
elseif(I7 and kg==0 and SubString(s,1,3)=="ur")then
call nj(true)
elseif(I7 and kg==0 and SubString(s,1,3)=="it")then
call wj(S2I(SubString(s,3,StringLength(s))))
elseif(I7 and kg==0 and SubString(s,1,4)=="glw")then
call cj(S2I(SubString(s,4,StringLength(s))))
elseif(I7 and kg==0 and SubString(s,1,4)=="gld")then
call cj(-1*S2I(SubString(s,4,StringLength(s))))
elseif((not I7)and kg==0 and SubString(s,1,3)=="xr")then
call Wq(S2I(SubString(s,3,StringLength(s))))
elseif(I7 and kg==0 and SubString(s,1,3)=="mp")then
call Bj(S2I(SubString(s,3,StringLength(s))))
elseif(I7 and kg==0 and SubString(s,1,3)=="ll")then
call uj(S2I(SubString(s,3,StringLength(s))))
elseif(I7 and kg==0 and SubString(s,1,3)=="ht")then
call xj(2)
elseif(I7 and kg==0 and SubString(s,1,3)=="nt")then
call xj(1)
elseif(I7 and kg==0 and SubString(s,1,3)=="ca")then
call zj(false)
elseif(I7 and kg==0 and SubString(s,1,3)=="sd")then
call bj(true)
elseif(I7 and kg==0 and SubString(s,1,4)=="dom")then
call Aj(true)
elseif(I7 and kg==0 and SubString(s,1,4)=="fow")then
call kr(S2I(SubString(s,4,StringLength(s))))
elseif(I7 and kg==0 and SubString(s,1,4)=="ban")then
call aj(S2I(SubString(s,4,StringLength(s))))
elseif(I7 and kg==0 and SubString(s,1,4)=="ndb")then
call Cj(false)
elseif(I7 and kg==0 and SubString(s,1,4)=="env")then
call Zq(SubString(s,4,StringLength(s)))
elseif(I7 and kg==0 and SubString(s,1,5)=="fill")then
call fr(Player(kg),S2I(SubString(s,5,StringLength(s))))
elseif(I7 and kg==0 and SubString(s,1,5)=="nafk")then
call ij(true)
elseif(I7 and kg==0 and SubString(s,1,6)=="pause")then
call dr()
elseif(I7 and kg==0 and SubString(s,1,5)=="skip")then
if(ke or Xd)then
set Vd=true
else
call Rq()
endif
elseif(I7 and kg==0 and SubString(s,1,2)=="r"and jr(SubString(s,2,3))and ir(SubString(s,3,4)))then
set L7=1
set K7="Oq"
call lq(true)
elseif(I7 and kg==0 and SubString(s,1,2)=="p"and jr(SubString(s,2,3))and ir(SubString(s,3,4)))then
set L7=0
set K7="Nq"
call lq(true)
elseif(I7 and kg==0 and SubString(s,1,2)=="m"and jr(SubString(s,2,3))and ir(SubString(s,3,4)))then
set L7=2
set K7="tr"
call lq(true)
elseif(I7 and kg==0 and SubString(s,1,2)=="d"and jr(SubString(s,2,3))and ir(SubString(s,3,4)))then
set L7=3
set K7="ur"
call lq(true)
elseif(SubString(s,1,6)=="stats"and not I7)then
call On(Player(kg))
elseif(SubString(s,1,4)=="afk"and(not I7)and not h8)then
call Ck(kg)
elseif(SubString(s,1,5)=="mode"and(not I7))then
call DisplayTimedTextToPlayer(Player(kg),.0,.0,10.,"|cffFFFF00Game-config-string|r:")
call DisplayTimedTextToPlayer(Player(kg),.0,.0,10.,Yq())
elseif(SubString(s,1,7)=="income"and not I7)then
call Nn(Player(kg))
elseif(SubString(s,1,6)=="armor")then
set p=Player(kg)
call DisplayTimedTextToPlayer(p,.0,.0,10.,"|cffFFFF00Armor table:")
call DisplayTimedTextToPlayer(p,.0,.0,10.,"|cffFFCC00Chaos damage:    |cffFFFF00neutral against all|r")
call DisplayTimedTextToPlayer(p,.0,.0,10.,"|cffFFCC00Normal damage: |cff00FF00good against:|r medium |cffFF0000bad against:|r light")
call DisplayTimedTextToPlayer(p,.0,.0,10.,"|cffFFCC00Pierce damage:   |cff00FF00good against:|r light        |cffFF0000bad against:|r heavy")
call DisplayTimedTextToPlayer(p,.0,.0,10.,"|cffFFCC00Magic damage:   |cff00FF00good against:|r heavy      |cffFF0000bad against:|r medium")
call DisplayTimedTextToPlayer(p,.0,.0,10.,"|cffFFCC00Siege damage:     |cff00FF00good against:|r fortified |cffFF0000bad against:|r all others")
call DisplayTimedTextToPlayer(p,.0,.0,10.,"|cffFFCC00Note:|r All attack types are |cffFF0000bad|r against divine besides chaos!")
elseif(kg==0 and SubString(s,1,5)=="roll")then
call mr(S2I(SubString(s,5,StringLength(s))))
elseif(SubString(s,1,5)=="draw")then
call wh(kg)
elseif(SubString(s,1,6)=="agree")then
call Vq(kg)
elseif(SubString(s,1,5)=="zoom")then
return
else
call DisplayTextToPlayer(Player(kg),.0,.0,"Sorry, but command [|c00ff0000"+SubString(s,1,StringLength(s))+"|r] coudn't be executed. You are not allowed to perform it in current time or you have mistake in syntax.")
endif
endfunction
function vr takes nothing returns boolean
return SubString(GetEventPlayerChatString(),0,1)=="-"
endfunction
function wr takes nothing returns nothing
local string xr=GetEventPlayerChatString()
local string s=StringCase(xr,false)
local integer yr=0
local integer zr=0
local integer Ar=StringLength(s)
local integer i=0
local integer id=GetPlayerId(GetTriggerPlayer())
local string ch
call oh("CE: "+xr)
call rh()
loop
set ch=SubString(s,i,i+1)
if ch=="-"then
if yr!=i then
if zr>0 then
call sr(SubString(s,yr,zr)+SubString(xr,zr,i),id)
else
call sr(SubString(s,yr,i),id)
endif
endif
set yr=i
set zr=0
elseif zr==0 and ch==" "then
set zr=i
endif
set i=i+1
exitwhen i>=Ar
endloop
if zr>0 then
call sr(SubString(s,yr,zr)+SubString(xr,zr,i),id)
else
call sr(SubString(s,yr,i),id)
endif
endfunction
function ar takes nothing returns nothing
local trigger t=CreateTrigger()
call DestroyTimer(GetExpiredTimer())
call TriggerRegisterPlayerChatEvent(t,Player(0),"-",false)
call TriggerRegisterPlayerChatEvent(t,Player(1),"-",false)
call TriggerRegisterPlayerChatEvent(t,Player(6),"-",false)
call TriggerRegisterPlayerChatEvent(t,Player(7),"-",false)
call TriggerAddCondition(t,Condition(function vr))
call TriggerAddAction(t,function wr)
set t=null
endfunction
function Br takes nothing returns nothing
call TimerStart(CreateTimer(),.2,false,function ar)
endfunction
function br takes nothing returns nothing
call DisplayTextToForce(M8,"|c008080c0"+a7[GetPlayerId(GetTriggerPlayer())]+"|r: "+GetEventPlayerChatString())
endfunction
function Cr takes nothing returns nothing
call ForceClear(fe)
call ForceClear(ge)
call ForceClear(he)
endfunction
function cr takes nothing returns nothing
local integer i=0
local boolean Dr=CountPlayersInForceBJ(ge)+CountPlayersInForceBJ(he)>0
local string array Er
local integer Fr=0
local player p
if(Zd!=null)then
call TriggerClearActions(Zd)
call DestroyTrigger(Zd)
set Zd=null
endif
loop
set p=Player(i)
if(IsPlayerInForce(p,fe))then
call ForceRemovePlayer(J8,p)
call ForceRemovePlayer(K8,p)
call Zh(y8[i])
set y8[i]=null
call ForForce(O8[i],function Ij)
call DestroyForce(O8[i])
set O8[i]=null
call DestroyMultiboard(v7[i])
set v7[i]=null
call ForceAddPlayer(M8,p)
call SetPlayerName(p,a7[GetPlayerId(p)]+"                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                ")
call SetForceAllianceStateBJ(bj_FORCE_ALL_PLAYERS,bj_FORCE_PLAYER[GetPlayerId(p)],1)
call SetForceAllianceStateBJ(bj_FORCE_PLAYER[GetPlayerId(p)],bj_FORCE_ALL_PLAYERS,0)
set Yd[i]=CreateFogModifierRectBJ(true,p,FOG_OF_WAR_VISIBLE,bj_mapInitialPlayableArea)
set Er[Fr]="|c008080c0"+a7[i]+" joined to Observers!|r"
set Fr=Fr+1
endif
set i=i+1
exitwhen i>$B
endloop
if(CountPlayersInForceBJ(M8)>0)then
set Zd=CreateTrigger()
call TriggerAddAction(Zd,function br)
set i=0
loop
if(IsPlayerInForce(Player(i),M8))then
call TriggerRegisterPlayerChatEvent(Zd,Player(i),"",false)
endif
set i=i+1
exitwhen i>$B
endloop
endif
if(Dr)then
if(not I7)then
set i=0
loop
if(O8[i]!=null)then
call ForForce(O8[i],function Ij)
call SetPlayerName(Player(i),a7[i])
endif
set i=i+1
exitwhen i>$B
endloop
endif
set i=0
loop
set p=Player(i)
if(IsPlayerInForce(p,ge)or IsPlayerInForce(p,he))then
if(IsPlayerInForce(p,ge))then
call ForceAddPlayer(J8,p)
set y8[i]=Xh(true)
set Er[Fr]="|c008080c0"+a7[i]+" joined to|r "+w8[0]
set Fr=Fr+1
set N8[i]=0
else
call ForceAddPlayer(K8,p)
set y8[i]=Xh(false)
set Er[Fr]="|c008080c0"+a7[i]+" joined to|r "+w8[1]
set Fr=Fr+1
set N8[i]=1
endif
set O8[i]=CreateForce()
call ForceRemovePlayer(M8,p)
call SetPlayerName(p,a7[i])
call FogModifierStop(Yd[i])
call DestroyFogModifier(Yd[i])
endif
set i=i+1
exitwhen i>$B
endloop
endif
call Cr()
set i=0
loop
exitwhen i>=Fr
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Er[Fr])
set i=i+1
endloop
call Ak()
endfunction
function Gr takes nothing returns nothing
local integer i=0
call DialogClear(ie)
loop
if(ee[i]==0)then
set de[i]=DialogAddButton(ie,a7[i]+" (west)",0)
elseif(ee[i]==1)then
set de[i]=DialogAddButton(ie,a7[i]+" (east)",0)
elseif(ee[i]==2)then
set de[i]=DialogAddButton(ie,a7[i]+" (observer)",0)
endif
set i=i+1
exitwhen i>$B
endloop
call DialogAddButton(ie,"Apply!",0)
call DialogDisplay(Player(0),ie,true)
endfunction
function Hr takes nothing returns nothing
local button b=GetClickedButton()
local integer i=0
local player p
loop
exitwhen b==de[i]or i>$B
set i=i+1
endloop
if(b==de[i])then
set ee[i]=ModuloInteger(ee[i]+1,3)
call Gr()
set b=null
return
endif
set b=null
set i=0
loop
if(ee[i]>-1)then
set p=Player(i)
if(ee[i]==0)then
if(not IsPlayerInForce(p,J8))then
if(not IsPlayerInForce(p,M8))then
call ForceAddPlayer(fe,p)
endif
call ForceAddPlayer(ge,p)
endif
elseif(ee[i]==1)then
if(not IsPlayerInForce(p,K8))then
if(not IsPlayerInForce(p,M8))then
call ForceAddPlayer(fe,p)
endif
call ForceAddPlayer(he,p)
endif
elseif(ee[i]==2)then
if(not IsPlayerInForce(p,M8))then
call ForceAddPlayer(fe,p)
endif
endif
endif
set i=i+1
exitwhen i>$B
endloop
set i=CountPlayersInForceBJ(fe)+CountPlayersInForceBJ(ge)+CountPlayersInForceBJ(he)
if(i>0)then
call DisplayTextToPlayer(Player(0),.0,.0,"There are generated "+I2S(i)+" changes.")
if(I7)then
call cr()
call er()
else
call DisplayTextToPlayer(Player(0),.0,.0,"New teams config will be applied at next round.")
endif
else
call DisplayTextToPlayer(Player(0),.0,.0,"There are no any changes required.")
if(I7)then
call cr()
call er()
endif
endif
set ke=false
endfunction
function SpectatorController_EstablishDialog takes nothing returns nothing
local integer i=0
local player p
set ke=true
if(I7)then
call PauseTimer(Kd)
endif
loop
set p=Player(i)
if(IsPlayerInForce(p,J8))then
set ee[i]=0
elseif(IsPlayerInForce(p,K8))then
set ee[i]=1
elseif(IsPlayerInForce(p,M8))then
set ee[i]=2
else
set ee[i]=-1
endif
set i=i+1
exitwhen i>$B
endloop
call Cr()
call Gr()
endfunction
function Ir takes nothing returns nothing
call DestroyTimer(GetExpiredTimer())
set ie=DialogCreate()
call DialogSetMessage(ie,"Players")
call TriggerRegisterDialogEvent(je,ie)
call TriggerAddAction(je,function Hr)
endfunction
function lr takes nothing returns nothing
call TimerStart(CreateTimer(),.01,false,function Ir)
endfunction
function Jr takes nothing returns nothing
call FogEnable(false)
set J7=true
endfunction
function Kr takes nothing returns nothing
local integer i=0
local player p
loop
set p=Player(i)
if(IsPlayerInForce(Player(i),J8)or IsPlayerInForce(Player(i),K8))then
call CreateUnitAtLoc(p,x8[i],y8[i],180.*N8[i])
endif
set i=i+1
exitwhen i>$B
endloop
endfunction
function Lr takes nothing returns nothing
local integer i
local unit u
local player pl
local player pr
set b7=b7+1
call oh("RE: "+I2S(b7))
call rh()
call cr()
call FogEnable(true)
set pl=ForcePickRandomPlayer(J8)
set pr=ForcePickRandomPlayer(K8)
if(b7==1)then
call ck()
endif
if(pl==null)then
set pl=Player(0)
endif
if(pr==null)then
set pr=Player(6)
if(b7==1)then
call ForceRemovePlayer(L8,pr)
call ForceAddPlayer(K8,pr)
call CreateFogModifierRectBJ(true,pr,FOG_OF_WAR_VISIBLE,G7)
set y8[6]=Xh(false)
set O8[6]=CreateForce()
call ak(6)
endif
endif
call Dq()
call am()
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,9.5,"Get ready for round |cffFFCC00"+I2S(b7)+"|r!")
call CinematicFadeBJ(0,4.,"ReplaceableTextures\\CameraMasks\\Black_mask.blp",0,0,0,6.)
set re=CreateFogModifierRectBJ(true,ForcePickRandomPlayer(J8),FOG_OF_WAR_VISIBLE,Qe)
set se=CreateFogModifierRectBJ(true,ForcePickRandomPlayer(K8),FOG_OF_WAR_VISIBLE,Re)
set cd=CreateTrigger()
set Dd=CreateTrigger()
set P8[0]=CreateUnitAtLoc(pl,'hcas',r8[1],270.)
call SetUnitColor(P8[0],PLAYER_COLOR_RED)
if(not X7)then
call UnitRemoveAbility(P8[0],'Aall')
call UnitRemoveAbility(P8[0],'Apit')
endif
call TriggerRegisterDeathEvent(cd,P8[0])
set P8[1]=CreateUnitAtLoc(pr,'hcas',r8[0],270.)
call SetUnitColor(P8[1],PLAYER_COLOR_GREEN)
if(not X7)then
call UnitRemoveAbility(P8[1],'Aall')
call UnitRemoveAbility(P8[1],'Apit')
endif
call TriggerRegisterDeathEvent(Dd,P8[1])
call TriggerAddAction(cd,function wq)
call TriggerAddAction(Dd,function xq)
if(f8)then
call Ci()
endif
call TriggerSleepAction(4.)
call ii()
call oq()
call UnitShareVision(P8[0],pr,true)
call UnitShareVision(P8[1],pl,true)
call TriggerSleepAction(1.)
call UnitShareVision(P8[0],pr,false)
call UnitShareVision(P8[1],pl,false)
set i=0
loop
set u7[i]=true
set i=i+1
exitwhen i>$C
endloop
call Iq()
if(not R7 or b7==1)then
if(m8>0)then
call ExecuteFunc("Mr")
loop
call TriggerSleepAction(1.)
exitwhen ne
endloop
set ne=false
endif
set i=0
loop
set x8[i]=0
set i=i+1
exitwhen i>$B
endloop
if K7 == "Nq" then
  call ExecuteFunc("Nq")
elseif K7 == "Oq" then
  call ExecuteFunc("Oq")
elseif K7 == "tr" then
  call ExecuteFunc("tr")
elseif K7 == "ur" then
  call ExecuteFunc("ur")
endif
loop
call TriggerSleepAction(1.)
exitwhen ne
endloop
set ne=false
else
call Kr()
endif
set u8[0]=0
set u8[1]=0
set v8[0]=0
set v8[1]=0
set i=0
loop
if(x8[i]!=0)then
set u8[N8[i]]=u8[N8[i]]+1
set u=CreateUnitAtLoc(Player(i),x8[i],y8[i],180.*N8[i])
if(not Z7)then
call UnitRemoveAbility(u,'A005')
call UnitRemoveAbility(u,'A06E')
else
call ej(z7[i],N8[i]*6+1,"V")
endif
call PanCameraToTimedLocForPlayer(Player(i),y8[i],.01)
call SetPlayerState(Player(i),PLAYER_STATE_RESOURCE_GOLD,$FA)
call SetPlayerState(Player(i),PLAYER_STATE_RESOURCE_LUMBER,'}')
if(Y7)then
call SetPlayerState(Player(i),PLAYER_STATE_RESOURCE_FOOD_CAP,1)
else
call SetPlayerState(Player(i),PLAYER_STATE_RESOURCE_FOOD_CAP,0)
endif
if(w7[i]!=null)then
call UnitAddAbility(u,'A0A5')
endif
call Fj(i)
else
call Ej(i)
endif
set i=i+1
exitwhen i>$B
endloop
call dj(1,1,I2S(u8[0]))
call dj(1,2,I2S(u8[1]))
call TimerStart(T9,Q7,true,function Mn)
call Gg()
if(P7!=-1)then
call TimerStart(me,P7,false,function Jr)
endif
set c7=0
set D7=0
call TimerStart(C7,1.,true,function gj)
call Vi()
call TimerStart(r7,4.,true,function Ui)
call ah()
call uh()
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"Round |cffFFCC00"+I2S(b7)+"|r started! gl & hf!")
call PlaySoundBJ(Ue)
call Dk()
call Ph()
set Cd=true
set u=null
call ej(A7+1,0,"|cffFFCC00Modes:|r"+Yq())
endfunction
function Nr takes nothing returns nothing
set oe=ji()
set pe=ji()
if(u7[0])then
call ki(oe,'h00O')
call ki(pe,'h00O')
endif
if(u7[1])then
call ki(oe,'u006')
call ki(pe,'u006')
endif
if(u7[2])then
call ki(oe,'h00C')
call ki(pe,'h00C')
endif
if(u7[3])then
call ki(oe,'h019')
call ki(pe,'h019')
endif
if(u7[4])then
call ki(oe,'h00E')
call ki(pe,'h00E')
endif
if(u7[5])then
call ki(oe,'h017')
call ki(pe,'h017')
endif
if(u7[6])then
call ki(oe,'h089')
call ki(pe,'h089')
endif
if(u7[7])then
call ki(oe,'h00P')
call ki(pe,'h00P')
endif
if(u7[8])then
call ki(oe,'h018')
call ki(pe,'h018')
endif
if(u7[9])then
call ki(oe,'h06P')
call ki(pe,'h06P')
endif
if(u7[$A])then
call ki(oe,'h01A')
call ki(pe,'h01A')
endif
endfunction
function Pr takes nothing returns nothing
call pg(oe)
call pg(pe)
set ne=true
endfunction
function Qr takes integer id,boolean Rr returns nothing
if(S7)then
if(d8)then
if(Rr)then
call ni(pe,id)
else
call ni(oe,id)
endif
endif
else
if(d8)then
call ni(oe,id)
call ni(pe,id)
else
if(Rr)then
call ni(oe,id)
else
call ni(pe,id)
endif
endif
endif
endfunction
function Sr takes integer i returns unit
local unit u=CreateUnit(Player(i),'h033',GetLocationX(y8[i]),GetLocationY(y8[i]),.0)
if(u7[0])then
call AddUnitToStock(u,'h00O',1,1)
endif
if(u7[1])then
call AddUnitToStock(u,'u006',1,1)
endif
if(u7[2])then
call AddUnitToStock(u,'h00C',1,1)
endif
if(u7[3])then
call AddUnitToStock(u,'h019',1,1)
endif
if(u7[4])then
call AddUnitToStock(u,'h00E',1,1)
endif
if(u7[5])then
call AddUnitToStock(u,'h017',1,1)
endif
if(u7[6])then
call AddUnitToStock(u,'h089',1,1)
endif
if(u7[7])then
call AddUnitToStock(u,'h00P',1,1)
endif
if(u7[8])then
call AddUnitToStock(u,'h018',1,1)
endif
if(u7[9])then
call AddUnitToStock(u,'h06P',1,1)
endif
if(u7[$A])then
call AddUnitToStock(u,'h01A',1,1)
endif
return u
endfunction
function Tr takes integer i returns unit
local unit u=CreateUnit(Player(i),'h09W',GetLocationX(y8[i]),GetLocationY(y8[i]),.0)
call AddUnitToStock(u,'h00O',1,1)
call AddUnitToStock(u,'u006',1,1)
call AddUnitToStock(u,'h00C',1,1)
call AddUnitToStock(u,'h019',1,1)
call AddUnitToStock(u,'h00E',1,1)
call AddUnitToStock(u,'h017',1,1)
call AddUnitToStock(u,'h089',1,1)
call AddUnitToStock(u,'h00P',1,1)
call AddUnitToStock(u,'h018',1,1)
call AddUnitToStock(u,'h06P',1,1)
call AddUnitToStock(u,'h01A',1,1)
return u
endfunction
function Ur takes nothing returns nothing
call TriggerAddAction(qe,function Lr)
endfunction
function Vr takes nothing returns nothing
call DestroyTimerDialog(ve)
set ve=null
call DestroyTimer(ue)
set ue=null
call RemoveUnit(ae)
set ae=null
call RemoveUnit(Be)
set Be=null
call DestroyTrigger(xe)
set xe=null
call Pr()
endfunction
function Wr takes nothing returns nothing
local unit u
if(Ce==ze)then
call ShowUnit(ae,false)
set u=CreateUnit(Player($D),oi(oe),.0,.0,.0)
set Ce=GetUnitTypeId(u)
set u7[wi(Ce)]=false
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[ze]+" has banned |cffFFFF00"+GetObjectName(Ce))
call ni(oe,Ce)
call RemoveUnitFromStock(ae,Ce)
call RemoveUnitFromStock(Be,Ce)
call RemoveUnit(u)
elseif(Ce==Ae)then
call ShowUnit(Be,false)
set u=CreateUnit(Player($D),oi(oe),.0,.0,.0)
set Ce=GetUnitTypeId(u)
set u7[wi(Ce)]=false
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[Ae]+" has banned |cffFFFF00"+GetObjectName(Ce))
call ni(oe,Ce)
call RemoveUnitFromStock(ae,Ce)
call RemoveUnitFromStock(Be,Ce)
call RemoveUnit(u)
endif
set u=null
if(be==0)then
call Vr()
return
else
set be=be-1
endif
if(ye<1)then
set Ce=ze
call ShowUnit(ae,true)
call PanCameraToForPlayer(Player(ze),GetUnitX(ae),GetUnitY(ae))
else
set Ce=Ae
call ShowUnit(Be,true)
call PanCameraToForPlayer(Player(Ae),GetUnitX(Be),GetUnitY(Be))
endif
set ye=ye+1
if(ye>1)then
set ye=0
endif
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[Ce]+", your turn to ban race now...")
call TimerStart(ue,15.,false,function Wr)
endfunction
function Xr takes nothing returns nothing
local unit u=GetSellingUnit()
local player p=GetOwningPlayer(u)
local integer Sg
call ShowUnit(u,false)
call PauseTimer(ue)
set u=GetSoldUnit()
if(GetUnitTypeId(u)=='h03H')then
call RemoveUnit(u)
set u=CreateUnit(Player($D),oi(oe),.0,.0,.0)
endif
set Sg=GetUnitTypeId(u)
set u7[wi(Sg)]=false
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[GetPlayerId(p)]+" has banned |cffFFFF00"+GetObjectName(Sg))
call ni(oe,Sg)
call RemoveUnitFromStock(ae,Sg)
call RemoveUnitFromStock(Be,Sg)
call RemoveUnit(u)
set u=null
set Ce=-1
call Wr()
endfunction
function Mr takes nothing returns nothing
call Nr()
set ue=CreateTimer()
set ve=CreateTimerDialog(ue)
call TimerDialogSetTitle(ve,"Time to ban:")
call TimerDialogDisplay(ve,true)
set xe=CreateTrigger()
call TriggerAddAction(xe,function Xr)
call TriggerRegisterAnyUnitEventBJ(xe,EVENT_PLAYER_UNIT_SELL)
set ze=0
loop
exitwhen IsPlayerInForce(Player(ze),J8)or ze>=$B
set ze=ze+1
endloop
set Ae=0
loop
exitwhen IsPlayerInForce(Player(Ae),K8)or Ae>=$B
set Ae=Ae+1
endloop
set ae=Tr(ze)
call ShowUnit(ae,false)
set Be=Tr(Ae)
call ShowUnit(Be,false)
set ye=GetRandomInt(0,1)
set be=m8*2
set Ce=-1
call Wr()
endfunction
function Yr takes nothing returns boolean
return GetUnitTypeId(GetFilterUnit())=='h033'
endfunction
function Zr takes nothing returns nothing
call DestroyTimerDialog(De)
set De=null
call DestroyTimer(ce)
set ce=null
call DestroyForce(te)
set te=null
call TriggerClearActions(Ee)
call DestroyTrigger(Ee)
set Ee=null
endfunction
function ds takes nothing returns nothing
call RemoveUnit(GetEnumUnit())
endfunction
function es takes nothing returns nothing
local player p=GetEnumPlayer()
local integer i=GetPlayerId(p)
if(IsPlayerInForce(p,J8))then
set x8[i]=oi(oe)
call Qr(x8[i],true)
call ui(i)
elseif(IsPlayerInForce(p,K8))then
set x8[i]=oi(pe)
call Qr(x8[i],false)
call ui(i)
endif
endfunction
function fs takes nothing returns nothing
call PauseTimer(ce)
call GroupEnumUnitsOfPlayer(f4,Ge,Je)
call ForGroup(f4,function ds)
call ui(GetPlayerId(Ge))
if(He<=$B or Ie<=$B)then
call ExecuteFunc("gs")
else
call ForForce(te,function es)
call Zr()
call Pr()
endif
endfunction
function hs takes nothing returns nothing
local unit u=GetSellingUnit()
local integer xh=GetPlayerId(Ge)
call RemoveUnit(u)
set u=GetSoldUnit()
set x8[xh]=GetUnitTypeId(u)
call RemoveUnit(u)
set u=null
if(x8[xh]!='h03H')then
call ForceRemovePlayer(te,Ge)
endif
call Qr(x8[xh],N8[xh]==0)
set u7[wi(x8[xh])]=false
call fs()
endfunction
function gs takes nothing returns nothing
set Ge=null
if(Fe<2)then
loop
if(IsPlayerInForce(Player(He),te)and IsPlayerInForce(Player(He),J8))then
set Ge=Player(He)
endif
set He=He+1
exitwhen Ge!=null or He>$B
endloop
else
loop
if(IsPlayerInForce(Player(Ie),te)and IsPlayerInForce(Player(Ie),K8))then
set Ge=Player(Ie)
endif
set Ie=Ie+1
exitwhen Ge!=null or Ie>$B
endloop
endif
set Fe=Fe+1
if(Fe>=4)then
set Fe=0
endif
if(Ge==null)then
if(He<=$B or Ie<=$B)then
call gs()
else
call fs()
endif
return
endif
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[GetPlayerId(Ge)]+" is selecting now...")
call TimerStart(ce,15.,false,function fs)
call DisplayTextToPlayer(GetLocalPlayer(),.0,.0,I2S(GetHandleId(ce)))
call Sr(GetPlayerId(Ge))
endfunction
function ur takes nothing returns nothing
local integer i=0
local player p
if(not d8)then
call nj(true)
endif
call Nr()
set te=CreateForce()
set ce=CreateTimer()
set De=CreateTimerDialog(ce)
call TimerDialogSetTitle(De,"Time to select:")
call TimerDialogDisplay(De,true)
set Ee=CreateTrigger()
call TriggerAddAction(Ee,function hs)
call TriggerRegisterAnyUnitEventBJ(Ee,EVENT_PLAYER_UNIT_SELL)
loop
set p=Player(i)
if(IsPlayerInForce(p,J8)or IsPlayerInForce(p,K8))then
call ForceAddPlayer(te,p)
endif
set i=i+1
exitwhen i>$B
endloop
if(le<0)then
set le=GetRandomInt(0,1)
endif
set le=ModuloInteger(le+1,2)
set Fe=1+2*le
set He=0
set Ie=0
set Je=Filter(function Yr)
call gs()
endfunction
function tr takes nothing returns nothing
local integer i=0
local integer j=0
local integer array is
local force f1
local force f2
call Nr()
if(CountPlayersInForceBJ(J8)>=CountPlayersInForceBJ(K8))then
set f1=J8
set f2=K8
else
set f1=K8
set f2=J8
endif
loop
if(IsPlayerInForce(Player(i),f1))then
set x8[i]=oi(oe)
if(not S7)then
call ni(oe,x8[i])
endif
set is[j]=x8[i]
set j=j+1
endif
set i=i+1
exitwhen i>$B
endloop
set i=0
set j=0
loop
if(IsPlayerInForce(Player(i),f2))then
set x8[i]=is[j]
set j=j+1
endif
set i=i+1
exitwhen i>$B
endloop
set f1=null
set f2=null
call Pr()
endfunction
function js takes nothing returns nothing
local unit u
call DestroyTimerDialog(Me)
set Me=null
call DestroyTimer(Le)
set Le=null
set Ne=null
loop
set u=FirstOfGroup(Ke)
exitwhen u==null
call GroupRemoveUnit(Ke,u)
call RemoveUnit(u)
endloop
call DestroyGroup(Ke)
set Ke=null
call DestroyForce(te)
set te=null
call DestroyTrigger(Pe)
set Pe=null
endfunction
function ks takes nothing returns nothing
local player p=GetEnumPlayer()
local integer i=GetPlayerId(p)
if(IsPlayerInForce(p,J8))then
set x8[i]=oi(oe)
call Qr(x8[i],true)
elseif(IsPlayerInForce(p,K8))then
set x8[i]=oi(pe)
call Qr(x8[i],false)
endif
endfunction
function ms takes nothing returns nothing
call RemoveUnit(GetEnumUnit())
endfunction
function ns takes nothing returns nothing
call ForGroup(Ke,function ms)
call ForForce(te,function ks)
call js()
call Pr()
endfunction
function os takes nothing returns nothing
local unit u=GetEnumUnit()
if(IsUnitInForce(u,Ne))then
call RemoveUnitFromStock(u,Oe)
endif
set u=null
endfunction
function ps takes nothing returns nothing
local unit u=GetSellingUnit()
local player p=GetOwningPlayer(u)
call GroupRemoveUnit(Ke,u)
call RemoveUnit(u)
set u=GetSoldUnit()
call SetUnitOwner(u,p,true)
set x8[GetPlayerId(p)]=GetUnitTypeId(u)
call RemoveUnit(u)
set u=null
if(IsPlayerInForce(p,J8))then
set Ne=J8
else
set Ne=K8
endif
set Oe=x8[GetPlayerId(p)]
if(Oe=='h03H')then
if(CountUnitsInGroup(Ke)==0)then
call ns()
endif
return
else
call ForceRemovePlayer(te,p)
endif
call Qr(Oe,Ne==J8)
if(S7)then
if(d8)then
if(Ne==J8)then
set Ne=K8
else
set Ne=J8
endif
call ForGroup(Ke,function os)
endif
else
if(d8)then
set Ne=K8
call ForGroup(Ke,function os)
set Ne=J8
call ForGroup(Ke,function os)
else
call ForGroup(Ke,function os)
endif
endif
if(CountPlayersInForceBJ(te)==0)then
call ns()
endif
endfunction
function Nq takes nothing returns nothing
local integer i=0
local player p
local unit u
call Nr()
set Ke=CreateGroup()
set te=CreateForce()
set Le=CreateTimer()
set Me=CreateTimerDialog(Le)
call TimerDialogSetTitle(Me,"Time to select:")
call TimerDialogDisplay(Me,true)
set Pe=CreateTrigger()
call TriggerAddAction(Pe,function ps)
call TriggerRegisterAnyUnitEventBJ(Pe,EVENT_PLAYER_UNIT_SELL)
loop
set p=Player(i)
if(IsPlayerInForce(p,J8)or IsPlayerInForce(p,K8))then
set u=Sr(i)
call ForceAddPlayer(te,p)
call GroupAddUnit(Ke,u)
call PanCameraToForPlayer(p,GetUnitX(u),GetUnitY(u))
endif
set i=i+1
exitwhen i>$B
endloop
set u=null
call TimerStart(Le,15.,false,function ns)
endfunction
function Oq takes nothing returns nothing
local integer i=0
call Nr()
loop
if(IsPlayerInForce(Player(i),J8))then
set x8[i]=oi(oe)
call Qr(x8[i],true)
elseif(IsPlayerInForce(Player(i),K8))then
set x8[i]=oi(pe)
call Qr(x8[i],false)
endif
set i=i+1
exitwhen i>$B
endloop
call Pr()
endfunction
function qs takes nothing returns nothing
local unit u=GetSummonedUnit()
local integer Sg=GetUnitTypeId(u)
if(Sg=='h03C')then
call SetUnitState(u,UNIT_STATE_MANA,30.)
elseif(Sg=='h03A')then
call TriggerSleepAction(.7)
call IssueImmediateOrderById(u,$D0057)
call TriggerSleepAction(.1)
elseif(GetUnitAbilityLevel(u,'A07M')>=1)then
call Vh(u)
call GroupAddUnit(o7,u)
endif
call li(u)
set u=null
endfunction
function SendUnitToPlayerPersonal takes nothing returns nothing
local unit u=GetEnumUnit()
local integer ss
if(IsUnitType(u,UNIT_TYPE_STRUCTURE))then
if(GetUnitAbilityLevel(u,'A06V')>0)then
call ShowUnit(u,false)
call KillUnit(u)
else
call SetUnitOwner(u,ForcePickRandomPlayer(of),true)
set ss=(m4[GetUnitPointValue((u))])
if(ss>0)then
call IssueImmediateOrderById(u,ss)
call IssueImmediateOrderById(u,ss)
endif
set ss=GetPlayerId(GetOwningPlayer(u))
call Jn(ss,u)
if(not j4[GetUnitPointValue(u)])then
set B8[ss]=B8[ss]+1
endif
endif
else
call SetUnitOwner(u,ForcePickRandomPlayer(of),true)
call li(u)
endif
set u=null
endfunction
function ts takes integer xh returns nothing
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,"ERROR! Bad execution in OPL:OB#0. Please report about this bug.")
return
endfunction
function us takes integer xh returns nothing
local integer i=0
local force vs=CreateForce()
local player ws
local string Eq
set Eq=GetLocalizedString("TEAM_RESOURCES")
set Eq=Eq+(":")
loop
if(IsPlayerInForce(Player(i),of)and v7[i]!=null)then
call ForceAddPlayer(vs,Player(i))
endif
set i=i+1
exitwhen i>$B
endloop
call ForceAddPlayer(of,Player(xh))
call DestroyMultiboard(v7[xh])
set v7[xh]=null
set ws=ForcePickRandomPlayer(vs)
call DestroyForce(vs)
set vs=null
set i=GetPlayerId(ws)
call qi(O8[i],O8[xh])
call ForceAddPlayer(O8[i],Player(xh))
call SetForceAllianceStateBJ(O8[i],bj_FORCE_PLAYER[i],5)
call bq(i,Eq)
call Aq()
endfunction
function xs takes nothing returns nothing
local player p=GetTriggerPlayer()
local integer xh=GetPlayerId(p)
if(l7)then
return
endif
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+" |cffCA0000has left the game!|r")
if(IsPlayerInForce(p,M8))then
return
endif
call wh(xh)
if(O7<1)then
set O7=1
endif
if(O7==2)then
call ak(xh)
elseif(te==null)then
if(IsPlayerInForce(p,J8))then
if(ri()<=1)then
set Gd=1
set l7=true
call TriggerEvaluate(gameEndTrigger)
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,60.,"All players of |cffFF0000Western Forces|r left. |cff00FF00Eastern Forces|r have won!")
call TriggerExecute(cd)
else
set of=J8
call ForceRemovePlayer(J8,p)
if(O7==1)then
call us(xh)
else
call ts(xh)
endif
endif
elseif(IsPlayerInForce(p,K8))then
if(si()<=1)then
set Gd=2
set l7=true
call TriggerEvaluate(gameEndTrigger)
call DisplayTimedTextToForce(bj_FORCE_ALL_PLAYERS,60.,"All players of |cff00FF00Eastern Forces|r left. |cffFF0000Western Forces|r have won!")
call TriggerExecute(Dd)
else
set of=K8
call ForceRemovePlayer(K8,p)
if(O7==1)then
call us(xh)
else
call ts(xh)
endif
endif
endif
else
call ForceRemovePlayer(te,p)
endif
endfunction
function zs takes integer xh returns nothing
set N[N8[xh]+4]=N[N8[xh]+4]+1
call dj(2,N8[xh]+1,I2S(N[N8[xh]+4]))
if(N[N8[xh]]==xh)then
set N[N8[xh]+2]=N[N8[xh]+2]+1
if(N[N8[xh]+2]==3)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+"|cffFFFF80 just collected |cffFFFF003|cffFFFF80 coins in a row for the "+w8[N8[xh]]+"|cffFFFF00! Very nice!")
elseif(N[N8[xh]+2]==5)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+"|cffFFFF80 just collected|cffFFFF00 5|cffFFFF80 coins in a row for the "+w8[N8[xh]]+"|cffFFFF00! Impressive!")
elseif(N[N8[xh]+2]==$A)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+"|cffFFFF80 just collected|cffFFFF00 10|cffFFFF80 coins in a row for the "+w8[N8[xh]]+"|cffFFFF00! Sick!")
endif
else
set N[N8[xh]]=xh
set N[N8[xh]+2]=1
endif
endfunction
function As takes nothing returns nothing
local integer Ah
local unit u=GetTriggerUnit()
local player p=GetOwningPlayer(u)
local item it=GetManipulatedItem()
local integer Ug=GetItemTypeId(it)
if(Ug=='I004')then
call RemoveItem(it)
if(Y7)then
set Ah=GetPlayerId(p)
set H8[Ah]=H8[Ah]+($5DC)
call AdjustPlayerStateBJ(1,p,PLAYER_STATE_RESOURCE_FOOD_CAP)
else
call AdjustPlayerStateBJ($5DC,p,PLAYER_STATE_RESOURCE_GOLD)
call DisplayTextToPlayer(p,.0,.0,"|cffFF0000You can't increase your Legendaries limit! No Legendaries is activated!|r")
endif
elseif(Ug=='I008')then
set Ah=GetPlayerId(p)
set H8[Ah]=H8[Ah]+(600)
set u=CreateUnitAtLoc(p,'e008',H7,.0)
call UnitAddAbility(u,'A06D')
call UnitApplyTimedLife(u,'BTLF',29.)
elseif(Ug=='I007')then
set Ah=GetPlayerId(p)
set H8[Ah]=H8[Ah]+($578)
set u=CreateUnitAtLoc(p,'e008',H7,.0)
call UnitAddAbility(u,'A06C')
call UnitApplyTimedLife(u,'BTLF',29.)
elseif(Ug=='I001')then
set Ah=GetPlayerId(p)
set H8[Ah]=H8[Ah]+($96)
elseif(Ug=='I005')then
set Ah=GetPlayerId(p)
set H8[Ah]=H8[Ah]+($96)
elseif(Ug=='I003')then
set Ah=GetPlayerId(p)
set H8[Ah]=H8[Ah]+(650)
elseif(Ug=='I00A')then
set Ah=GetPlayerId(p)
set H8[Ah]=H8[Ah]+(600)
elseif(Ug=='I009')then
set Ah=GetPlayerId(p)
set H8[Ah]=H8[Ah]+(500)
elseif(Ug=='I006')then
set Ah=GetPlayerId(p)
set H8[Ah]=H8[Ah]+(550)
elseif(Ug=='I000')then
call cg(p)
call RemoveItem(it)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Other\\Transmute\\PileofGold.mdl",u,"origin"))
call zs(GetPlayerId(p))
endif
set it=null
set u=null
endfunction
function Bs takes nothing returns boolean
local unit u=GetTriggerUnit()
local player p
if(IsUnitType(u,UNIT_TYPE_PEON))then
set p=GetOwningPlayer(u)
call PingMinimapForPlayer(p,GetUnitX(u),GetUnitY(u),1.)
call SetUnitPositionLoc(u,y8[GetPlayerId(p)])
call DisplayTextToPlayer(p,.0,.0,"|cffFF0000Your worker may not leave your castle!|r")
endif
set u=null
return false
endfunction
function Cs takes nothing returns nothing
local unit u=GetTriggerUnit()
local player p=GetOwningPlayer(u)
local integer ss=GetPlayerId(p)
local integer Sg=GetUnitPointValue(u)
call eh(u)
set G8[ss]=G8[ss]+(h4[Sg])
if(j4[Sg])then
if(k4[Sg])then
call Ji(u,h4[Sg]*3/4)
else
call Ji(u,h4[Sg])
endif
else
set B8[ss]=B8[ss]+1
endif
call In(ss,u)
call GroupEnumUnitsOfPlayer(f4,p,s7)
call ForGroup(f4,function Yi)
set ss=(m4[GetUnitPointValue((u))])
if(ss>0)then
call IssueImmediateOrderById(u,ss)
call IssueImmediateOrderById(u,ss)
else
set Sg=GetUnitTypeId(u)
if(Sg=='h001')then
call xn(u)
call GroupAddUnit(O9,u)
elseif(Sg=='h05G')then
call bn(p)
elseif(Sg=='h059')then
call jn(p)
elseif(Sg=='h056' or Sg=='h03L' or Sg=='h01W' or Sg=='h01X' or Sg=='h05R')then
call IssueImmediateOrderById(u,$D027A)
call TriggerSleepAction(1.)
call IssueImmediateOrderById(u,$D027A)
call IssueTargetOrderById(u,$D0279,GroupPickRandomUnit(F7))
call TriggerSleepAction(45.)
call IssueTargetOrderById(u,$D0279,GroupPickRandomUnit(F7))
elseif(Sg=='h09T')then
call UnitAddAbility(u,'A09S')
call UnitAddAbility(u,'A09P')
call UnitAddAbility(u,'A09V')
call GroupAddUnit(dd,u)
elseif(Sg=='h01O')then
call UnitAddAbility(u,'A01V')
elseif(Sg=='h008')then
set Sg=GetPlayerId(p)
set I8[Sg]=I8[Sg]+1
endif
endif
if(i8)then
call oh("BE: "+GetPlayerName(p)+" ->"+GetUnitName(u))
call rh()
endif
set u=null
endfunction
function Ds takes nothing returns nothing
call Wg(GetTriggerUnit())
endfunction
function Fs takes nothing returns nothing
call eh(GetTriggerUnit())
endfunction
function Hs takes nothing returns boolean
local unit u=GetTriggerUnit()
local integer xh
if((m4[GetUnitPointValue((u))])>0)then
set xh=GetPlayerId(GetOwningPlayer(u))
set a8[xh]=a8[xh]+1
endif
set u=null
return false
endfunction
function ls takes nothing returns nothing
local unit u=GetTriggerUnit()
local integer t
local unit k
if(IsUnitType(u,UNIT_TYPE_SAPPER))then
if(GetUnitAbilityLevel(u,'A07M')>=1)then
call GroupRemoveUnit(o7,u)
set l4[GetUnitUserData((u))]=false
endif
set k=GetKillingUnit()
if(k!=null and not IsUnitType(k,UNIT_TYPE_STRUCTURE))then
set t=GetPlayerId(GetOwningPlayer(k))
set A8[t]=A8[t]+1
if(GetUnitTypeId(u)=='e00A')then
call UnitDamageTarget(u,k,350.,true,false,ATTACK_TYPE_CHAOS,DAMAGE_TYPE_NORMAL,WEAPON_TYPE_WHOKNOWS)
endif
set t=GetUnitTypeId(k)
if(t=='n00V' or t=='n01O')then
call IssueImmediateOrderById(k,$D0084)
call Ii(k)
elseif(t=='e00B')then
call SetUnitLifePercentBJ(k,GetUnitLifePercent(k)+14.)
elseif(t=='e00A')then
call SetUnitLifePercentBJ(k,GetUnitLifePercent(k)+20.)
elseif(t=='h01U' and GetUnitAbilityLevel(u,'A08H')<=0 and(not IsUnitType(u,UNIT_TYPE_MECHANICAL))and(not IsUnitType(u,UNIT_TYPE_UNDEAD)))then
call Wp(k,u,'h01V')
set u=null
elseif(t=='h05H' and GetUnitAbilityLevel(u,'A08H')<=0 and(not IsUnitType(u,UNIT_TYPE_MECHANICAL))and(not IsUnitType(u,UNIT_TYPE_UNDEAD)))then
call Wp(k,u,'h01U')
set u=null
elseif(GetUnitAbilityLevel(u,'A07M')>=1)then
call Uh(u)
endif
set k=null
endif
if(u!=null and GetUnitAbilityLevel(u,'A07G')<=0 and not IsUnitType(u,UNIT_TYPE_SUMMONED))then
set t=N8[GetPlayerId(GetOwningPlayer(u))]
if(s8[t]>0)then
call TriggerSleepAction(2.)
if(GetWidgetLife(u)<.405 and GetUnitAbilityLevel(u,'A07H')<1 and GetRandomInt(0,99)<IMinBJ(s8[t],40))then
call Ii(CreateUnit(GetOwningPlayer(u),GetUnitTypeId(u),GetUnitX(u),GetUnitY(u),.0))
call DestroyEffect(AddSpecialEffect("Abilities\\Spells\\Human\\Resurrect\\ResurrectCaster.mdl",GetUnitX(u),GetUnitY(u)))
call RemoveUnit(u)
endif
endif
endif
else
call Wg(u)
call ln(GetPlayerId(GetOwningPlayer(u)),u)
set t=GetUnitTypeId(u)
if(t=='h05G')then
call Cn(u)
elseif(t=='h059')then
call kn(u)
elseif(t=='h008')then
set t=GetPlayerId(GetOwningPlayer(u))
set I8[t]=I8[t]-1
endif
call FlushChildHashtable(E7,GetHandleId(u))
call GroupRemoveUnit(O9,u)
call GroupRemoveUnit(dd,u)
set u=GetKillingUnit()
if(u!=null and pf)then
set t=N8[GetPlayerId(GetOwningPlayer(u))]
set v8[t]=v8[t]+1
call dj(3,t+1,I2S(v8[t]))
endif
endif
set u=null
endfunction
function Ks takes unit u,real tx,real ty returns nothing
local player p=GetOwningPlayer(u)
local unit c=CreateUnit(p,'h04X',tx,ty,.0)
local real Ls=.0
local integer Xg=0
local unit j
local integer xh
call SetUnitVertexColor(c,0,0,0,0)
call UnitRemoveAbility(u,'A005')
call UnitRemoveAbility(u,'A06E')
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Items\\TomeOfRetraining\\TomeOfRetrainingCaster.mdl",u,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Units\\NightElf\\Wisp\\WispExplode.mdl",c,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Units\\NightElf\\Wisp\\WispExplode.mdl",c,"origin"))
call DestroyEffect(AddSpecialEffectTarget("Units\\NightElf\\Wisp\\WispExplode.mdl",c,"origin"))
call TriggerSleepAction(.35)
set g4=p
call GroupEnumUnitsInRange(f4,tx,ty,700.,null)
loop
set j=FirstOfGroup(f4)
exitwhen j==null
call GroupRemoveUnit(f4,j)
if(IsUnitEnemy(j,p)and GetWidgetLife(j)>.405 and GetUnitAbilityLevel(j,'Avul')<=0)then
set Xg=Xg+1
set Ls=Ls+(GetWidgetLife(j))
call UnitDamageTarget(u,j,4444.,true,false,ATTACK_TYPE_CHAOS,DAMAGE_TYPE_DEATH,WEAPON_TYPE_WHOKNOWS)
call UnitDamageTarget(u,j,4444.,true,false,ATTACK_TYPE_MAGIC,DAMAGE_TYPE_DEATH,WEAPON_TYPE_WHOKNOWS)
endif
endloop
call IssueImmediateOrderById(c,$D022E)
call TriggerSleepAction(1.5)
call RemoveUnit(c)
set c=null
set xh=GetPlayerId(p)
set C8[xh]=R2I(Ls)
set c8[xh]=Xg
set u8[N8[xh]]=u8[N8[xh]]-1
if(u8[N8[xh]]==0)then
call dj(1,N8[xh]+1,"|cffFF00000|r")
else
call dj(1,N8[xh]+1,I2S(u8[N8[xh]]))
endif
call ej(z7[xh],N8[xh]*6+1," ")
if(Xg==0)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+" wasted his Rescue Strike, killing no unit! Epic Fail!")
elseif(Xg==1)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+" wasted his Rescue Strike, killing only one unit!")
elseif(Xg<5)then
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+" wasted his Rescue Strike, dealing only |cffFFFF00"+I2S(C8[xh])+"|r damage and killing only |cffFFFF00"+I2S(Xg)+"|r units!")
else
call DisplayTextToForce(bj_FORCE_ALL_PLAYERS,Q8[xh]+" dealt |cffFFFF00"+I2S(C8[xh])+"|r damage with his Rescue Strike, killing |cffFFFF00"+I2S(Xg)+"|r units!")
endif
endfunction
function Ms takes unit u,real tx,real ty returns nothing
local unit c=CreateUnit(GetOwningPlayer(u),'e008',tx,ty,.0)
call UnitAddAbility(c,'A02G')
call IssueImmediateOrderById(c,$D012D)
call UnitApplyTimedLife(c,'BTLF',1.)
set c=null
endfunction
function Ns takes unit u,integer Os returns nothing
local player p=GetOwningPlayer(u)
if(Os==0)then
set Os='I008'
elseif(Os==1)then
set Os='I007'
elseif(Os==2)then
set Os='I006'
elseif(Os==3)then
set Os='I003'
elseif(Os==4)then
set Os='I004'
elseif(Os==5)then
set Os='I005'
elseif(Os==6)then
set Os='I00A'
elseif(Os==7)then
set Os='I001'
elseif(Os==8)then
set Os='I009'
endif
call IssueNeutralImmediateOrderById(p,P8[N8[GetPlayerId(p)]],Os)
endfunction
function Ps takes nothing returns nothing
local unit u=GetTriggerUnit()
local integer Qs=GetSpellAbilityId()
if(IsUnitType(u,UNIT_TYPE_STRUCTURE))then
if Qs=='A09A' then
call Di(u,(p4[GetUnitPointValue((u))]))
else
call ih(u)
endif
elseif(Qs=='A005')then
call Ks(u,GetSpellTargetX(),GetSpellTargetY())
elseif(Qs=='A08Y')then
call Ms(u,GetSpellTargetX(),GetSpellTargetY())
elseif(Qs>='IBA0' and Qs<='IBA8')then
call Ns(u,Qs-'IBA0')
else
call mh(u,Qs,GetSpellTargetUnit())
endif
set u=null
endfunction
function Ss takes nothing returns nothing
local unit u=GetTrainedUnit()
local integer xh=GetPlayerId(GetOwningPlayer(u))
local boolean Bn=GetUnitAbilityLevel(GetTriggerUnit(),'B01K')>0
local unit j
set z8[xh]=z8[xh]+1
if(GetUnitAbilityLevel(u,'A09H')>0)then
set j=CreateUnit(GetOwningPlayer(u),GetUnitTypeId(u),GetUnitX(u),GetUnitY(u),.0)
if(Bn)then
call UnitAddAbility(j,'A09M')
call SetUnitAbilityLevel(j,'A09M',3)
call UnitRemoveAbility(j,'A09M')
call UnitAddAbility(j,'A09Q')
call UnitAddAbility(j,'A09R')
endif
call Am(j)
elseif(GetUnitAbilityLevel(u,'A07J')>0)then
set u=Km(u)
elseif(GetUnitAbilityLevel(u,'A07M')>=1)then
call Vh(u)
call GroupAddUnit(o7,u)
if(GetUnitTypeId(u)=='n01U')then
call UnitApplyTimedLife(u,'BTLF','x')
endif
elseif(GetUnitTypeId(u)=='h06U')then
call SetUnitState(u,UNIT_STATE_MANA,GetRandomReal(.0,50.))
endif
if(Bn)then
call UnitAddAbility(u,'A09M')
call SetUnitAbilityLevel(u,'A09M',3)
call UnitRemoveAbility(u,'A09M')
call UnitAddAbility(u,'A09Q')
call UnitAddAbility(u,'A09R')
endif
call Am(u)
set u=null
set j=GetTriggerUnit()
set xh=GetTrainedUnitType()
call TriggerSleepAction(.1)
call IssueImmediateOrderById(j,xh)
set j=null
endfunction
function Us takes nothing returns boolean
local unit u=GetTriggerUnit()
local integer Sg
if(IsUnitType(u,UNIT_TYPE_SAPPER))then
call TriggerRegisterUnitEvent(bd,u,EVENT_UNIT_DAMAGED)
set Sg=GetUnitTypeId(u)
if(Sg=='n01B')then
call SetUnitVertexColor(u,82,0,$87,'f')
elseif(Sg=='e00F')then
set u=null
return true
endif
call li(u)
endif
set u=null
return false
endfunction
function Vs takes nothing returns nothing
call dp(GetTriggerUnit())
endfunction
function Xs takes nothing returns nothing
local unit u=GetTriggerUnit()
if(IsUnitType(GetTriggerUnit(),UNIT_TYPE_SAPPER)and not IsUnitType(GetTriggerUnit(),UNIT_TYPE_STRUCTURE))then
if(GetUnitAbilityLevel(u,'A07H')>0)then
call DisableTrigger(nf)
call SetUnitOwner(u,GetChangingUnitPrevOwner(),true)
call EnableTrigger(nf)
call DestroyEffect(AddSpecialEffectTarget("Abilities\\Spells\\Human\\DispelMagic\\DispelMagicTarget.mdl",u,"origin"))
elseif(GetUnitTypeId(GetTriggerUnit())=='h03A')then
call TriggerSleepAction(.1)
call IssueImmediateOrderById(u,$D0057)
call TriggerSleepAction(.1)
endif
endif
call li(u)
set u=null
endfunction
function InitCustomTeams takes nothing returns nothing
call SetPlayerTeam(Player(0),0)
call SetPlayerState(Player(0),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerTeam(Player(1),0)
call SetPlayerState(Player(1),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerAllianceStateAllyBJ(Player(0),Player(1),true)
call SetPlayerAllianceStateAllyBJ(Player(1),Player(0),true)
call SetPlayerAllianceStateVisionBJ(Player(0),Player(1),true)
call SetPlayerAllianceStateVisionBJ(Player(1),Player(0),true)
call SetPlayerTeam(Player(6),1)
call SetPlayerState(Player(6),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerTeam(Player(7),1)
call SetPlayerState(Player(7),PLAYER_STATE_ALLIED_VICTORY,1)
call SetPlayerAllianceStateAllyBJ(Player(6),Player(7),true)
call SetPlayerAllianceStateAllyBJ(Player(7),Player(6),true)
call SetPlayerAllianceStateVisionBJ(Player(6),Player(7),true)
call SetPlayerAllianceStateVisionBJ(Player(7),Player(6),true)
endfunction
function main takes nothing returns nothing
local weathereffect we
local integer kg
local integer mg
local version v
local integer Yf
call SetCameraBounds(-5632.+GetCameraMargin(CAMERA_MARGIN_LEFT),-3584.+GetCameraMargin(CAMERA_MARGIN_BOTTOM),5632.-GetCameraMargin(CAMERA_MARGIN_RIGHT),3584.-GetCameraMargin(CAMERA_MARGIN_TOP),-5632.+GetCameraMargin(CAMERA_MARGIN_LEFT),3584.-GetCameraMargin(CAMERA_MARGIN_TOP),5632.-GetCameraMargin(CAMERA_MARGIN_RIGHT),-3584.+GetCameraMargin(CAMERA_MARGIN_BOTTOM))
call SetDayNightModels("Environment\\DNC\\DNCAshenvale\\DNCAshenvaleTerrain\\DNCAshenvaleTerrain.mdl","Environment\\DNC\\DNCAshenvale\\DNCAshenvaleUnit\\DNCAshenvaleUnit.mdl")
call NewSoundEnvironment("Default")
call SetAmbientDaySound("AshenvaleDay")
call SetAmbientNightSound("AshenvaleNight")
call SetMapMusic("Music",true,0)
set Ue=CreateSound("Sound\\Ambient\\DoodadEffects\\TheHornOfCenarius.wav",false,false,false,$A,$A,"DefaultEAXON")
call SetSoundParamsFromLabel(Ue,"HornOfCenariusSound")
call SetSoundDuration(Ue,$2F59)
set Ve=CreateSound("Sound\\Interface\\CreepAggroWhat1.wav",false,false,false,$A,$A,"DefaultEAXON")
call SetSoundParamsFromLabel(Ve,"CreepAggro")
call SetSoundDuration(Ve,$4D4)
set Qe=Rect(-5632.,-2048.,-1440.,2048.)
set Re=Rect(1440.,-2048.,5632.,2048.)
set Se=Rect(-5248.,-384.,-4480.,384.)
set Te=Rect(4480.,-384.,5248.,384.)
call ConfigureNeutralVictim()
set Pf=Filter(function ig)
set filterIssueHauntOrderAtLocBJ=Filter(function IssueHauntOrderAtLocBJFilter)
set filterEnumDestructablesInCircleBJ=Filter(function Vf)
set filterGetUnitsInRectOfPlayer=Filter(function GetUnitsInRectOfPlayerFilter)
set filterGetUnitsOfTypeIdAll=Filter(function GetUnitsOfTypeIdAllFilter)
set filterGetUnitsOfPlayerAndTypeId=Filter(function GetUnitsOfPlayerAndTypeIdFilter)
set filterMeleeTrainedUnitIsHeroBJ=Filter(function MeleeTrainedUnitIsHeroBJFilter)
set filterLivingPlayerUnitsOfTypeId=Filter(function LivingPlayerUnitsOfTypeIdFilter)
set kg=0
loop
exitwhen kg==16
set bj_FORCE_PLAYER[kg]=CreateForce()
call ForceAddPlayer(bj_FORCE_PLAYER[kg],Player(kg))
set kg=kg+1
endloop
set bj_FORCE_ALL_PLAYERS=CreateForce()
call ForceEnumPlayers(bj_FORCE_ALL_PLAYERS,null)
set bj_cineModePriorSpeed=GetGameSpeed()
set bj_cineModePriorFogSetting=IsFogEnabled()
set bj_cineModePriorMaskSetting=IsFogMaskEnabled()
set kg=0
loop
exitwhen kg>=bj_MAX_QUEUED_TRIGGERS
set bj_queuedExecTriggers[kg]=null
set bj_queuedExecUseConds[kg]=false
set kg=kg+1
endloop
set bj_isSinglePlayer=false
set mg=0
set kg=0
loop
exitwhen kg>=$C
if(GetPlayerController(Player(kg))==MAP_CONTROL_USER and GetPlayerSlotState(Player(kg))==PLAYER_SLOT_STATE_PLAYING)then
set mg=mg+1
endif
set kg=kg+1
endloop
set bj_isSinglePlayer=(mg==1)
set bj_rescueSound=CreateSoundFromLabel("Rescue",false,false,false,$2710,$2710)
set bj_questDiscoveredSound=CreateSoundFromLabel("QuestNew",false,false,false,$2710,$2710)
set bj_questUpdatedSound=CreateSoundFromLabel("QuestUpdate",false,false,false,$2710,$2710)
set bj_questCompletedSound=CreateSoundFromLabel("QuestCompleted",false,false,false,$2710,$2710)
set bj_questFailedSound=CreateSoundFromLabel("QuestFailed",false,false,false,$2710,$2710)
set bj_questHintSound=CreateSoundFromLabel("Hint",false,false,false,$2710,$2710)
set bj_questSecretSound=CreateSoundFromLabel("SecretFound",false,false,false,$2710,$2710)
set bj_questItemAcquiredSound=CreateSoundFromLabel("ItemReward",false,false,false,$2710,$2710)
set bj_questWarningSound=CreateSoundFromLabel("Warning",false,false,false,$2710,$2710)
set bj_victoryDialogSound=CreateSoundFromLabel("QuestCompleted",false,false,false,$2710,$2710)
set bj_defeatDialogSound=CreateSoundFromLabel("QuestFailed",false,false,false,$2710,$2710)
call DelayedSuspendDecayCreate()
set v=VersionGet()
if(v==VERSION_REIGN_OF_CHAOS)then
set bj_MELEE_MAX_TWINKED_HEROES=bj_MELEE_MAX_TWINKED_HEROES_V0
else
set bj_MELEE_MAX_TWINKED_HEROES=bj_MELEE_MAX_TWINKED_HEROES_V1
endif
call InitQueuedTriggers()
call InitRescuableBehaviorBJ()
call InitDNCSounds()
call InitMapRects()
call InitSummonableCaps()
set Yf=0
loop
set bj_stockAllowedPermanent[Yf]=false
set bj_stockAllowedCharged[Yf]=false
set bj_stockAllowedArtifact[Yf]=false
set Yf=Yf+1
exitwhen Yf>$A
endloop
call SetAllItemTypeSlots($B)
call SetAllUnitTypeSlots($B)
set bj_stockUpdateTimer=CreateTimer()
call TimerStart(bj_stockUpdateTimer,bj_STOCK_RESTOCK_INITIAL_DELAY,false,function gg)
set bj_stockItemPurchased=CreateTrigger()
call TriggerRegisterPlayerUnitEvent(bj_stockItemPurchased,Player($F),EVENT_PLAYER_UNIT_SELL_ITEM,null)
call TriggerAddAction(bj_stockItemPurchased,function RemovePurchasedItem)
call DetectGameStarted()
call ExecuteFunc("Zs")
call ExecuteFunc("Hg")
call ExecuteFunc("nh")
call ExecuteFunc("th")
call ExecuteFunc("Bh")
call ExecuteFunc("Ch")
call ExecuteFunc("Kh")
call ExecuteFunc("Wh")
call ExecuteFunc("ei")
call ExecuteFunc("Zi")
call ExecuteFunc("Kj")
call ExecuteFunc("Lm")
call ExecuteFunc("Vm")
call ExecuteFunc("mn")
call ExecuteFunc("En")
call ExecuteFunc("Wn")
call ExecuteFunc("zo")
call ExecuteFunc("Do")
call ExecuteFunc("gp")
call ExecuteFunc("Bp")
call ExecuteFunc("Np")
call ExecuteFunc("Xp")
call ExecuteFunc("zq")
call ExecuteFunc("Tq")
call ExecuteFunc("Xq")
call ExecuteFunc("Br")
call ExecuteFunc("lr")
call ExecuteFunc("Ur")
set We=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(We,EVENT_PLAYER_UNIT_SUMMON)
call TriggerAddAction(We,function qs)
set Xe=CreateTrigger()
call TriggerRegisterPlayerEventLeave(Xe,Player(0))
call TriggerRegisterPlayerEventLeave(Xe,Player(1))
call TriggerRegisterPlayerEventLeave(Xe,Player(6))
call TriggerRegisterPlayerEventLeave(Xe,Player(7))
call TriggerAddAction(Xe,function xs)
set Ye=CreateTrigger()
call TriggerAddAction(Ye,function As)
call TriggerRegisterAnyUnitEventBJ(Ye,EVENT_PLAYER_UNIT_PICKUP_ITEM)
set Ze=CreateTrigger()
call TriggerRegisterLeaveRectSimple(Ze,Qe)
call TriggerRegisterLeaveRectSimple(Ze,Re)
call TriggerAddCondition(Ze,Condition(function Bs))
set df=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(df,EVENT_PLAYER_UNIT_CONSTRUCT_FINISH)
call TriggerRegisterAnyUnitEventBJ(df,EVENT_PLAYER_UNIT_UPGRADE_FINISH)
call TriggerAddAction(df,function Cs)
set ef=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(ef,EVENT_PLAYER_UNIT_UPGRADE_START)
call TriggerAddAction(ef,function Ds)
set ff=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(ff,EVENT_PLAYER_UNIT_UPGRADE_CANCEL)
call TriggerAddAction(ff,function Fs)
set gf=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(gf,EVENT_PLAYER_UNIT_CONSTRUCT_FINISH)
call TriggerAddCondition(gf,Condition(function Hs))
set hf=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(hf,EVENT_PLAYER_UNIT_DEATH)
call TriggerAddAction(hf,function ls)
set jf=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(jf,EVENT_PLAYER_UNIT_SPELL_EFFECT)
call TriggerAddAction(jf,function Ps)
set kf=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(kf,EVENT_PLAYER_UNIT_TRAIN_FINISH)
call TriggerAddAction(kf,function Ss)
set mf=CreateTrigger()
call TriggerRegisterEnterRectSimple(mf,bj_mapInitialPlayableArea)
call TriggerAddCondition(mf,Condition(function Us))
call TriggerAddAction(mf,function Vs)
set nf=CreateTrigger()
call TriggerRegisterAnyUnitEventBJ(nf,EVENT_PLAYER_UNIT_CHANGE_OWNER)
call TriggerAddAction(nf,function Xs)
endfunction
function config takes nothing returns nothing
call SetMapName("|cffFFD700Castle Fight 1.21a ES")
call SetMapDescription("An epic battle between the two castles! Recommended gamemode is 4on4 with 2 wins. hf!")
call SetPlayers($C)
call SetTeams($C)
call SetGamePlacement(MAP_PLACEMENT_TEAMS_TOGETHER)
call DefineStartLocation(0,-4288.,448.)
call DefineStartLocation(1,-4288.,320.)
call DefineStartLocation(2,-4288.,192.)
call DefineStartLocation(3,-4288.,-256.)
call DefineStartLocation(4,-4288.,-384.)
call DefineStartLocation(5,-4288.,-512.)
call DefineStartLocation(6,4288.,448.)
call DefineStartLocation(7,4288.,320.)
call DefineStartLocation(8,4288.,192.)
call DefineStartLocation(9,4288.,-256.)
call DefineStartLocation($A,4288.,-384.)
call DefineStartLocation($B,4288.,-512.)
call SetPlayerStartLocation(Player(0),0)
call ForcePlayerStartLocation(Player(0),0)
call SetPlayerColor(Player(0),ConvertPlayerColor(0))
call SetPlayerRacePreference(Player(0),RACE_PREF_NIGHTELF)
call SetPlayerRaceSelectable(Player(0),false)
call SetPlayerController(Player(0),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(1),1)
call ForcePlayerStartLocation(Player(1),1)
call SetPlayerColor(Player(1),ConvertPlayerColor(1))
call SetPlayerRacePreference(Player(1),RACE_PREF_NIGHTELF)
call SetPlayerRaceSelectable(Player(1),false)
call SetPlayerController(Player(1),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(6),6)
call ForcePlayerStartLocation(Player(6),6)
call SetPlayerColor(Player(6),ConvertPlayerColor(6))
call SetPlayerRacePreference(Player(6),RACE_PREF_UNDEAD)
call SetPlayerRaceSelectable(Player(6),false)
call SetPlayerController(Player(6),MAP_CONTROL_USER)
call SetPlayerStartLocation(Player(7),7)
call ForcePlayerStartLocation(Player(7),7)
call SetPlayerColor(Player(7),ConvertPlayerColor(7))
call SetPlayerRacePreference(Player(7),RACE_PREF_UNDEAD)
call SetPlayerRaceSelectable(Player(7),false)
call SetPlayerController(Player(7),MAP_CONTROL_USER)
call InitCustomTeams()
call SetStartLocPrioCount(0,1)
call SetStartLocPrio(0,0,1,MAP_LOC_PRIO_HIGH)
call SetStartLocPrioCount(1,2)
call SetStartLocPrio(1,0,0,MAP_LOC_PRIO_HIGH)
call SetStartLocPrio(1,1,2,MAP_LOC_PRIO_HIGH)
call SetStartLocPrioCount(2,1)
call SetStartLocPrio(2,0,1,MAP_LOC_PRIO_HIGH)
call SetStartLocPrioCount(3,1)
call SetStartLocPrio(3,0,4,MAP_LOC_PRIO_HIGH)
call SetStartLocPrioCount(4,2)
call SetStartLocPrio(4,0,3,MAP_LOC_PRIO_HIGH)
call SetStartLocPrio(4,1,5,MAP_LOC_PRIO_HIGH)
call SetStartLocPrioCount(5,1)
call SetStartLocPrio(5,0,4,MAP_LOC_PRIO_HIGH)
call SetStartLocPrioCount(6,1)
call SetStartLocPrio(6,0,7,MAP_LOC_PRIO_HIGH)
call SetStartLocPrioCount(7,2)
call SetStartLocPrio(7,0,6,MAP_LOC_PRIO_HIGH)
call SetStartLocPrio(7,1,8,MAP_LOC_PRIO_HIGH)
call SetStartLocPrioCount(8,1)
call SetStartLocPrio(8,0,7,MAP_LOC_PRIO_HIGH)
call SetStartLocPrioCount(9,1)
call SetStartLocPrio(9,0,$A,MAP_LOC_PRIO_HIGH)
call SetStartLocPrioCount($A,2)
call SetStartLocPrio($A,0,9,MAP_LOC_PRIO_HIGH)
call SetStartLocPrio($A,1,$B,MAP_LOC_PRIO_HIGH)
call SetStartLocPrioCount($B,1)
call SetStartLocPrio($B,0,$A,MAP_LOC_PRIO_HIGH)
endfunction
function Zs takes nothing returns nothing
endfunction
